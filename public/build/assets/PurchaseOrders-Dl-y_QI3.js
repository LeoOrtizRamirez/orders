import{S as E}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{d as Ce,c as P,b as ke,_ as xe,u as Oe}from"./main-D69Cgyo9.js";import{r as S,c as T,d as N,w as Be,k as m,l as _,m as e,t as r,x,u as y,y as z,A,I as ee,F,D as R,n as V,a3 as je,a2 as U,P as qe,q as G,f as D,o as Me}from"./vendor-BuRU_kNN.js";import{_ as Se}from"./AlertMessages.vue_vue_type_script_setup_true_lang-Bx3XH_bc.js";import{Y as Pe,h as we,_ as Ve,G as Ee,S as De}from"./transition-DmF2Pzyd.js";import"./quill-De1S0mUZ.js";import"./hidden-CJVN9Aon.js";import"./keyboard-CA3kR_KZ.js";import"./open-closed-BTc9WkmO.js";function Ae(){const{t:p}=Ce(),d=S([]),f=S([]),q=S([]),M=S(!1),B=S(!1),o=S(""),b=S(""),l=S({}),a=S(""),k=S({show:!1,data:null}),C=S({status:"",supplier_id:""}),s={id:null,supplier_id:null,expected_delivery_date:null,notes:"",tax:0,shipping:0,items:[]},n=S({...s}),i=T(()=>{let t=d.value;if(a.value){const c=a.value.toLowerCase();t=t.filter(v=>{var u,h,g;return((u=v.order_number)==null?void 0:u.toLowerCase().includes(c))||((g=(h=v.supplier)==null?void 0:h.name)==null?void 0:g.toLowerCase().includes(c))})}return C.value.status&&(t=t.filter(c=>c.status===C.value.status)),C.value.supplier_id&&(t=t.filter(c=>c.supplier_id===parseInt(C.value.supplier_id))),t}),j=T(()=>d.value.length),$=T(()=>d.value.filter(t=>t.status==="pending").length),L=T(()=>d.value.filter(t=>t.status==="approved").length),I=T(()=>d.value.filter(t=>t.status==="ordered").length),Y=T(()=>d.value.filter(t=>t.status==="received").length),re=async()=>{M.value=!0,o.value="";try{const t=new URLSearchParams;C.value.status&&t.append("status",C.value.status),C.value.supplier_id&&t.append("supplier_id",C.value.supplier_id);const c=await P.get(`/api/purchase-orders?${t}`);Array.isArray(c.data)?d.value=c.data:c.data&&Array.isArray(c.data.data)?d.value=c.data.data:c.data&&Array.isArray(c.data.orders)?d.value=c.data.orders:(console.warn("Estructura de respuesta inesperada:",c.data),d.value=[])}catch(t){console.error("Error fetching orders:",t),o.value=p("purchase_orders_page.alerts.loading_error"),w(p("purchase_orders_page.alerts.loading_error"),"error")}finally{M.value=!1}},te=async()=>{try{const t=await P.get("/api/suppliers/for-select");Array.isArray(t.data)?f.value=t.data:t.data&&Array.isArray(t.data.data)?f.value=t.data.data:(console.warn("Estructura de respuesta inesperada para suppliers:",t.data),f.value=[])}catch(t){console.error("Error fetching suppliers:",t),f.value=[]}},se=async()=>{try{const t=await P.get("/api/products/active/list");Array.isArray(t.data)?q.value=t.data:t.data&&Array.isArray(t.data.data)?q.value=t.data.data:(console.warn("Estructura de respuesta inesperada para products:",t.data),q.value=[])}catch(t){console.error("Error fetching products:",t),q.value=[]}},H=t=>t&&q.value.find(c=>c.id===t)||null,ae=(t,c)=>{if(!c){n.value.items[t].unit_price=0;return}const v=H(c);v&&v.price?n.value.items[t].unit_price=parseFloat(v.price):n.value.items[t].unit_price=0},oe=(t,c)=>{if(!t)return{valid:!1,message:"Producto no seleccionado"};const v=H(t);if(!v)return{valid:!1,message:"Producto no encontrado"};const u=v.current_stock||0;return c>u?{valid:!1,message:`Stock insuficiente. Stock disponible: ${u}`}:{valid:!0,message:""}},ne=async()=>{B.value=!0,l.value={},o.value="",b.value="";try{let t;n.value.id?t=await P.put(`/api/purchase-orders/${n.value.id}`,n.value):t=await P.post("/api/purchase-orders",n.value);const c=t.data.data||t.data;if(n.value.id){const v=d.value.findIndex(u=>u.id===n.value.id);v!==-1&&d.value.splice(v,1,c),w(p("purchase_orders_page.alerts.update_success"))}else d.value.unshift(c),w(p("purchase_orders_page.alerts.save_success"));return!0}catch(t){return t.response&&t.response.status===422?(l.value=t.response.data.errors,o.value=p("purchase_orders_page.alerts.validation_errors")):(console.error("Error saving order:",t),o.value=p("purchase_orders_page.alerts.save_error"),w(p("purchase_orders_page.alerts.save_error"),"error")),!1}finally{B.value=!1}},de=async t=>{var v;if(!t.can_be_deleted)return w(p("purchase_orders_page.alerts.cannot_delete"),"error"),!1;if((await E.fire({title:p("purchase_orders_page.delete_confirm.title"),text:p("purchase_orders_page.delete_confirm.text"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:p("purchase_orders_page.delete_confirm.confirm"),cancelButtonText:p("purchase_orders_page.delete_confirm.cancel")})).isConfirmed)try{return await P.delete(`/api/purchase-orders/${t.id}`),d.value=d.value.filter(u=>u.id!==t.id),w(p("purchase_orders_page.alerts.delete_success")),!0}catch(u){return console.error("Error deleting order:",u),((v=u.response)==null?void 0:v.status)===400?w(u.response.data.message,"error"):w(p("purchase_orders_page.alerts.delete_error"),"error"),!1}return!1},le=async t=>{var c,v;try{const u=await P.post(`/api/purchase-orders/${t.id}/submit`);if(u.data.success){const h=d.value.findIndex(g=>g.id===t.id);return h!==-1&&d.value.splice(h,1,u.data.order),w(p("purchase_orders_page.alerts.submit_success")),!0}else return w(u.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error submitting order:",u);const h=((v=(c=u.response)==null?void 0:c.data)==null?void 0:v.message)||p("purchase_orders_page.alerts.save_error");return w(h,"error"),!1}},ie=async t=>{var c,v;try{const u=await P.post(`/api/purchase-orders/${t.id}/approve`);if(u.data.success){const h=d.value.findIndex(g=>g.id===t.id);return h!==-1&&d.value.splice(h,1,u.data.order),w(p("purchase_orders_page.alerts.approve_success")),!0}else return w(u.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error approving order:",u);const h=((v=(c=u.response)==null?void 0:c.data)==null?void 0:v.message)||p("purchase_orders_page.alerts.save_error");return w(h,"error"),!1}},ce=async t=>{var v,u;const{value:c}=await E.fire({title:p("purchase_orders_page.reject_confirm.title"),input:"textarea",inputLabel:p("purchase_orders_page.reject_confirm.input_label"),inputPlaceholder:p("purchase_orders_page.reject_confirm.input_placeholder"),inputAttributes:{"aria-label":p("purchase_orders_page.reject_confirm.input_label")},showCancelButton:!0,confirmButtonText:p("purchase_orders_page.reject_confirm.confirm"),cancelButtonText:p("purchase_orders_page.reject_confirm.cancel"),inputValidator:h=>h?null:p("purchase_orders_page.reject_confirm.input_required")});if(c)try{const h=await P.post(`/api/purchase-orders/${t.id}/reject`,{rejection_reason:c});if(h.data.success){const g=d.value.findIndex(O=>O.id===t.id);return g!==-1&&d.value.splice(g,1,h.data.order),w(p("purchase_orders_page.alerts.reject_success")),!0}else return w(h.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(h){console.error("Error rejecting order:",h);const g=((u=(v=h.response)==null?void 0:v.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return w(g,"error"),!1}return!1},ue=async t=>{var c,v;try{const u=await P.post(`/api/purchase-orders/${t.id}/mark-ordered`);if(u.data.success){const h=d.value.findIndex(g=>g.id===t.id);return h!==-1&&d.value.splice(h,1,u.data.order),w(p("purchase_orders_page.alerts.mark_ordered_success")),!0}else return w(u.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error marking order as ordered:",u);const h=((v=(c=u.response)==null?void 0:c.data)==null?void 0:v.message)||p("purchase_orders_page.alerts.save_error");return w(h,"error"),!1}},Z=async t=>{var c,v;try{const u=await P.post(`/api/purchase-orders/${t.id}/receive`);if(u.data.success){const h=d.value.findIndex(g=>g.id===t.id);return h!==-1&&d.value.splice(h,1,u.data.order),w(p("purchase_orders_page.alerts.receive_success")),!0}else return w(u.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error receiving order:",u);const h=((v=(c=u.response)==null?void 0:c.data)==null?void 0:v.message)||p("purchase_orders_page.alerts.save_error");return w(h,"error"),!1}},pe=async t=>{var v,u;const{value:c}=await E.fire({title:p("purchase_orders_page.cancel_confirm.title"),input:"textarea",inputLabel:p("purchase_orders_page.cancel_confirm.input_label"),inputPlaceholder:p("purchase_orders_page.cancel_confirm.input_placeholder"),showCancelButton:!0,confirmButtonText:p("purchase_orders_page.cancel_confirm.confirm"),cancelButtonText:p("purchase_orders_page.cancel_confirm.cancel")});if(c!==void 0)try{const h=await P.post(`/api/purchase-orders/${t.id}/cancel`,{reason:c||null});if(h.data.success){const g=d.value.findIndex(O=>O.id===t.id);return g!==-1&&d.value.splice(g,1,h.data.order),w(p("purchase_orders_page.alerts.cancel_success")),!0}else return w(h.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(h){console.error("Error canceling order:",h);const g=((u=(v=h.response)==null?void 0:v.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return w(g,"error"),!1}return!1},_e=async t=>{var c,v;try{const u=await P.post(`/api/purchase-orders/${t.id}/reopen`);if(u.data.success){const h=d.value.findIndex(g=>g.id===t.id);return h!==-1&&d.value.splice(h,1,u.data.order),w(p("purchase_orders_page.alerts.reopen_success")),!0}else return w(u.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error reopening order:",u);const h=((v=(c=u.response)==null?void 0:c.data)==null?void 0:v.message)||p("purchase_orders_page.alerts.save_error");return w(h,"error"),!1}},me=(t=null)=>{var c,v,u;l.value={},t?n.value={id:t.id,supplier_id:t.supplier_id,expected_delivery_date:t.expected_delivery_date,notes:t.notes||"",tax:parseFloat(((c=t.tax)==null?void 0:c.toString())||"0"),shipping:parseFloat(((v=t.shipping)==null?void 0:v.toString())||"0"),items:((u=t.items)==null?void 0:u.map(h=>{var g;return{id:h.id,product_id:h.product_id,quantity:h.quantity,unit_price:parseFloat(((g=h.unit_price)==null?void 0:g.toString())||"0"),notes:h.notes||""}}))||[]}:(n.value={...s},n.value.items=[J()])},he=()=>{n.value={...s},l.value={}},J=()=>({product_id:null,quantity:1,unit_price:0,notes:""}),K=()=>{n.value.items.push(J())},ge=t=>{n.value.items.splice(t,1),n.value.items.length===0&&K()},W=t=>(t.quantity||0)*(t.unit_price||0),X=()=>n.value.items.reduce((c,v)=>c+W(v),0)+(n.value.tax||0)+(n.value.shipping||0),ve=t=>({draft:"bg-gray-100 text-gray-800",pending:"bg-warning/10 text-warning",approved:"bg-success/10 text-success",rejected:"bg-danger/10 text-danger",ordered:"bg-info/10 text-info",received:"bg-secondary/10 text-secondary",cancelled:"bg-danger/10 text-danger"})[t]||"bg-gray-100 text-gray-800",w=(t="",c="success")=>{c==="success"?b.value=t:o.value=t,E.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3}).fire({icon:c,title:t,padding:"10px 20px"})};return{ordersList:d,suppliers:f,products:q,loading:M,saving:B,errorMessage:o,successMessage:b,errors:l,searchOrder:a,filters:C,params:n,viewModal:k,filteredOrdersList:i,totalOrders:j,pendingOrders:$,approvedOrders:L,orderedOrders:I,receivedOrders:Y,fetchOrders:re,fetchSuppliers:te,fetchProducts:se,getProductInfo:H,updateItemUnitPrice:ae,validateQuantity:oe,saveOrder:ne,deleteOrder:de,submitOrder:le,approveOrder:ie,rejectOrder:ce,markAsOrdered:ue,receiveOrder:Z,cancelOrder:pe,reopenOrder:_e,editOrder:me,resetParams:he,addItem:K,removeItem:ge,calculateItemTotal:W,calculateOrderTotal:X,getStatusClass:ve,showMessage:w,moneyFormat:(t=0)=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),formatDate:t=>t?new Date(t).toLocaleDateString("es-ES"):"-",viewOrder:t=>{k.value={show:!0,data:t}},closeViewModal:()=>{k.value={show:!1,data:null}}}}const Te={class:"flex items-center justify-between flex-wrap gap-4"},Ie={class:"text-xl"},Fe={class:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4 w-full sm:w-auto"},Le={class:"flex gap-3"},Ue={class:"flex gap-2"},ze={value:""},Re={value:"draft"},Ne={value:"pending"},He={value:"approved"},Qe={value:"rejected"},Ge={value:"ordered"},Ye={value:"received"},Ze={value:"cancelled"},Je={value:""},Ke=["value"],We={class:"relative"},Xe=["placeholder","value"],er=N({__name:"PurchaseOrdersHeader",props:{filters:{},suppliers:{},searchOrder:{}},emits:["update:filters","update:search-order","add-order"],setup(p,{emit:d}){const f=p,q=d,M=ke(),B=S({...f.filters}),o=()=>{q("update:filters",{...B.value})};return Be(()=>f.filters,b=>{B.value={...b}},{deep:!0}),(b,l)=>(_(),m("div",Te,[e("h2",Ie,r(b.$t("purchase_orders_page.title")),1),e("div",Fe,[e("div",Le,[e("div",null,[y(M).can("create purchase_orders")?(_(),m("button",{key:0,type:"button",class:"btn btn-primary",onClick:l[0]||(l[0]=a=>b.$emit("add-order"))},[l[4]||(l[4]=e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 ltr:mr-2 rtl:ml-2"},[e("path",{d:"M12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22Z",stroke:"currentColor","stroke-width":"1.5"}),e("path",{opacity:"0.5",d:"M8 12H16",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{opacity:"0.5",d:"M12 16V8",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1)),z(" "+r(b.$t("purchase_orders_page.add_order_btn")),1)])):x("",!0)])]),e("div",Ue,[A(e("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>B.value.status=a),class:"form-select py-2",onChange:o},[e("option",ze,r(b.$t("purchase_orders_page.filters.all_status")),1),e("option",Re,r(b.$t("purchase_orders_page.filters.draft")),1),e("option",Ne,r(b.$t("purchase_orders_page.filters.pending")),1),e("option",He,r(b.$t("purchase_orders_page.filters.approved")),1),e("option",Qe,r(b.$t("purchase_orders_page.filters.rejected")),1),e("option",Ge,r(b.$t("purchase_orders_page.filters.ordered")),1),e("option",Ye,r(b.$t("purchase_orders_page.filters.received")),1),e("option",Ze,r(b.$t("purchase_orders_page.filters.cancelled")),1)],544),[[ee,B.value.status]]),A(e("select",{"onUpdate:modelValue":l[2]||(l[2]=a=>B.value.supplier_id=a),class:"form-select py-2",onChange:o},[e("option",Je,r(b.$t("purchase_orders_page.filters.all_suppliers")),1),(_(!0),m(F,null,R(b.suppliers,a=>(_(),m("option",{key:a.id,value:a.id},r(a.name),9,Ke))),128))],544),[[ee,B.value.supplier_id]])]),e("div",We,[e("input",{type:"text",placeholder:b.$t("purchase_orders_page.search_placeholder"),class:"form-input py-2 ltr:pr-11 rtl:pl-11 peer",value:b.searchOrder,onInput:l[3]||(l[3]=a=>b.$emit("update:search-order",a.target.value))},null,40,Xe),l[5]||(l[5]=e("div",{class:"absolute ltr:right-[11px] rtl:left-[11px] top-1/2 -translate-y-1/2 peer-focus:text-primary"},[e("svg",{class:"mx-auto",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{cx:"11.5",cy:"11.5",r:"9.5",stroke:"currentColor","stroke-width":"1.5",opacity:"0.5"}),e("path",{d:"M18.5 18.5L22 22",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})])],-1))])])]))}}),rr={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mt-6"},tr={class:"bg-white dark:bg-[#1c232f] rounded-md border border-[#e0e6ed] dark:border-[#1b2e4b] p-4"},sr={class:"flex items-center justify-between"},ar={class:"text-lg font-semibold"},or={class:"text-gray-500 dark:text-gray-400 text-sm"},nr={class:"bg-white dark:bg-[#1c232f] rounded-md border border-[#e0e6ed] dark:border-[#1b2e4b] p-4"},dr={class:"flex items-center justify-between"},lr={class:"text-lg font-semibold"},ir={class:"text-gray-500 dark:text-gray-400 text-sm"},cr={class:"bg-white dark:bg-[#1c232f] rounded-md border border-[#e0e6ed] dark:border-[#1b2e4b] p-4"},ur={class:"flex items-center justify-between"},pr={class:"text-lg font-semibold"},_r={class:"text-gray-500 dark:text-gray-400 text-sm"},mr={class:"bg-white dark:bg-[#1c232f] rounded-md border border-[#e0e6ed] dark:border-[#1b2e4b] p-4"},hr={class:"flex items-center justify-between"},gr={class:"text-lg font-semibold"},vr={class:"text-gray-500 dark:text-gray-400 text-sm"},fr={class:"bg-white dark:bg-[#1c232f] rounded-md border border-[#e0e6ed] dark:border-[#1b2e4b] p-4"},br={class:"flex items-center justify-between"},yr={class:"text-lg font-semibold"},$r={class:"text-gray-500 dark:text-gray-400 text-sm"},wr=N({__name:"PurchaseOrdersStats",props:{totalOrders:{},pendingOrders:{},approvedOrders:{},orderedOrders:{},receivedOrders:{}},setup(p){return(d,f)=>(_(),m("div",rr,[e("div",tr,[e("div",sr,[e("div",null,[e("div",ar,r(d.totalOrders),1),e("div",or,r(d.$t("purchase_orders_page.stats.total_orders")),1)]),f[0]||(f[0]=e("div",{class:"p-2 rounded-full bg-primary/10 text-primary"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1))])]),e("div",nr,[e("div",dr,[e("div",null,[e("div",lr,r(d.pendingOrders),1),e("div",ir,r(d.$t("purchase_orders_page.stats.pending_orders")),1)]),f[1]||(f[1]=e("div",{class:"p-2 rounded-full bg-warning/10 text-warning"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",cr,[e("div",ur,[e("div",null,[e("div",pr,r(d.approvedOrders),1),e("div",_r,r(d.$t("purchase_orders_page.stats.approved_orders")),1)]),f[2]||(f[2]=e("div",{class:"p-2 rounded-full bg-success/10 text-success"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",mr,[e("div",hr,[e("div",null,[e("div",gr,r(d.orderedOrders),1),e("div",vr,r(d.$t("purchase_orders_page.stats.ordered_orders")),1)]),f[3]||(f[3]=e("div",{class:"p-2 rounded-full bg-info/10 text-info"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})])],-1))])]),e("div",fr,[e("div",br,[e("div",null,[e("div",yr,r(d.receivedOrders),1),e("div",$r,r(d.$t("purchase_orders_page.stats.received_orders")),1)]),f[4]||(f[4]=e("div",{class:"p-2 rounded-full bg-secondary/10 text-secondary"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1))])])]))}}),kr={class:"panel p-0 border-0 overflow-hidden"},xr={class:"table-responsive"},Cr={class:"table-striped table-hover"},Or={class:"!text-center"},Br={key:0},jr={key:1},qr={colspan:"8",class:"text-center py-8 text-gray-500"},Mr={class:"font-mono font-semibold"},Sr={class:"font-semibold"},Pr={class:"text-xs text-gray-500"},Vr={class:"font-semibold text-success"},Er={class:"text-sm"},Dr={class:"text-xs text-gray-500"},Ar={class:"flex gap-2 items-center justify-center"},Tr=["onClick","title"],Ir=["onClick","title"],Fr=["onClick","title"],Lr=["onClick","title"],Ur=["onClick","title"],zr=["onClick","title"],Rr=["onClick","title"],Nr=["onClick","title"],Hr=["onClick","title"],Qr=["onClick","title"],Gr=N({__name:"PurchaseOrdersListView",props:{orders:{},loading:{type:Boolean}},emits:["view-order","edit-order","delete-order","submit-order","approve-order","reject-order","mark-ordered","receive-order","cancel-order","reopen-order"],setup(p){const d=ke(),f=o=>({draft:"bg-gray-100 text-gray-800",pending:"bg-warning/10 text-warning",approved:"bg-success/10 text-success",rejected:"bg-danger/10 text-danger",ordered:"bg-info/10 text-info",received:"bg-secondary/10 text-secondary",cancelled:"bg-danger/10 text-danger"})[o]||"bg-gray-100 text-gray-800",q=o=>!o.expected_delivery_date||o.status==="received"?!1:new Date(o.expected_delivery_date)<new Date,M=o=>o?new Date(o).toLocaleDateString("es-ES"):"-",B=(o=0)=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(o);return(o,b)=>(_(),m("div",kr,[e("div",xr,[e("table",Cr,[e("thead",null,[e("tr",null,[e("th",null,r(o.$t("purchase_orders_page.table.order_number")),1),e("th",null,r(o.$t("purchase_orders_page.table.supplier")),1),e("th",null,r(o.$t("purchase_orders_page.table.order_date")),1),e("th",null,r(o.$t("purchase_orders_page.table.expected_delivery")),1),e("th",null,r(o.$t("purchase_orders_page.table.total")),1),e("th",null,r(o.$t("purchase_orders_page.table.status")),1),e("th",null,r(o.$t("purchase_orders_page.table.created_by")),1),e("th",Or,r(o.$t("purchase_orders_page.table.actions")),1)])]),e("tbody",null,[o.loading?(_(),m("tr",Br,[...b[0]||(b[0]=[e("td",{colspan:"8",class:"text-center py-4"},[e("div",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-6 h-6 mx-auto"})],-1)])])):o.orders.length===0?(_(),m("tr",jr,[e("td",qr,r(o.$t("purchase_orders_page.alerts.no_orders")),1)])):(_(!0),m(F,{key:2},R(o.orders,l=>{var a,k,C;return _(),m("tr",{key:l.id},[e("td",null,[e("div",Mr,r(l.order_number),1)]),e("td",null,[e("div",Sr,r(((a=l.supplier)==null?void 0:a.name)||"N/A"),1),e("div",Pr,r(((k=l.supplier)==null?void 0:k.contact_person)||"-"),1)]),e("td",null,[e("div",null,r(M(l.order_date)),1)]),e("td",null,[e("div",{class:V({"text-warning":q(l)})},r(M(l.expected_delivery_date)),3)]),e("td",null,[e("div",Vr,r(B(l.total)),1)]),e("td",null,[e("span",{class:V(["badge",f(l.status)])},r(o.$t(`purchase_orders_page.status.${l.status}`)),3)]),e("td",null,[e("div",Er,r(((C=l.creator)==null?void 0:C.name)||"N/A"),1),e("div",Dr,r(M(l.created_at)),1)]),e("td",null,[e("div",Ar,[e("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:s=>o.$emit("view-order",l),title:o.$t("purchase_orders_page.actions.view")},r(o.$t("purchase_orders_page.actions.view")),9,Tr),y(d).can("edit purchase_orders")&&l.can_be_edited?(_(),m("button",{key:0,type:"button",class:"btn btn-sm btn-outline-primary",onClick:s=>o.$emit("edit-order",l),title:o.$t("purchase_orders_page.actions.edit")},r(o.$t("purchase_orders_page.actions.edit")),9,Ir)):x("",!0),y(d).can("delete purchase_orders")&&l.can_be_deleted?(_(),m("button",{key:1,type:"button",class:"btn btn-sm btn-outline-danger",onClick:s=>o.$emit("delete-order",l),title:o.$t("purchase_orders_page.actions.delete")},r(o.$t("purchase_orders_page.actions.delete")),9,Fr)):x("",!0),y(d).can("edit purchase_orders")&&l.status==="draft"?(_(),m("button",{key:2,type:"button",class:"btn btn-sm btn-outline-success",onClick:s=>o.$emit("submit-order",l),title:o.$t("purchase_orders_page.actions.submit")},r(o.$t("purchase_orders_page.actions.submit")),9,Lr)):x("",!0),y(d).can("approve purchase_orders")&&l.can_be_approved?(_(),m("button",{key:3,type:"button",class:"btn btn-sm btn-outline-success",onClick:s=>o.$emit("approve-order",l),title:o.$t("purchase_orders_page.actions.approve")},r(o.$t("purchase_orders_page.actions.approve")),9,Ur)):x("",!0),y(d).can("approve purchase_orders")&&l.can_be_rejected?(_(),m("button",{key:4,type:"button",class:"btn btn-sm btn-outline-danger",onClick:s=>o.$emit("reject-order",l),title:o.$t("purchase_orders_page.actions.reject")},r(o.$t("purchase_orders_page.actions.reject")),9,zr)):x("",!0),y(d).can("edit purchase_orders")&&l.can_be_marked_ordered?(_(),m("button",{key:5,type:"button",class:"btn btn-sm btn-outline-info",onClick:s=>o.$emit("mark-ordered",l),title:o.$t("purchase_orders_page.actions.mark_ordered")},r(o.$t("purchase_orders_page.actions.mark_ordered")),9,Rr)):x("",!0),y(d).can("receive purchase_orders")&&l.can_be_received?(_(),m("button",{key:6,type:"button",class:"btn btn-sm btn-outline-secondary",onClick:s=>o.$emit("receive-order",l),title:o.$t("purchase_orders_page.actions.receive")},r(o.$t("purchase_orders_page.actions.receive")),9,Nr)):x("",!0),y(d).can("edit purchase_orders")&&l.can_be_cancelled?(_(),m("button",{key:7,type:"button",class:"btn btn-sm btn-outline-warning",onClick:s=>o.$emit("cancel-order",l),title:o.$t("purchase_orders_page.actions.cancel")},r(o.$t("purchase_orders_page.actions.cancel")),9,Hr)):x("",!0),y(d).can("edit purchase_orders")&&l.can_be_reopened?(_(),m("button",{key:8,type:"button",class:"btn btn-sm btn-outline-info",onClick:s=>o.$emit("reopen-order",l),title:o.$t("purchase_orders_page.actions.reopen")},r(o.$t("purchase_orders_page.actions.reopen")),9,Qr)):x("",!0)])])])}),128))])])])]))}}),Yr=xe(Gr,[["__scopeId","data-v-d1acd106"]]),Zr={key:0,class:"fixed inset-0 bg-[black]/60 z-50 overflow-y-auto"},Jr={class:"flex items-start justify-center min-h-screen px-4"},Kr={class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl my-8"},Wr={class:"flex bg-[#fbfbfb] dark:bg-[#1c232f] items-center justify-between px-5 py-3"},Xr={class:"font-bold text-lg"},et={class:"p-5"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5"},tt={for:"supplier",class:"form-label"},st={value:""},at=["value"],ot={key:0,class:"text-danger mt-1 text-xs"},nt={for:"expected_delivery_date",class:"form-label"},dt={key:0,class:"text-danger mt-1 text-xs"},lt={class:"mb-5"},it={class:"flex justify-between items-center mb-3"},ct={class:"form-label"},ut={class:"space-y-4"},pt={class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-start"},_t={class:"md:col-span-4"},mt={class:"form-label"},ht=["onUpdate:modelValue","onChange"],gt={value:""},vt=["value","disabled"],ft={key:0,class:"text-danger text-xs"},bt={key:1,class:"text-success text-xs"},yt={key:0,class:"text-danger mt-1 text-xs"},$t={class:"md:col-span-2"},wt={class:"form-label"},kt=["onUpdate:modelValue","max","onInput"],xt={key:0,class:"text-danger mt-1 text-xs"},Ct={key:1,class:"text-danger mt-1 text-xs"},Ot={key:2,class:"text-info mt-1 text-xs"},Bt={class:"md:col-span-2"},jt={class:"form-label"},qt=["value"],Mt={class:"md:col-span-2"},St={class:"form-label"},Pt=["value"],Vt={class:"md:col-span-2"},Et=["onClick","disabled"],Dt={class:"mt-3"},At={class:"form-label"},Tt=["onUpdate:modelValue","placeholder"],It={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-5"},Ft={for:"tax",class:"form-label"},Lt=["placeholder"],Ut={key:0,class:"text-danger mt-1 text-xs"},zt={for:"shipping",class:"form-label"},Rt=["placeholder"],Nt={key:0,class:"text-danger mt-1 text-xs"},Ht={class:"form-input bg-success/10 text-success dark:bg-success/20 font-bold text-lg text-center"},Qt={class:"mb-5"},Gt={for:"notes",class:"form-label"},Yt=["placeholder"],Zt={class:"flex justify-end items-center mt-8 border-t pt-4"},Jt=["disabled"],Kt=["disabled"],Wt={key:0,class:"flex items-center"},Xt={key:1},es=N({__name:"PurchaseOrderModal",props:{show:{type:Boolean},params:{},errors:{},saving:{type:Boolean},suppliers:{},products:{}},emits:["close","save","add-item","remove-item","product-change"],setup(p,{emit:d}){const f=p,q=T(()=>f.products.filter(s=>s.is_active!==!1)),M=T(()=>{const s=f.params.items.length>0&&f.params.items.every(n=>n.product_id&&n.quantity>0&&n.quantity<=o(n.product_id));return f.params.supplier_id&&f.params.expected_delivery_date&&s}),B=(s,n)=>{n<1&&(f.params.items[s].quantity=1);const i=o(f.params.items[s].product_id);n>i&&(f.params.items[s].quantity=i)},o=s=>{if(!s)return 0;const n=f.products.find(i=>i.id===s);return(n==null?void 0:n.stock)||0},b=s=>{if(!s)return 0;const n=f.products.find(i=>i.id===s);return(n==null?void 0:n.price)||0},l=(s,n)=>{if(!s)return{hasError:!1,message:""};const i=o(s);return n>i?{hasError:!0,message:`Excede stock disponible (${i})`}:{hasError:!1,message:""}},a=s=>(s.quantity||0)*(b(s.product_id)||0),k=()=>f.params.items.reduce((n,i)=>n+a(i),0)+(f.params.tax||0)+(f.params.shipping||0),C=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s);return(s,n)=>s.show?(_(),m("div",Zr,[e("div",Jr,[e("div",Kr,[e("div",Wr,[e("h5",Xr,r(s.params.id?s.$t("purchase_orders_page.create_modal.edit_title"):s.$t("purchase_orders_page.create_modal.add_title")),1),e("button",{type:"button",class:"text-white-dark hover:text-dark",onClick:n[0]||(n[0]=i=>s.$emit("close"))},[...n[9]||(n[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",et,[e("form",{onSubmit:n[8]||(n[8]=je(i=>s.$emit("save",s.params),["prevent"]))},[e("div",rt,[e("div",null,[e("label",tt,r(s.$t("purchase_orders_page.create_modal.fields.supplier"))+" * ",1),A(e("select",{id:"supplier","onUpdate:modelValue":n[1]||(n[1]=i=>s.params.supplier_id=i),class:V(["form-select",{"border-danger":s.errors.supplier_id}]),required:""},[e("option",st,r(s.$t("purchase_orders_page.create_modal.placeholders.select_supplier")),1),(_(!0),m(F,null,R(s.suppliers,i=>(_(),m("option",{key:i.id,value:i.id},r(i.name),9,at))),128))],2),[[ee,s.params.supplier_id]]),s.errors.supplier_id?(_(),m("div",ot,r(s.errors.supplier_id[0]),1)):x("",!0)]),e("div",null,[e("label",nt,r(s.$t("purchase_orders_page.create_modal.fields.expected_delivery_date"))+" * ",1),A(e("input",{id:"expected_delivery_date",type:"date","onUpdate:modelValue":n[2]||(n[2]=i=>s.params.expected_delivery_date=i),class:V(["form-input",{"border-danger":s.errors.expected_delivery_date}]),required:""},null,2),[[U,s.params.expected_delivery_date]]),s.errors.expected_delivery_date?(_(),m("div",dt,r(s.errors.expected_delivery_date[0]),1)):x("",!0)])]),e("div",lt,[e("div",it,[e("label",ct,r(s.$t("purchase_orders_page.create_modal.fields.items"))+" * ",1),e("button",{type:"button",class:"btn btn-primary btn-sm",onClick:n[3]||(n[3]=i=>s.$emit("add-item"))}," + "+r(s.$t("purchase_orders_page.create_modal.buttons.add_item")),1)]),e("div",ut,[(_(!0),m(F,null,R(s.params.items,(i,j)=>(_(),m("div",{key:j,class:"border border-[#e0e6ed] dark:border-[#1b2e4b] rounded p-4 bg-gray-50 dark:bg-[#1a2234]"},[e("div",pt,[e("div",_t,[e("label",mt,r(s.$t("purchase_orders_page.create_modal.fields.product"))+" * ",1),A(e("select",{"onUpdate:modelValue":$=>i.product_id=$,class:V(["form-select",{"border-danger":s.errors[`items.${j}.product_id`]||!i.product_id&&i.quantity>0}]),onChange:$=>s.$emit("product-change",{index:j,productId:i.product_id}),required:""},[e("option",gt,r(s.$t("purchase_orders_page.create_modal.placeholders.select_product")),1),(_(!0),m(F,null,R(q.value,$=>(_(),m("option",{key:$.id,value:$.id,disabled:!$.stock||$.stock<=0},[z(r($.name)+" ",1),!$.stock||$.stock<=0?(_(),m("span",ft," (Sin stock) ")):(_(),m("span",bt," (Stock: "+r($.stock)+") ",1))],8,vt))),128))],42,ht),[[ee,i.product_id]]),s.errors[`items.${j}.product_id`]?(_(),m("div",yt,r(s.errors[`items.${j}.product_id`][0]),1)):x("",!0)]),e("div",$t,[e("label",wt,r(s.$t("purchase_orders_page.create_modal.fields.quantity"))+" * ",1),A(e("input",{type:"number","onUpdate:modelValue":$=>i.quantity=$,min:"1",max:o(i.product_id),class:V(["form-input",{"border-danger":s.errors[`items.${j}.quantity`]||l(i.product_id,i.quantity).hasError}]),onInput:$=>B(j,i.quantity),required:""},null,42,kt),[[U,i.quantity,void 0,{number:!0}]]),s.errors[`items.${j}.quantity`]?(_(),m("div",xt,r(s.errors[`items.${j}.quantity`][0]),1)):x("",!0),l(i.product_id,i.quantity).hasError?(_(),m("div",Ct,r(l(i.product_id,i.quantity).message),1)):x("",!0),i.product_id&&o(i.product_id)>0?(_(),m("div",Ot," Máx: "+r(o(i.product_id)),1)):x("",!0)]),e("div",Bt,[e("label",jt,r(s.$t("purchase_orders_page.create_modal.fields.unit_price")),1),e("input",{type:"text",value:C(b(i.product_id)),class:"form-input bg-gray-100 dark:bg-[#1b2e4b] cursor-not-allowed",readonly:"",disabled:""},null,8,qt),n[10]||(n[10]=e("div",{class:"text-xs text-gray-500 mt-1"}," Precio del producto ",-1))]),e("div",Mt,[e("label",St,r(s.$t("purchase_orders_page.create_modal.fields.total_price")),1),e("input",{type:"text",value:C(a(i)),class:"form-input bg-gray-100 dark:bg-[#1b2e4b] font-semibold cursor-not-allowed",readonly:"",disabled:""},null,8,Pt)]),e("div",Vt,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm w-full",onClick:$=>s.$emit("remove-item",j),disabled:s.params.items.length===1},r(s.$t("purchase_orders_page.create_modal.buttons.remove_item")),9,Et)])]),e("div",Dt,[e("label",At,r(s.$t("purchase_orders_page.create_modal.fields.item_notes")),1),A(e("textarea",{"onUpdate:modelValue":$=>i.notes=$,class:"form-textarea min-h-[60px]",placeholder:s.$t("purchase_orders_page.create_modal.placeholders.item_notes"),rows:"2"},null,8,Tt),[[U,i.notes]])])]))),128))])]),e("div",It,[e("div",null,[e("label",Ft,r(s.$t("purchase_orders_page.create_modal.fields.tax")),1),A(e("input",{id:"tax",type:"number","onUpdate:modelValue":n[4]||(n[4]=i=>s.params.tax=i),min:"0",step:"0.01",class:V(["form-input",{"border-danger":s.errors.tax}]),placeholder:s.$t("purchase_orders_page.create_modal.placeholders.tax")},null,10,Lt),[[U,s.params.tax,void 0,{number:!0}]]),s.errors.tax?(_(),m("div",Ut,r(s.errors.tax[0]),1)):x("",!0)]),e("div",null,[e("label",zt,r(s.$t("purchase_orders_page.create_modal.fields.shipping")),1),A(e("input",{id:"shipping",type:"number","onUpdate:modelValue":n[5]||(n[5]=i=>s.params.shipping=i),min:"0",step:"0.01",class:V(["form-input",{"border-danger":s.errors.shipping}]),placeholder:s.$t("purchase_orders_page.create_modal.placeholders.shipping")},null,10,Rt),[[U,s.params.shipping,void 0,{number:!0}]]),s.errors.shipping?(_(),m("div",Nt,r(s.errors.shipping[0]),1)):x("",!0)]),e("div",null,[n[11]||(n[11]=e("label",{class:"form-label text-lg font-bold"}," Total General ",-1)),e("div",Ht,r(C(k())),1)])]),e("div",Qt,[e("label",Gt,r(s.$t("purchase_orders_page.create_modal.fields.notes")),1),A(e("textarea",{id:"notes","onUpdate:modelValue":n[6]||(n[6]=i=>s.params.notes=i),class:"form-textarea min-h-[80px]",placeholder:s.$t("purchase_orders_page.create_modal.placeholders.notes"),rows:"3"},null,8,Yt),[[U,s.params.notes]])]),e("div",Zt,[e("button",{type:"button",class:"btn btn-outline-danger mr-3",onClick:n[7]||(n[7]=i=>s.$emit("close")),disabled:s.saving},r(s.$t("purchase_orders_page.create_modal.buttons.cancel")),9,Jt),e("button",{type:"submit",class:"btn btn-primary",disabled:s.saving||!M.value},[s.saving?(_(),m("span",Wt,[n[12]||(n[12]=e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),z(" "+r(s.$t("purchase_orders_page.create_modal.buttons.saving")),1)])):(_(),m("span",Xt,r(s.params.id?s.$t("purchase_orders_page.create_modal.buttons.update"):s.$t("purchase_orders_page.create_modal.buttons.add")),1))],8,Kt)])],32)])])])])):x("",!0)}}),rs={class:"fixed inset-0 overflow-y-auto"},ts={class:"flex min-h-full items-center justify-center px-4 py-8"},ss={class:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},as={key:0},os={key:1,class:"text-gray-500"},ns={class:"p-5"},ds={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ls={class:"space-y-4"},is={class:"font-semibold text-gray-600"},cs={class:"text-lg"},us={class:"text-sm text-gray-500"},ps={class:"text-sm text-gray-500"},_s={class:"font-semibold text-gray-600"},ms={class:"font-semibold text-gray-600"},hs={class:"text-sm text-gray-500"},gs={class:"space-y-4"},vs={class:"font-semibold text-gray-600"},fs={class:"font-semibold text-gray-600"},bs={key:0,class:"text-xs ml-2"},ys={key:1,class:"text-xs ml-2 text-success"},$s={key:0},ws={class:"font-semibold text-gray-600"},ks={key:1},xs={class:"font-semibold text-gray-600"},Cs={class:"text-sm text-gray-500"},Os={class:"mb-6"},Bs={class:"text-lg font-semibold mb-4"},js={class:"table-responsive"},qs={class:"table-striped table-hover"},Ms={class:"text-center"},Ss={class:"text-center"},Ps={class:"text-center"},Vs={class:"text-right"},Es={class:"text-right"},Ds={class:"font-semibold"},As={class:"text-sm text-gray-500"},Ts={key:0,class:"text-xs text-gray-400"},Is={class:"text-center"},Fs={class:"text-center"},Ls={class:"text-center"},Us={class:"text-right"},zs={class:"text-right font-semibold"},Rs={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ns={class:"space-y-2"},Hs={key:0},Qs={class:"font-semibold text-gray-600"},Gs={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded"},Ys={key:1},Zs={class:"font-semibold text-danger"},Js={class:"bg-danger/10 text-danger p-3 rounded"},Ks={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4"},Ws={class:"font-semibold mb-3"},Xs={class:"space-y-2"},ea={class:"flex justify-between"},ra={class:"font-semibold"},ta={class:"flex justify-between"},sa={class:"font-semibold"},aa={class:"flex justify-between"},oa={class:"font-semibold"},na={class:"flex justify-between text-lg font-bold"},da={class:"text-success"},la={class:"flex justify-end items-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},ia={key:1,class:"text-center py-8"},ca={class:"text-gray-500"},ua=N({__name:"PurchaseOrderViewModal",props:{show:{type:Boolean},order:{}},emits:["close"],setup(p,{emit:d}){const f=a=>({draft:"bg-gray-100 text-gray-800",pending:"bg-warning/10 text-warning",approved:"bg-success/10 text-success",rejected:"bg-danger/10 text-danger",ordered:"bg-info/10 text-info",received:"bg-secondary/10 text-secondary",cancelled:"bg-danger/10 text-danger"})[a]||"bg-gray-100 text-gray-800",q=a=>a.received_quantity===0?"text-danger":a.received_quantity<a.quantity?"text-warning":"text-success",M=a=>{const k=a.quantity-a.received_quantity;return k===0?"text-success":k>0?"text-warning":"text-danger"},B=a=>a.expected_delivery_date?new Date(a.expected_delivery_date)<new Date&&a.status!=="received":!1,o=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"-",b=(a=0)=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),l=()=>{window.print()};return(a,k)=>(_(),qe(y(De),{appear:"",show:a.show,as:"template"},{default:G(()=>[D(y(Pe),{as:"div",onClose:k[2]||(k[2]=C=>a.$emit("close")),class:"relative z-[51]"},{default:G(()=>[D(y(we),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:G(()=>[D(y(Ve),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",rs,[e("div",ts,[D(y(we),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:G(()=>[D(y(Ee),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-4xl text-black dark:text-white-dark"},{default:G(()=>{var C,s,n,i,j;return[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:k[0]||(k[0]=$=>a.$emit("close"))},[...k[3]||(k[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),e("div",ss,[z(r(a.$t("purchase_orders_page.view_modal.title"))+" ",1),a.order?(_(),m("span",as,r(a.order.order_number),1)):(_(),m("span",os,r(a.$t("purchase_orders_page.view_modal.status.loading")),1))]),e("div",ns,[a.order?(_(),m(F,{key:0},[e("div",ds,[e("div",ls,[e("div",null,[e("label",is,r(a.$t("purchase_orders_page.view_modal.fields.supplier"))+": ",1),e("p",cs,r((C=a.order.supplier)==null?void 0:C.name),1),e("p",us,r((s=a.order.supplier)==null?void 0:s.contact_person),1),e("p",ps,r((n=a.order.supplier)==null?void 0:n.email),1)]),e("div",null,[e("label",_s,r(a.$t("purchase_orders_page.view_modal.fields.status"))+": ",1),e("span",{class:V(["badge ml-2",f(a.order.status)])},r(a.$t(`purchase_orders_page.status.${a.order.status}`)),3)]),e("div",null,[e("label",ms,r(a.$t("purchase_orders_page.view_modal.fields.created_by"))+": ",1),e("p",null,r((i=a.order.creator)==null?void 0:i.name),1),e("p",hs,r(o(a.order.created_at)),1)])]),e("div",gs,[e("div",null,[e("label",vs,r(a.$t("purchase_orders_page.view_modal.fields.order_date"))+": ",1),e("p",null,r(o(a.order.order_date)),1)]),e("div",null,[e("label",fs,r(a.$t("purchase_orders_page.view_modal.fields.expected_delivery"))+": ",1),e("p",{class:V({"text-warning":B(a.order)})},[z(r(o(a.order.expected_delivery_date))+" ",1),B(a.order)?(_(),m("span",bs," ("+r(a.$t("purchase_orders_page.view_modal.delivery_status.delayed"))+") ",1)):a.order.expected_delivery_date?(_(),m("span",ys," ("+r(a.$t("purchase_orders_page.view_modal.delivery_status.on_time"))+") ",1)):x("",!0)],2)]),a.order.delivery_date?(_(),m("div",$s,[e("label",ws,r(a.$t("purchase_orders_page.view_modal.fields.delivery_date"))+": ",1),e("p",null,r(o(a.order.delivery_date)),1)])):x("",!0),a.order.approved_by?(_(),m("div",ks,[e("label",xs,r(a.$t("purchase_orders_page.view_modal.fields.approved_by"))+": ",1),e("p",null,r((j=a.order.approver)==null?void 0:j.name),1),e("p",Cs,r(o(a.order.approved_at)),1)])):x("",!0)])]),e("div",Os,[e("h3",Bs,r(a.$t("purchase_orders_page.view_modal.sections.order_items")),1),e("div",js,[e("table",qs,[e("thead",null,[e("tr",null,[e("th",null,r(a.$t("purchase_orders_page.view_modal.fields.product")),1),e("th",Ms,r(a.$t("purchase_orders_page.view_modal.fields.quantity")),1),e("th",Ss,r(a.$t("purchase_orders_page.view_modal.fields.received")),1),e("th",Ps,r(a.$t("purchase_orders_page.view_modal.fields.pending")),1),e("th",Vs,r(a.$t("purchase_orders_page.view_modal.fields.unit_price")),1),e("th",Es,r(a.$t("purchase_orders_page.view_modal.fields.total")),1)])]),e("tbody",null,[(_(!0),m(F,null,R(a.order.items,$=>{var L,I;return _(),m("tr",{key:$.id},[e("td",null,[e("div",Ds,r((L=$.product)==null?void 0:L.name),1),e("div",As,r((I=$.product)==null?void 0:I.sku),1),$.notes?(_(),m("div",Ts,r($.notes),1)):x("",!0)]),e("td",Is,r($.quantity),1),e("td",Fs,[e("span",{class:V(q($))},r($.received_quantity),3)]),e("td",Ls,[e("span",{class:V(M($))},r($.quantity-$.received_quantity),3)]),e("td",Us,r(b($.unit_price)),1),e("td",zs,r(b($.total_price)),1)])}),128))])])])]),e("div",Rs,[e("div",Ns,[a.order.notes?(_(),m("div",Hs,[e("label",Qs,r(a.$t("purchase_orders_page.view_modal.fields.notes"))+": ",1),e("p",Gs,r(a.order.notes),1)])):x("",!0),a.order.rejection_reason?(_(),m("div",Ys,[e("label",Zs,r(a.$t("purchase_orders_page.view_modal.fields.rejection_reason"))+": ",1),e("p",Js,r(a.order.rejection_reason),1)])):x("",!0)]),e("div",Ks,[e("h4",Ws,r(a.$t("purchase_orders_page.view_modal.sections.totals_summary")),1),e("div",Xs,[e("div",ea,[e("span",null,r(a.$t("purchase_orders_page.view_modal.fields.subtotal"))+":",1),e("span",ra,r(b(a.order.subtotal)),1)]),e("div",ta,[e("span",null,r(a.$t("purchase_orders_page.view_modal.fields.tax"))+":",1),e("span",sa,r(b(a.order.tax)),1)]),e("div",aa,[e("span",null,r(a.$t("purchase_orders_page.view_modal.fields.shipping"))+":",1),e("span",oa,r(b(a.order.shipping)),1)]),k[4]||(k[4]=e("hr",{class:"my-2"},null,-1)),e("div",na,[e("span",null,r(a.$t("purchase_orders_page.view_modal.fields.grand_total"))+":",1),e("span",da,r(b(a.order.total)),1)])])])]),e("div",la,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:l},[k[5]||(k[5]=e("svg",{class:"w-4 h-4 ltr:mr-2 rtl:ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)),z(" "+r(a.$t("purchase_orders_page.view_modal.buttons.print")),1)]),e("button",{type:"button",class:"btn btn-outline-danger ltr:ml-4 rtl:mr-4",onClick:k[1]||(k[1]=$=>a.$emit("close"))},r(a.$t("purchase_orders_page.view_modal.buttons.close")),1)])],64)):(_(),m("div",ia,[k[6]||(k[6]=e("div",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-8 h-8 mx-auto mb-4"},null,-1)),e("p",ca,r(a.$t("purchase_orders_page.view_modal.status.loading")),1)]))])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),pa=xe(ua,[["__scopeId","data-v-9de4a1c6"]]),_a={class:"mt-5"},ka=N({__name:"PurchaseOrders",setup(p){Oe({title:"Gestión de Órdenes de Compra"});const d=S(!1),{suppliers:f,products:q,loading:M,saving:B,errorMessage:o,successMessage:b,errors:l,searchOrder:a,filters:k,params:C,filteredOrdersList:s,totalOrders:n,pendingOrders:i,approvedOrders:j,orderedOrders:$,receivedOrders:L,viewModal:I,fetchOrders:Y,fetchSuppliers:re,fetchProducts:te,updateItemUnitPrice:se,saveOrder:H,deleteOrder:ae,submitOrder:oe,approveOrder:ne,rejectOrder:de,markAsOrdered:le,receiveOrder:ie,cancelOrder:ce,reopenOrder:ue,editOrder:Z,resetParams:pe,addItem:_e,removeItem:me,viewOrder:he,closeViewModal:J}=Ae();Me(()=>{Y(),re(),te()});const K=()=>{Z(null),d.value=!0},ge=g=>{Z(g),d.value=!0},W=g=>{he(g)},X=()=>{d.value=!1,pe()},ve=async()=>{await H()&&X()},w=async g=>{await ae(g)},fe=async g=>{(await E.fire({title:"Enviar a Aprobación",text:"¿Estás seguro de que deseas enviar esta orden para aprobación?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, enviar",cancelButtonText:"Cancelar"})).isConfirmed&&await oe(g)},be=async g=>{(await E.fire({title:"Aprobar Orden",text:"¿Estás seguro de que deseas aprobar esta orden?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, aprobar",cancelButtonText:"Cancelar"})).isConfirmed&&await ne(g)},ye=async g=>{const{value:O}=await E.fire({title:"Rechazar Orden",input:"textarea",inputLabel:"Por favor ingrese el motivo del rechazo:",inputPlaceholder:"Describa el motivo del rechazo...",inputAttributes:{"aria-label":"Motivo del rechazo"},showCancelButton:!0,confirmButtonText:"Rechazar",cancelButtonText:"Cancelar",inputValidator:Q=>{if(!Q)return"Debe ingresar un motivo para rechazar la orden"}});O&&await de(g)},$e=async g=>{(await E.fire({title:"Marcar como Ordenada",text:"¿Estás seguro de que deseas marcar esta orden como enviada al proveedor?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, marcar como ordenada",cancelButtonText:"Cancelar"})).isConfirmed&&await le(g)},t=async g=>{(await E.fire({title:"Recibir Orden",text:"¿Estás seguro de que deseas marcar esta orden como recibida?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, recibir",cancelButtonText:"Cancelar"})).isConfirmed&&await ie(g)},c=async g=>{const{value:O}=await E.fire({title:"Cancelar Orden",input:"textarea",inputLabel:"Motivo de cancelación (opcional):",inputPlaceholder:"Describa el motivo de la cancelación...",inputAttributes:{"aria-label":"Motivo de cancelación"},showCancelButton:!0,confirmButtonText:"Sí, cancelar",cancelButtonText:"Cancelar"});O!==void 0&&await ce(g)},v=async g=>{(await E.fire({title:"Reabrir Orden",text:"¿Estás seguro de que deseas reabrir esta orden?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, reabrir",cancelButtonText:"Cancelar"})).isConfirmed&&await ue(g)},u=({index:g,productId:O})=>{se(g,O)},h=g=>{Object.assign(k,g),Y()};return(g,O)=>(_(),m("div",null,[D(er,{filters:y(k),suppliers:y(f),"search-order":y(a),"onUpdate:filters":h,"onUpdate:searchOrder":O[0]||(O[0]=Q=>a.value=Q),onAddOrder:K},null,8,["filters","suppliers","search-order"]),D(Se,{"error-message":y(o),"success-message":y(b),onClearError:O[1]||(O[1]=Q=>o.value=""),onClearSuccess:O[2]||(O[2]=Q=>b.value="")},null,8,["error-message","success-message"]),D(wr,{"total-orders":y(n),"pending-orders":y(i),"approved-orders":y(j),"ordered-orders":y($),"received-orders":y(L)},null,8,["total-orders","pending-orders","approved-orders","ordered-orders","received-orders"]),e("div",_a,[D(Yr,{orders:y(s),loading:y(M),onEditOrder:ge,onDeleteOrder:w,onViewOrder:W,onSubmitOrder:fe,onApproveOrder:be,onRejectOrder:ye,onMarkOrdered:$e,onReceiveOrder:t,onCancelOrder:c,onReopenOrder:v},null,8,["orders","loading"])]),D(es,{show:d.value,params:y(C),errors:y(l),saving:y(B),suppliers:y(f),products:y(q),onClose:X,onSave:ve,onAddItem:y(_e),onRemoveItem:y(me),onProductChange:u},null,8,["show","params","errors","saving","suppliers","products","onAddItem","onRemoveItem"]),D(pa,{show:y(I).show,order:y(I).data,onClose:y(J)},null,8,["show","order","onClose"])]))}});export{ka as default};
