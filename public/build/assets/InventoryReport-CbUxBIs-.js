import{d as Z,r as u,z as tt,c as et,o as st,k as r,l as a,m as e,x as g,t as n,f as ot,A as D,K as L,F as b,D as k,C as U,_ as rt,y as at,E as nt,n as j}from"./vendor-CjqaLWPm.js";import{u as lt,d as h}from"./main-C4NWlK8k.js";import{_ as it}from"./ProductStats.vue_vue_type_script_setup_true_lang-BoAUX_VJ.js";import"./quill-De1S0mUZ.js";const dt={key:0,class:"text-center"},ut={key:1,class:"alert alert-danger"},ct={key:2},pt={class:"panel"},vt={class:"flex flex-col md:flex-row items-center justify-between mb-4 gap-4"},gt={key:0,class:"text-sm text-gray-500"},xt={class:"flex flex-wrap items-center gap-4"},mt={class:"flex items-center gap-2"},yt=["value"],ft={class:"flex items-center gap-2"},bt=["value"],kt={class:"flex items-center gap-2"},ht={class:"table-responsive mb-4"},_t={class:"table-striped table-hover"},wt={class:"text-center"},Ct={class:"text-center"},St={class:"text-center"},Pt={key:0},jt={key:1},Mt={class:"font-semibold"},Nt={class:"text-xs text-gray-500"},Vt={class:"badge bg-primary/10 text-primary"},$t={class:"text-center"},Tt={class:"text-center"},Bt={class:"text-gray-600 font-semibold"},Et={class:"text-center"},It=["onClick","title"],Rt={key:0,class:"flex flex-col md:flex-row justify-between items-center mt-4"},Dt={class:"flex items-center gap-2 mb-4 md:mb-0"},Lt=["value"],Ut={class:"inline-flex items-center space-x-1 rtl:space-x-reverse"},zt=["disabled"],Ot=["onClick"],qt={key:1,class:"px-3.5 py-2"},Ft=["disabled"],At={key:4,class:"fixed inset-0 z-[100] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Kt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Gt={class:"inline-block align-bottom bg-white dark:bg-[#1b2e4b] rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full"},Ht={class:"bg-white dark:bg-[#1b2e4b] px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Jt={class:"sm:flex sm:items-start"},Qt={class:"mt-3 text-center sm:mt-0 sm:ltr:ml-4 sm:rtl:mr-4 sm:text-left w-full"},Wt={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white-light",id:"modal-title"},Xt={class:"mt-4"},Yt={key:0,class:"text-center py-4"},Zt={key:1,class:"text-center py-4 text-gray-500"},te={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto"},ee=["onClick"],se={class:"text-xs text-gray-500"},oe={class:"badge bg-info/10 text-info mt-1"},re={class:"text-right"},ae={class:"text-sm font-bold text-gray-900 dark:text-white-light"},ce=Z({__name:"InventoryReport",setup(ne){lt({title:"Reporte de Inventario"});const q=nt(),M=u(!0),_=u(""),x=u(null),z=u([]),O=u([]),N=u(!1),V=u(!1),w=u([]),C=u(null),p=tt({visible:!1,text:"",x:0,y:0}),$=(o,t)=>{const i=o.currentTarget.getBoundingClientRect();p.x=i.left+i.width/2,p.y=i.top-5,p.text=t,p.visible=!0},T=()=>{p.visible=!1},F=async o=>{C.value=o,N.value=!0,V.value=!0,w.value=[];try{const t=await h.get(`/api/products/${o.id}/pending-orders`);w.value=t.data.data}catch(t){console.error("Error fetching pending orders",t)}finally{V.value=!1}},B=()=>{N.value=!1,C.value=null},A=o=>{B(),q.push({name:"purchase-orders-kanban",params:{orderId:o.toString()}})},E=u([]),I=u(!1),l=u({current_page:1,last_page:1,total:0,per_page:15}),K=et(()=>{const o=l.value.current_page,t=l.value.last_page,d=2,i=[];if(t<=7){for(let c=1;c<=t;c++)i.push(c);return i}i.push(1),o>d+2&&i.push("...");const S=Math.max(2,o-d),P=Math.min(t-1,o+d);for(let c=S;c<=P;c++)i.push(c);return o<t-d-1&&i.push("..."),i.push(t),i}),v=u({category:"",unit:"",stockStatus:""}),G=async()=>{try{const o=await h.get("/api/products/categories");z.value=o.data.data}catch(o){console.error("Error fetching categories",o)}},H=async()=>{try{const o=await h.get("/api/products/units");O.value=o.data.data}catch(o){console.error("Error fetching units",o)}},J=async()=>{M.value=!0,_.value="";try{const o=await h.get("/api/reports/sales");x.value=o.data}catch(o){_.value="No se pudieron cargar los datos del reporte.",console.error(o)}finally{M.value=!1}},m=async(o=1)=>{I.value=!0;try{const t={page:o,per_page:l.value.per_page,category:v.value.category,unit:v.value.unit,stock_status:v.value.stockStatus},d=await h.get("/api/products",{params:t});E.value=d.data.data,l.value={current_page:d.data.meta.current_page,last_page:d.data.meta.last_page,total:d.data.meta.total,per_page:d.data.meta.per_page}}catch(t){console.error("Error fetching products list",t)}finally{I.value=!1}},R=o=>{o>0&&o<=l.value.last_page&&o!==l.value.current_page&&m(o)},Q=o=>{const t=o.target;l.value.per_page=parseInt(t.value),m(1)},W=o=>o.stock===0?"text-danger":o.stock<=o.reorder_point?"text-warning":"text-success",y=o=>{const t=parseInt(o.committed_stock||0);return o.stock-t},X=o=>{const t=y(o);return t<0?"text-danger bg-danger/10 px-2 py-1 rounded":t===0?"text-warning bg-warning/10 px-2 py-1 rounded":"text-success"};return st(()=>{G(),H(),J(),m(1)}),(o,t)=>{var d,i,S,P,c;return a(),r("div",null,[t[33]||(t[33]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold"},"Reporte de Inventario"),e("p",{class:"text-gray-500"},"Gestión de stock y disponibilidad de productos.")],-1)),M.value?(a(),r("div",dt,"Cargando datos...")):g("",!0),_.value?(a(),r("div",ut,n(_.value),1)):g("",!0),x.value?(a(),r("div",ct,[ot(it,{"total-products":((d=x.value.product_stats)==null?void 0:d.total)||0,"active-products":((i=x.value.product_stats)==null?void 0:i.active)||0,"low-stock-products":((S=x.value.product_stats)==null?void 0:S.low_stock)||0,"out-of-stock-products":((P=x.value.product_stats)==null?void 0:P.out_of_stock)||0,class:"mb-6"},null,8,["total-products","active-products","low-stock-products","out-of-stock-products"]),e("div",pt,[e("div",vt,[e("div",null,[t[11]||(t[11]=e("h2",{class:"text-xl font-bold"},"Inventario de Productos",-1)),l.value.total>0?(a(),r("div",gt," Total: "+n(l.value.total)+" productos ",1)):g("",!0)]),e("div",xt,[e("div",mt,[t[13]||(t[13]=e("label",{for:"category",class:"font-bold text-xs whitespace-nowrap"},"Categoría:",-1)),D(e("select",{id:"category",class:"form-select w-40","onUpdate:modelValue":t[0]||(t[0]=s=>v.value.category=s),onChange:t[1]||(t[1]=s=>m(1))},[t[12]||(t[12]=e("option",{value:""},"Todas",-1)),(a(!0),r(b,null,k(z.value,s=>(a(),r("option",{key:s.id,value:s.id},n(s.name),9,yt))),128))],544),[[L,v.value.category]])]),e("div",ft,[t[15]||(t[15]=e("label",{for:"unit",class:"font-bold text-xs whitespace-nowrap"},"Unidad:",-1)),D(e("select",{id:"unit",class:"form-select w-32","onUpdate:modelValue":t[2]||(t[2]=s=>v.value.unit=s),onChange:t[3]||(t[3]=s=>m(1))},[t[14]||(t[14]=e("option",{value:""},"Todas",-1)),(a(!0),r(b,null,k(O.value,s=>(a(),r("option",{key:s.id,value:s.id},n(s.name),9,bt))),128))],544),[[L,v.value.unit]])]),e("div",kt,[t[17]||(t[17]=e("label",{for:"stockStatus",class:"font-bold text-xs whitespace-nowrap"},"Estado Stock:",-1)),D(e("select",{id:"stockStatus",class:"form-select w-40","onUpdate:modelValue":t[4]||(t[4]=s=>v.value.stockStatus=s),onChange:t[5]||(t[5]=s=>m(1))},[...t[16]||(t[16]=[e("option",{value:""},"Todos",-1),e("option",{value:"low"},"Bajo Stock",-1),e("option",{value:"out"},"Sin Stock",-1)])],544),[[L,v.value.stockStatus]])])])]),e("div",ht,[e("table",_t,[e("thead",null,[e("tr",null,[t[21]||(t[21]=e("th",null,"SKU",-1)),t[22]||(t[22]=e("th",null,"Producto",-1)),t[23]||(t[23]=e("th",null,"Categoría",-1)),e("th",wt,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[6]||(t[6]=s=>$(s,"Cantidad real existente en bodega.")),onMouseleave:T},[...t[18]||(t[18]=[U('<span class="border-b border-dotted border-gray-400">Físico</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),e("th",Ct,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[7]||(t[7]=s=>$(s,"Suma de productos en órdenes activas (pendientes de facturar).")),onMouseleave:T},[...t[19]||(t[19]=[U('<span class="border-b border-dotted border-gray-400">Requerido</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),e("th",St,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[8]||(t[8]=s=>$(s,"Stock Físico menos Requerido. Si es negativo, falta mercancía.")),onMouseleave:T},[...t[20]||(t[20]=[U('<span class="border-b border-dotted border-gray-400">Disponible</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),t[24]||(t[24]=e("th",null,"Estado",-1))])]),e("tbody",null,[I.value?(a(),r("tr",Pt,[...t[25]||(t[25]=[e("td",{colspan:"7",class:"text-center py-4"},"Cargando inventario...",-1)])])):E.value.length===0?(a(),r("tr",jt,[...t[26]||(t[26]=[e("td",{colspan:"7",class:"text-center py-4"},"No se encontraron productos.",-1)])])):(a(!0),r(b,{key:2},k(E.value,s=>(a(),r("tr",{key:s.id},[e("td",null,n(s.sku),1),e("td",null,[e("div",Mt,n(s.name),1),e("div",Nt,n(s.unit),1)]),e("td",null,[e("span",Vt,n(s.category),1)]),e("td",$t,[e("span",{class:j([W(s),"font-bold"])},n(s.stock),3)]),e("td",Tt,[e("span",Bt,n(s.committed_stock||0),1)]),e("td",Et,[e("span",{class:j(["font-bold",[X(s),y(s)<0?"cursor-pointer hover:underline":""]]),onClick:f=>y(s)<0?F(s):null,title:y(s)<0?"Ver órdenes pendientes":""},n(y(s)),11,It)]),e("td",null,[e("span",{class:j(["badge",s.is_active?"bg-success/10 text-success":"bg-danger/10 text-danger"])},n(s.is_active?"Activo":"Inactivo"),3)])]))),128))])])]),l.value.last_page>1||l.value.total>0?(a(),r("div",Rt,[e("div",Dt,[t[28]||(t[28]=e("span",{class:"text-sm"},"Mostrar:",-1)),e("select",{class:"form-select w-20 h-9",value:l.value.per_page,onChange:Q},[...t[27]||(t[27]=[e("option",{value:"10"},"10",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)])],40,Lt)]),e("ul",Ut,[e("li",null,[e("button",{type:"button",class:"flex justify-center font-semibold px-3.5 py-2 rounded transition text-dark hover:text-primary border-2 border-[#e0e6ed] dark:border-[#191e3a] hover:border-primary dark:hover:border-primary dark:text-white-light",disabled:l.value.current_page===1,onClick:t[9]||(t[9]=s=>R(l.value.current_page-1))}," Prev ",8,zt)]),(a(!0),r(b,null,k(K.value,(s,f)=>(a(),r("li",{key:f},[s!=="..."?(a(),r("button",{key:0,type:"button",class:j(["flex justify-center font-semibold px-3.5 py-2 rounded transition",{"text-primary border-2 border-primary dark:border-primary dark:text-white-light":l.value.current_page===s,"text-dark hover:text-primary border-2 border-[#e0e6ed] dark:border-[#191e3a] hover:border-primary dark:hover:border-primary dark:text-white-light":l.value.current_page!==s}]),onClick:Y=>R(s)},n(s),11,Ot)):(a(),r("span",qt,"..."))]))),128)),e("li",null,[e("button",{type:"button",class:"flex justify-center font-semibold px-3.5 py-2 rounded transition text-dark hover:text-primary border-2 border-[#e0e6ed] dark:border-[#191e3a] hover:border-primary dark:hover:border-primary dark:text-white-light",disabled:l.value.current_page===l.value.last_page,onClick:t[10]||(t[10]=s=>R(l.value.current_page+1))}," Next ",8,Ft)])])])):g("",!0)])])):g("",!0),p.visible?(a(),r("div",{key:3,class:"fixed z-[9999] px-3 py-2 text-xs font-medium text-white bg-black rounded shadow-lg pointer-events-none transform -translate-x-1/2 -translate-y-full mb-2 whitespace-normal max-w-xs text-center",style:rt({top:p.y+"px",left:p.x+"px"})},[at(n(p.text)+" ",1),t[29]||(t[29]=e("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 w-2 h-2 bg-black rotate-45"},null,-1))],4)):g("",!0),N.value?(a(),r("div",At,[e("div",Kt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:B}),t[32]||(t[32]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Gt,[e("div",Ht,[e("div",Jt,[e("div",Qt,[e("h3",Wt," Órdenes Pendientes: "+n((c=C.value)==null?void 0:c.name),1),e("div",Xt,[V.value?(a(),r("div",Yt,[...t[30]||(t[30]=[e("span",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-6 h-6 inline-block"},null,-1)])])):w.value.length===0?(a(),r("div",Zt," No hay órdenes pendientes encontradas. ")):(a(),r("ul",te,[(a(!0),r(b,null,k(w.value,s=>{var f;return a(),r("li",{key:s.id,class:"py-3 flex justify-between items-center"},[e("div",null,[e("button",{type:"button",class:"text-sm font-medium text-primary hover:underline focus:outline-none",onClick:Y=>A(s.id),title:"Ver orden en Pipeline"}," #"+n(s.order_number),9,ee),e("p",se,n(s.supplier)+" - "+n(s.date),1),e("span",oe,n(s.status),1)]),e("div",re,[e("p",ae,n(s.quantity_requested)+" "+n((f=C.value)==null?void 0:f.unit),1),t[31]||(t[31]=e("p",{class:"text-xs text-gray-500"},"Solicitado",-1))])])}),128))]))])])])]),e("div",{class:"bg-gray-50 dark:bg-[#121c2c] px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:B}," Cerrar ")])])])])):g("",!0)])}}});export{ce as default};
