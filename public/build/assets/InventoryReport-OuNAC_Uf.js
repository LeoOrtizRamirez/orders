import{d as J,r,z as Q,o as W,k as n,l,m as e,x as p,t as a,f as X,A as B,K as T,F as k,D as w,C as $,_ as Y,y as Z,n as E}from"./vendor-CjqaLWPm.js";import{u as tt,d as y}from"./main-0YACWvfc.js";import{_ as et}from"./ProductStats.vue_vue_type_script_setup_true_lang-BoAUX_VJ.js";import"./quill-De1S0mUZ.js";const st={key:0,class:"text-center"},ot={key:1,class:"alert alert-danger"},at={key:2},nt={class:"panel"},lt={class:"flex flex-col md:flex-row items-center justify-between mb-4 gap-4"},rt={key:0,class:"text-sm text-gray-500"},it={class:"flex flex-wrap items-center gap-4"},dt={class:"flex items-center gap-2"},ct=["value"],ut={class:"flex items-center gap-2"},pt=["value"],gt={class:"flex items-center gap-2"},vt={class:"table-responsive mb-4"},xt={class:"table-striped table-hover"},mt={class:"text-center"},yt={class:"text-center"},ft={class:"text-center"},bt={key:0},_t={key:1},kt={class:"font-semibold"},wt={class:"text-xs text-gray-500"},ht={class:"badge bg-primary/10 text-primary"},Ct={class:"text-center"},St={class:"text-center"},jt={class:"text-gray-600 font-semibold"},Mt={class:"text-center"},Nt=["onClick","title"],Pt={key:0,class:"flex justify-center"},Vt={class:"inline-flex items-center space-x-1"},Bt=["disabled"],Tt={class:"px-2"},$t=["disabled"],Et={key:4,class:"fixed inset-0 z-[100] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Rt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Dt={class:"inline-block align-bottom bg-white dark:bg-[#1b2e4b] rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full"},It={class:"bg-white dark:bg-[#1b2e4b] px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Lt={class:"sm:flex sm:items-start"},Ut={class:"mt-3 text-center sm:mt-0 sm:ltr:ml-4 sm:rtl:mr-4 sm:text-left w-full"},zt={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white-light",id:"modal-title"},qt={class:"mt-4"},Ft={key:0,class:"text-center py-4"},Ot={key:1,class:"text-center py-4 text-gray-500"},At={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto"},Kt={class:"text-sm font-medium text-primary"},Gt={class:"text-xs text-gray-500"},Ht={class:"badge bg-info/10 text-info mt-1"},Jt={class:"text-right"},Qt={class:"text-sm font-bold text-gray-900 dark:text-white-light"},ee=J({__name:"InventoryReport",setup(Wt){tt({title:"Reporte de Inventario"});const h=r(!0),f=r(""),g=r(null),R=r([]),D=r([]),C=r(!1),S=r(!1),b=r([]),_=r(null),d=Q({visible:!1,text:"",x:0,y:0}),j=(o,t)=>{const v=o.currentTarget.getBoundingClientRect();d.x=v.left+v.width/2,d.y=v.top-5,d.text=t,d.visible=!0},M=()=>{d.visible=!1},F=async o=>{_.value=o,C.value=!0,S.value=!0,b.value=[];try{const t=await y.get(`/api/products/${o.id}/pending-orders`);b.value=t.data.data}catch(t){console.error("Error fetching pending orders",t)}finally{S.value=!1}},I=()=>{C.value=!1,_.value=null},N=r([]),P=r(!1),i=r({current_page:1,last_page:1,total:0,per_page:15}),c=r({category:"",unit:"",stockStatus:""}),O=async()=>{try{const o=await y.get("/api/products/categories");R.value=o.data.data}catch(o){console.error("Error fetching categories",o)}},A=async()=>{try{const o=await y.get("/api/products/units");D.value=o.data.data}catch(o){console.error("Error fetching units",o)}},K=async()=>{h.value=!0,f.value="";try{const o=await y.get("/api/reports/sales");g.value=o.data}catch(o){f.value="No se pudieron cargar los datos del reporte.",console.error(o)}finally{h.value=!1}},x=async(o=1)=>{P.value=!0;try{const t={page:o,per_page:i.value.per_page,category:c.value.category,unit:c.value.unit,stock_status:c.value.stockStatus},u=await y.get("/api/products",{params:t});N.value=u.data.data,i.value={current_page:u.data.meta.current_page,last_page:u.data.meta.last_page,total:u.data.meta.total,per_page:u.data.meta.per_page}}catch(t){console.error("Error fetching products list",t)}finally{P.value=!1}},L=o=>{x(o)},G=o=>o.stock===0?"text-danger":o.stock<=o.reorder_point?"text-warning":"text-success",m=o=>{const t=parseInt(o.committed_stock||0);return o.stock-t},H=o=>{const t=m(o);return t<0?"text-danger bg-danger/10 px-2 py-1 rounded":t===0?"text-warning bg-warning/10 px-2 py-1 rounded":"text-success"};return W(()=>{O(),A(),K(),x(1)}),(o,t)=>{var u,v,U,z,q;return l(),n("div",null,[t[31]||(t[31]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold"},"Reporte de Inventario"),e("p",{class:"text-gray-500"},"Gestión de stock y disponibilidad de productos.")],-1)),h.value?(l(),n("div",st,"Cargando datos...")):p("",!0),f.value?(l(),n("div",ot,a(f.value),1)):p("",!0),g.value?(l(),n("div",at,[X(et,{"total-products":((u=g.value.product_stats)==null?void 0:u.total)||0,"active-products":((v=g.value.product_stats)==null?void 0:v.active)||0,"low-stock-products":((U=g.value.product_stats)==null?void 0:U.low_stock)||0,"out-of-stock-products":((z=g.value.product_stats)==null?void 0:z.out_of_stock)||0,class:"mb-6"},null,8,["total-products","active-products","low-stock-products","out-of-stock-products"]),e("div",nt,[e("div",lt,[e("div",null,[t[11]||(t[11]=e("h2",{class:"text-xl font-bold"},"Inventario de Productos",-1)),i.value.total>0?(l(),n("div",rt," Total: "+a(i.value.total)+" productos ",1)):p("",!0)]),e("div",it,[e("div",dt,[t[13]||(t[13]=e("label",{for:"category",class:"font-bold text-xs whitespace-nowrap"},"Categoría:",-1)),B(e("select",{id:"category",class:"form-select w-40","onUpdate:modelValue":t[0]||(t[0]=s=>c.value.category=s),onChange:t[1]||(t[1]=s=>x(1))},[t[12]||(t[12]=e("option",{value:""},"Todas",-1)),(l(!0),n(k,null,w(R.value,s=>(l(),n("option",{key:s.id,value:s.id},a(s.name),9,ct))),128))],544),[[T,c.value.category]])]),e("div",ut,[t[15]||(t[15]=e("label",{for:"unit",class:"font-bold text-xs whitespace-nowrap"},"Unidad:",-1)),B(e("select",{id:"unit",class:"form-select w-32","onUpdate:modelValue":t[2]||(t[2]=s=>c.value.unit=s),onChange:t[3]||(t[3]=s=>x(1))},[t[14]||(t[14]=e("option",{value:""},"Todas",-1)),(l(!0),n(k,null,w(D.value,s=>(l(),n("option",{key:s.id,value:s.id},a(s.name),9,pt))),128))],544),[[T,c.value.unit]])]),e("div",gt,[t[17]||(t[17]=e("label",{for:"stockStatus",class:"font-bold text-xs whitespace-nowrap"},"Estado Stock:",-1)),B(e("select",{id:"stockStatus",class:"form-select w-40","onUpdate:modelValue":t[4]||(t[4]=s=>c.value.stockStatus=s),onChange:t[5]||(t[5]=s=>x(1))},[...t[16]||(t[16]=[e("option",{value:""},"Todos",-1),e("option",{value:"low"},"Bajo Stock",-1),e("option",{value:"out"},"Sin Stock",-1)])],544),[[T,c.value.stockStatus]])])])]),e("div",vt,[e("table",xt,[e("thead",null,[e("tr",null,[t[21]||(t[21]=e("th",null,"SKU",-1)),t[22]||(t[22]=e("th",null,"Producto",-1)),t[23]||(t[23]=e("th",null,"Categoría",-1)),e("th",mt,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[6]||(t[6]=s=>j(s,"Cantidad real existente en bodega.")),onMouseleave:M},[...t[18]||(t[18]=[$('<span class="border-b border-dotted border-gray-400">Físico</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),e("th",yt,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[7]||(t[7]=s=>j(s,"Suma de productos en órdenes activas (pendientes de facturar).")),onMouseleave:M},[...t[19]||(t[19]=[$('<span class="border-b border-dotted border-gray-400">Requerido</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),e("th",ft,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[8]||(t[8]=s=>j(s,"Stock Físico menos Requerido. Si es negativo, falta mercancía.")),onMouseleave:M},[...t[20]||(t[20]=[$('<span class="border-b border-dotted border-gray-400">Disponible</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),t[24]||(t[24]=e("th",null,"Estado",-1))])]),e("tbody",null,[P.value?(l(),n("tr",bt,[...t[25]||(t[25]=[e("td",{colspan:"7",class:"text-center py-4"},"Cargando inventario...",-1)])])):N.value.length===0?(l(),n("tr",_t,[...t[26]||(t[26]=[e("td",{colspan:"7",class:"text-center py-4"},"No se encontraron productos.",-1)])])):(l(!0),n(k,{key:2},w(N.value,s=>(l(),n("tr",{key:s.id},[e("td",null,a(s.sku),1),e("td",null,[e("div",kt,a(s.name),1),e("div",wt,a(s.unit),1)]),e("td",null,[e("span",ht,a(s.category),1)]),e("td",Ct,[e("span",{class:E([G(s),"font-bold"])},a(s.stock),3)]),e("td",St,[e("span",jt,a(s.committed_stock||0),1)]),e("td",Mt,[e("span",{class:E(["font-bold",[H(s),m(s)<0?"cursor-pointer hover:underline":""]]),onClick:V=>m(s)<0?F(s):null,title:m(s)<0?"Ver órdenes pendientes":""},a(m(s)),11,Nt)]),e("td",null,[e("span",{class:E(["badge",s.is_active?"bg-success/10 text-success":"bg-danger/10 text-danger"])},a(s.is_active?"Activo":"Inactivo"),3)])]))),128))])])]),i.value.last_page>1?(l(),n("div",Pt,[e("ul",Vt,[e("li",null,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",disabled:i.value.current_page===1,onClick:t[9]||(t[9]=s=>L(i.value.current_page-1))}," Prev ",8,Bt)]),e("li",Tt," Página "+a(i.value.current_page)+" de "+a(i.value.last_page),1),e("li",null,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",disabled:i.value.current_page===i.value.last_page,onClick:t[10]||(t[10]=s=>L(i.value.current_page+1))}," Next ",8,$t)])])])):p("",!0)])])):p("",!0),d.visible?(l(),n("div",{key:3,class:"fixed z-[9999] px-3 py-2 text-xs font-medium text-white bg-black rounded shadow-lg pointer-events-none transform -translate-x-1/2 -translate-y-full mb-2 whitespace-normal max-w-xs text-center",style:Y({top:d.y+"px",left:d.x+"px"})},[Z(a(d.text)+" ",1),t[27]||(t[27]=e("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 w-2 h-2 bg-black rotate-45"},null,-1))],4)):p("",!0),C.value?(l(),n("div",Et,[e("div",Rt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:I}),t[30]||(t[30]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Dt,[e("div",It,[e("div",Lt,[e("div",Ut,[e("h3",zt," Órdenes Pendientes: "+a((q=_.value)==null?void 0:q.name),1),e("div",qt,[S.value?(l(),n("div",Ft,[...t[28]||(t[28]=[e("span",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-6 h-6 inline-block"},null,-1)])])):b.value.length===0?(l(),n("div",Ot," No hay órdenes pendientes encontradas. ")):(l(),n("ul",At,[(l(!0),n(k,null,w(b.value,s=>{var V;return l(),n("li",{key:s.id,class:"py-3 flex justify-between items-center"},[e("div",null,[e("p",Kt,"#"+a(s.order_number),1),e("p",Gt,a(s.supplier)+" - "+a(s.date),1),e("span",Ht,a(s.status),1)]),e("div",Jt,[e("p",Qt,a(s.quantity_requested)+" "+a((V=_.value)==null?void 0:V.unit),1),t[29]||(t[29]=e("p",{class:"text-xs text-gray-500"},"Solicitado",-1))])])}),128))]))])])])]),e("div",{class:"bg-gray-50 dark:bg-[#121c2c] px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:I}," Cerrar ")])])])])):p("",!0)])}}});export{ee as default};
