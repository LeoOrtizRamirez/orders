import{u as y,c as _}from"./main-yUnecxyl.js";import{d as x,r as n,k as a,l,m as s,x as p,t as r,y as f,F as h,D as k}from"./vendor-CjqaLWPm.js";import"./quill-De1S0mUZ.js";const S={class:"container mx-auto p-4"},w={key:0,class:"alert alert-danger mb-4"},C={key:1,class:"alert alert-success mb-4"},F={class:"panel"},I={class:"panel-body"},N={class:"w-full"},D={class:"mb-4"},O=["disabled"],V={key:0,class:"animate-spin border-2 border-white border-l-transparent rounded-full w-5 h-5 ltr:mr-4 rtl:ml-4 inline-block align-middle"},A={key:1},B={key:0,class:"mt-6"},M={class:"list-disc list-inside mt-2"},z={key:0,class:"mt-4"},E={class:"max-h-60 overflow-y-auto"},J={class:"list-disc list-inside text-sm text-red-600"},R=x({__name:"StockImport",setup(P){y({title:"Importar Stock de Productos"});const d=n(null),u=n(!1),o=n(""),c=n(""),t=n(null),v=i=>{const e=i.target;e.files&&e.files.length>0&&(d.value=e.files[0])},b=async()=>{if(!d.value)return;u.value=!0,o.value="",c.value="",t.value=null;const i=new FormData;i.append("file",d.value);try{const e=await _.post("/api/products/import/stock",i,{headers:{"Content-Type":"multipart/form-data"}});e.data.success?(c.value=e.data.message||"Importación completada con éxito.",t.value=e.data):(o.value=e.data.message||"Ocurrió un error durante la importación.",e.data.errors&&(t.value={updated:0,failed:e.data.errors.length,errors:e.data.errors}))}catch(e){if(e.response&&e.response.data&&e.response.data.message){if(o.value=e.response.data.message,e.response.data.errors){const m=Object.keys(e.response.data.errors).length;t.value={updated:0,failed:m,errors:[{row:"N/A",error:JSON.stringify(e.response.data.errors)}]}}}else o.value="Ocurrió un error inesperado al conectar con el servidor."}finally{u.value=!1}};return(i,e)=>(l(),a("div",S,[e[5]||(e[5]=s("div",{class:"mb-4"},[s("h1",{class:"text-3xl font-bold"},"Importar Stock de Productos"),s("p",{class:"text-gray-500"},"Sube un archivo CSV con las columnas 'sku' y 'stock' para actualizar el inventario masivamente.")],-1)),o.value?(l(),a("div",w,r(o.value),1)):p("",!0),c.value?(l(),a("div",C,r(c.value),1)):p("",!0),s("div",F,[s("div",I,[s("div",N,[s("div",D,[e[0]||(e[0]=s("label",{for:"file-upload",class:"block text-sm font-medium text-gray-700"},"Archivo CSV",-1)),s("input",{id:"file-upload",type:"file",class:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100",onChange:v,accept:".csv,.txt"},null,32)]),s("button",{type:"button",class:"btn btn-primary",disabled:!d.value||u.value,onClick:b},[u.value?(l(),a("span",V)):(l(),a("span",A,"Importar Stock"))],8,O)]),t.value?(l(),a("div",B,[e[4]||(e[4]=s("h2",{class:"text-xl font-bold"},"Resultados de la Importación",-1)),s("ul",M,[s("li",null,[e[1]||(e[1]=s("span",{class:"font-semibold"},"Actualizados:",-1)),f(" "+r(t.value.updated),1)]),s("li",null,[e[2]||(e[2]=s("span",{class:"font-semibold"},"Fallidos:",-1)),f(" "+r(t.value.failed),1)])]),t.value.errors&&t.value.errors.length>0?(l(),a("div",z,[e[3]||(e[3]=s("h3",{class:"font-semibold"},"Detalles de errores:",-1)),s("div",E,[s("ul",J,[(l(!0),a(h,null,k(t.value.errors,(m,g)=>(l(),a("li",{key:g}," Fila: "+r(JSON.stringify(m.row))+" - Error: "+r(m.error),1))),128))])])])):p("",!0)])):p("",!0)])])]))}});export{R as default};
