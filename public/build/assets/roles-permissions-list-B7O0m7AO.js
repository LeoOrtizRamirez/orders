import{d as D,r as p,c as M,o as R,k as o,l as i,m as e,x as b,A,a2 as F,F as k,D as w,t as l,y as T,n as I,u as U}from"./vendor-CjqaLWPm.js";import{b as H,c as C,_ as q}from"./main-yUnecxyl.js";import{S as P}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./quill-De1S0mUZ.js";const G={class:"panel px-0 pb-1.5 border-[#e0e6ed] dark:border-[#1b2e4b]"},J={class:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5"},K={class:"ltr:ml-auto rtl:mr-auto"},O={class:"overflow-x-auto"},Q={class:"min-w-full bg-white dark:bg-gray-800"},W={class:"flex flex-col items-center"},X={class:"text-xs"},Y={class:"text-[10px] text-gray-400"},Z={class:"divide-y divide-gray-200 dark:divide-gray-700"},ee={class:"px-6 py-4 whitespace-nowrap sticky left-0 bg-white dark:bg-gray-800 z-10"},te={class:"flex items-center"},se={class:"h-10 w-10 rounded-full bg-primary flex items-center justify-center text-white font-bold mr-3"},ae={class:"font-medium text-gray-900 dark:text-white"},re={class:"text-sm text-gray-500 dark:text-gray-400"},oe={class:"relative"},ie={class:"inline-flex items-center cursor-pointer"},ne=["checked","disabled","onChange"],le={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 dark:bg-gray-800 dark:bg-opacity-80"},de={key:0,class:"flex justify-center items-center py-10"},ce={key:1,class:"text-center py-10"},ue=D({__name:"roles-permissions-list",setup(me){const $=H(),d=p(""),x=p(!1),g=p({}),n=p([]),h=p([]),S=M(()=>d.value?h.value.filter(a=>a.name.toLowerCase().includes(d.value.toLowerCase())||a.description&&a.description.toLowerCase().includes(d.value.toLowerCase())||a.group&&a.group.toLowerCase().includes(d.value.toLowerCase())):h.value),V=async()=>{x.value=!0;try{const[a,s]=await Promise.all([C.get("/api/admin/roles"),C.get("/api/admin/permissions")]);n.value=a.data.data,h.value=s.data.data}catch(a){console.error("Error fetching data:",a),P.fire("Error","No se pudieron cargar los datos","error")}finally{x.value=!1}},v=(a,s)=>{var t;return(t=a.permissions)==null?void 0:t.some(r=>r.id===s.id)},j=async(a,s,t)=>{var f,z,L,B,N;if(!$.can("manage roles")||a.is_system)return;const r=`${a.id}-${s.id}`;g.value[r]=!0;try{let u=[...((f=a.permissions)==null?void 0:f.map(m=>m.id))||[]];t?u.includes(s.id)||u.push(s.id):u=u.filter(m=>m!==s.id);const _=(await C.put(`/api/admin/roles/${a.id}`,{permissions:u})).data.data,E=n.value.findIndex(m=>m.id===a.id);E!==-1&&(n.value[E]=_),P.fire({icon:"success",title:"¡Permiso actualizado!",text:`El permiso "${s.name}" ha sido ${t?"habilitado":"deshabilitado"} para el rol "${a.name}"`,timer:5e3,showConfirmButton:!1,toast:!0,position:"top"})}catch(c){console.error("Error updating permission:",c),n.value.findIndex(_=>_.id===a.id)!==-1&&(n.value=[...n.value]);let y="No se pudo actualizar el permiso";(L=(z=c.response)==null?void 0:z.data)!=null&&L.error?y=c.response.data.error:(N=(B=c.response)==null?void 0:B.data)!=null&&N.message&&(y=c.response.data.message),P.fire({icon:"error",title:"Error",text:y,timer:5e3,showConfirmButton:!1,toast:!0,position:"top"})}finally{g.value[r]=!1}};return R(()=>{V()}),(a,s)=>(i(),o("div",null,[e("div",G,[e("div",J,[e("div",K,[A(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>d.value=t),type:"text",class:"form-input",placeholder:"Buscar permisos..."},null,512),[[F,d.value]])])]),e("div",O,[e("table",Q,[e("thead",null,[e("tr",null,[s[1]||(s[1]=e("th",{class:"px-6 py-3 bg-gray-50 dark:bg-gray-700 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider sticky left-0 z-10"}," Rol / Permiso ",-1)),(i(!0),o(k,null,w(S.value,t=>(i(),o("th",{key:t.id,class:"px-4 py-3 bg-gray-50 dark:bg-gray-700 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},[e("div",W,[e("span",X,l(t.name),1),e("span",Y,l(t.group||"Sin grupo"),1)])]))),128))])]),e("tbody",Z,[(i(!0),o(k,null,w(n.value,t=>(i(),o("tr",{key:t.id},[e("td",ee,[e("div",te,[e("div",se,l(t.name.charAt(0).toUpperCase()),1),e("div",null,[e("div",ae,l(t.name),1),e("div",re,[T(l(t.users_count)+" usuarios ",1),s[2]||(s[2]=e("span",{class:"mx-1"},"•",-1)),e("span",{class:I(t.is_system?"text-orange-500":"text-blue-500")},l(t.is_system?"Sistema":"Personalizado"),3)])])])]),(i(!0),o(k,null,w(S.value,r=>(i(),o("td",{key:r.id,class:"px-4 py-4 whitespace-nowrap text-center"},[e("div",oe,[e("label",ie,[e("input",{type:"checkbox",class:"form-switch",checked:v(t,r),disabled:!U($).can("manage roles")||t.is_system||g.value[`${t.id}-${r.id}`],onChange:f=>j(t,r,f.target.checked)},null,40,ne),e("span",{class:I(["ml-2 text-sm",v(t,r)?"text-green-600":"text-gray-400"])},l(v(t,r)?"Sí":"No"),3)]),g.value[`${t.id}-${r.id}`]?(i(),o("div",le,[...s[3]||(s[3]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"},null,-1)])])):b("",!0)])]))),128))]))),128))])])]),x.value?(i(),o("div",de,[...s[4]||(s[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):b("",!0),!x.value&&n.value.length===0?(i(),o("div",ce,[...s[5]||(s[5]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900 dark:text-white"},"No hay roles",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Comienza creando algunos roles para gestionar permisos.",-1)])])):b("",!0)])]))}}),ye=q(ue,[["__scopeId","data-v-de25fadd"]]);export{ye as default};
