import{d as et,r as c,z as st,c as ot,o as rt,k as r,l as a,m as e,x as g,t as l,f as at,A as I,K as U,F as k,D as h,y as q,C as D,_ as nt,E as lt,n as P}from"./vendor-CjqaLWPm.js";import{u as it,d as y}from"./main-B02PUh7k.js";import{_ as dt}from"./ProductStats.vue_vue_type_script_setup_true_lang-BoAUX_VJ.js";import"./quill-De1S0mUZ.js";const ut={key:0,class:"text-center"},ct={key:1,class:"alert alert-danger"},pt={key:2},vt={class:"panel"},gt={class:"flex flex-col md:flex-row items-center justify-between mb-4 gap-4"},xt={key:0,class:"text-sm text-gray-500"},mt={class:"flex flex-wrap items-center gap-4"},yt={class:"flex items-center gap-2"},bt=["value"],ft={class:"flex items-center gap-2"},kt=["value"],ht={class:"flex items-center gap-2"},wt={class:"table-responsive mb-4"},_t={class:"table-striped table-hover"},Ct={class:"text-center"},St={class:"text-center"},Mt={class:"text-center"},Pt={key:0},jt={key:1},Et={class:"font-semibold"},Lt={class:"text-xs text-gray-500"},Nt={class:"badge bg-primary/10 text-primary"},Rt={class:"text-center"},Tt={class:"text-center"},Vt={class:"text-gray-600 font-semibold"},$t={class:"text-center"},Bt=["onClick","title"],It={key:0,class:"flex flex-col md:flex-row justify-between items-center mt-4"},Ut={class:"flex items-center gap-2 mb-4 md:mb-0"},Dt=["value"],Ot={class:"inline-flex items-center space-x-1 rtl:space-x-reverse"},zt=["disabled"],qt=["onClick"],At={key:1,class:"px-3.5 py-2"},Ft=["disabled"],Kt={key:4,class:"fixed inset-0 z-[100] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Gt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ht={class:"inline-block align-bottom bg-white dark:bg-[#1b2e4b] rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full"},Jt={class:"bg-white dark:bg-[#1b2e4b] px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Qt={class:"sm:flex sm:items-start"},Wt={class:"mt-3 text-center sm:mt-0 sm:ltr:ml-4 sm:rtl:mr-4 sm:text-left w-full"},Xt={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white-light",id:"modal-title"},Yt={class:"mt-4"},Zt={key:0,class:"text-center py-4"},te={key:1,class:"text-center py-4 text-gray-500"},ee={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700 max-h-60 overflow-y-auto"},se=["onClick"],oe={class:"text-xs text-gray-500"},re={class:"badge bg-info/10 text-info mt-1"},ae={class:"text-right"},ne={class:"text-sm font-bold text-gray-900 dark:text-white-light"},pe=et({__name:"InventoryReport",setup(le){it({title:"Reporte de Inventario"});const A=lt(),j=c(!0),w=c(""),x=c(null),O=c([]),z=c([]),E=c(!1),L=c(!1),_=c([]),C=c(null),v=st({visible:!1,text:"",x:0,y:0}),N=(o,t)=>{const n=o.currentTarget.getBoundingClientRect();v.x=n.left+n.width/2,v.y=n.top-5,v.text=t,v.visible=!0},R=()=>{v.visible=!1},F=async o=>{C.value=o,E.value=!0,L.value=!0,_.value=[];try{const t=await y.get(`/api/products/${o.id}/pending-orders`);_.value=t.data.data}catch(t){console.error("Error fetching pending orders",t)}finally{L.value=!1}},T=()=>{E.value=!1,C.value=null},K=o=>{T(),A.push({name:"purchase-orders-kanban",params:{orderId:o.toString()}})},V=c([]),$=c(!1),i=c({current_page:1,last_page:1,total:0,per_page:15}),G=ot(()=>{const o=i.value.current_page,t=i.value.last_page,d=2,n=[];if(t<=7){for(let p=1;p<=t;p++)n.push(p);return n}n.push(1),o>d+2&&n.push("...");const S=Math.max(2,o-d),M=Math.min(t-1,o+d);for(let p=S;p<=M;p++)n.push(p);return o<t-d-1&&n.push("..."),n.push(t),n}),u=c({category:"",unit:"",stockStatus:""}),H=async()=>{try{const o=await y.get("/api/products/categories");O.value=o.data.data}catch(o){console.error("Error fetching categories",o)}},J=async()=>{try{const o=await y.get("/api/products/units");z.value=o.data.data}catch(o){console.error("Error fetching units",o)}},Q=async()=>{j.value=!0,w.value="";try{const o=await y.get("/api/reports/sales");x.value=o.data}catch(o){w.value="No se pudieron cargar los datos del reporte.",console.error(o)}finally{j.value=!1}},m=async(o=1)=>{$.value=!0;try{const t={page:o,per_page:i.value.per_page,category:u.value.category,unit:u.value.unit,stock_status:u.value.stockStatus},d=await y.get("/api/products",{params:t});V.value=d.data.data,i.value={current_page:d.data.meta.current_page,last_page:d.data.meta.last_page,total:d.data.meta.total,per_page:d.data.meta.per_page}}catch(t){console.error("Error fetching products list",t)}finally{$.value=!1}},B=o=>{o>0&&o<=i.value.last_page&&o!==i.value.current_page&&m(o)},W=o=>{const t=o.target;i.value.per_page=parseInt(t.value),m(1)},X=async()=>{try{const o=new URLSearchParams;u.value.category&&o.append("category",u.value.category),u.value.unit&&o.append("unit",u.value.unit),u.value.stockStatus&&o.append("stock_status",u.value.stockStatus);const t=await y.get("/api/products/export",{params:o,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=d,n.setAttribute("download",`inventario_${new Date().toISOString().slice(0,10)}.xlsx`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(o){console.error("Error exporting to Excel",o),alert("No se pudo exportar el inventario. Por favor, intente de nuevo.")}},Y=o=>o.stock===0?"text-danger":o.stock<=o.reorder_point?"text-warning":"text-success",b=o=>{const t=parseInt(o.committed_stock||0);return o.stock-t},Z=o=>{const t=b(o);return t<0?"text-danger bg-danger/10 px-2 py-1 rounded":t===0?"text-warning bg-warning/10 px-2 py-1 rounded":"text-success"};return rt(()=>{H(),J(),Q(),m(1)}),(o,t)=>{var d,n,S,M,p;return a(),r("div",null,[t[34]||(t[34]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold"},"Reporte de Inventario"),e("p",{class:"text-gray-500"},"Gestión de stock y disponibilidad de productos.")],-1)),j.value?(a(),r("div",ut,"Cargando datos...")):g("",!0),w.value?(a(),r("div",ct,l(w.value),1)):g("",!0),x.value?(a(),r("div",pt,[at(dt,{"total-products":((d=x.value.product_stats)==null?void 0:d.total)||0,"active-products":((n=x.value.product_stats)==null?void 0:n.active)||0,"low-stock-products":((S=x.value.product_stats)==null?void 0:S.low_stock)||0,"out-of-stock-products":((M=x.value.product_stats)==null?void 0:M.out_of_stock)||0,class:"mb-6"},null,8,["total-products","active-products","low-stock-products","out-of-stock-products"]),e("div",vt,[e("div",gt,[e("div",null,[t[11]||(t[11]=e("h2",{class:"text-xl font-bold"},"Inventario de Productos",-1)),i.value.total>0?(a(),r("div",xt," Total: "+l(i.value.total)+" productos ",1)):g("",!0)]),e("div",mt,[e("div",yt,[t[13]||(t[13]=e("label",{for:"category",class:"font-bold text-xs whitespace-nowrap"},"Categoría:",-1)),I(e("select",{id:"category",class:"form-select w-40","onUpdate:modelValue":t[0]||(t[0]=s=>u.value.category=s),onChange:t[1]||(t[1]=s=>m(1))},[t[12]||(t[12]=e("option",{value:""},"Todas",-1)),(a(!0),r(k,null,h(O.value,s=>(a(),r("option",{key:s.id,value:s.id},l(s.name),9,bt))),128))],544),[[U,u.value.category]])]),e("div",ft,[t[15]||(t[15]=e("label",{for:"unit",class:"font-bold text-xs whitespace-nowrap"},"Unidad:",-1)),I(e("select",{id:"unit",class:"form-select w-32","onUpdate:modelValue":t[2]||(t[2]=s=>u.value.unit=s),onChange:t[3]||(t[3]=s=>m(1))},[t[14]||(t[14]=e("option",{value:""},"Todas",-1)),(a(!0),r(k,null,h(z.value,s=>(a(),r("option",{key:s.id,value:s.id},l(s.name),9,kt))),128))],544),[[U,u.value.unit]])]),e("div",ht,[t[17]||(t[17]=e("label",{for:"stockStatus",class:"font-bold text-xs whitespace-nowrap"},"Estado Stock:",-1)),I(e("select",{id:"stockStatus",class:"form-select w-40","onUpdate:modelValue":t[4]||(t[4]=s=>u.value.stockStatus=s),onChange:t[5]||(t[5]=s=>m(1))},[...t[16]||(t[16]=[e("option",{value:""},"Todos",-1),e("option",{value:"low"},"Bajo Stock",-1),e("option",{value:"out"},"Sin Stock",-1)])],544),[[U,u.value.stockStatus]])]),e("button",{type:"button",class:"btn btn-success gap-2",onClick:X},[...t[18]||(t[18]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{opacity:"0.5",d:"M17 9.00195C19.175 9.01406 20.3529 9.11051 21.1213 9.87893C22 10.7576 22 12.1718 22 15.0002V16.0002C22 18.8286 22 20.2428 21.1213 21.1215C20.2426 22.0002 18.8284 22.0002 16 22.0002H8C5.17157 22.0002 3.75736 22.0002 2.87868 21.1215C2 20.2428 2 18.8286 2 16.0002L2 15.0002C2 12.1718 2 10.7576 2.87868 9.87893C3.64706 9.11051 4.82497 9.01406 7 9.00195",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M12 15L12 2M12 15L9 11M12 15L15 11",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),q(" Exportar ",-1)])])])]),e("div",wt,[e("table",_t,[e("thead",null,[e("tr",null,[t[22]||(t[22]=e("th",null,"SKU",-1)),t[23]||(t[23]=e("th",null,"Producto",-1)),t[24]||(t[24]=e("th",null,"Categoría",-1)),e("th",Ct,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[6]||(t[6]=s=>N(s,"Cantidad real existente en bodega.")),onMouseleave:R},[...t[19]||(t[19]=[D('<span class="border-b border-dotted border-gray-400">Físico</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),e("th",St,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[7]||(t[7]=s=>N(s,"Suma de productos en órdenes activas (pendientes de facturar).")),onMouseleave:R},[...t[20]||(t[20]=[D('<span class="border-b border-dotted border-gray-400">Requerido</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),e("th",Mt,[e("div",{class:"flex items-center justify-center gap-1 cursor-help",onMouseenter:t[8]||(t[8]=s=>N(s,"Stock Físico menos Requerido. Si es negativo, falta mercancía.")),onMouseleave:R},[...t[21]||(t[21]=[D('<span class="border-b border-dotted border-gray-400">Disponible</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',2)])],32)]),t[25]||(t[25]=e("th",null,"Estado",-1))])]),e("tbody",null,[$.value?(a(),r("tr",Pt,[...t[26]||(t[26]=[e("td",{colspan:"7",class:"text-center py-4"},"Cargando inventario...",-1)])])):V.value.length===0?(a(),r("tr",jt,[...t[27]||(t[27]=[e("td",{colspan:"7",class:"text-center py-4"},"No se encontraron productos.",-1)])])):(a(!0),r(k,{key:2},h(V.value,s=>(a(),r("tr",{key:s.id},[e("td",null,l(s.sku),1),e("td",null,[e("div",Et,l(s.name),1),e("div",Lt,l(s.unit),1)]),e("td",null,[e("span",Nt,l(s.category),1)]),e("td",Rt,[e("span",{class:P([Y(s),"font-bold"])},l(s.stock),3)]),e("td",Tt,[e("span",Vt,l(s.committed_stock||0),1)]),e("td",$t,[e("span",{class:P(["font-bold",[Z(s),b(s)<0?"cursor-pointer hover:underline":""]]),onClick:f=>b(s)<0?F(s):null,title:b(s)<0?"Ver órdenes pendientes":""},l(b(s)),11,Bt)]),e("td",null,[e("span",{class:P(["badge",s.is_active?"bg-success/10 text-success":"bg-danger/10 text-danger"])},l(s.is_active?"Activo":"Inactivo"),3)])]))),128))])])]),i.value.last_page>1||i.value.total>0?(a(),r("div",It,[e("div",Ut,[t[29]||(t[29]=e("span",{class:"text-sm"},"Mostrar:",-1)),e("select",{class:"form-select w-20 h-9",value:i.value.per_page,onChange:W},[...t[28]||(t[28]=[e("option",{value:"10"},"10",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)])],40,Dt)]),e("ul",Ot,[e("li",null,[e("button",{type:"button",class:"flex justify-center font-semibold px-3.5 py-2 rounded transition text-dark hover:text-primary border-2 border-[#e0e6ed] dark:border-[#191e3a] hover:border-primary dark:hover:border-primary dark:text-white-light",disabled:i.value.current_page===1,onClick:t[9]||(t[9]=s=>B(i.value.current_page-1))}," Prev ",8,zt)]),(a(!0),r(k,null,h(G.value,(s,f)=>(a(),r("li",{key:f},[s!=="..."?(a(),r("button",{key:0,type:"button",class:P(["flex justify-center font-semibold px-3.5 py-2 rounded transition",{"text-primary border-2 border-primary dark:border-primary dark:text-white-light":i.value.current_page===s,"text-dark hover:text-primary border-2 border-[#e0e6ed] dark:border-[#191e3a] hover:border-primary dark:hover:border-primary dark:text-white-light":i.value.current_page!==s}]),onClick:tt=>B(s)},l(s),11,qt)):(a(),r("span",At,"..."))]))),128)),e("li",null,[e("button",{type:"button",class:"flex justify-center font-semibold px-3.5 py-2 rounded transition text-dark hover:text-primary border-2 border-[#e0e6ed] dark:border-[#191e3a] hover:border-primary dark:hover:border-primary dark:text-white-light",disabled:i.value.current_page===i.value.last_page,onClick:t[10]||(t[10]=s=>B(i.value.current_page+1))}," Next ",8,Ft)])])])):g("",!0)])])):g("",!0),v.visible?(a(),r("div",{key:3,class:"fixed z-[9999] px-3 py-2 text-xs font-medium text-white bg-black rounded shadow-lg pointer-events-none transform -translate-x-1/2 -translate-y-full mb-2 whitespace-normal max-w-xs text-center",style:nt({top:v.y+"px",left:v.x+"px"})},[q(l(v.text)+" ",1),t[30]||(t[30]=e("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 w-2 h-2 bg-black rotate-45"},null,-1))],4)):g("",!0),E.value?(a(),r("div",Kt,[e("div",Gt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:T}),t[33]||(t[33]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Ht,[e("div",Jt,[e("div",Qt,[e("div",Wt,[e("h3",Xt," Órdenes Pendientes: "+l((p=C.value)==null?void 0:p.name),1),e("div",Yt,[L.value?(a(),r("div",Zt,[...t[31]||(t[31]=[e("span",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-6 h-6 inline-block"},null,-1)])])):_.value.length===0?(a(),r("div",te," No hay órdenes pendientes encontradas. ")):(a(),r("ul",ee,[(a(!0),r(k,null,h(_.value,s=>{var f;return a(),r("li",{key:s.id,class:"py-3 flex justify-between items-center"},[e("div",null,[e("button",{type:"button",class:"text-sm font-medium text-primary hover:underline focus:outline-none",onClick:tt=>K(s.id),title:"Ver orden en Pipeline"}," #"+l(s.order_number),9,se),e("p",oe,l(s.supplier)+" - "+l(s.date),1),e("span",re,l(s.status),1)]),e("div",ae,[e("p",ne,l(s.quantity_requested)+" "+l((f=C.value)==null?void 0:f.unit),1),t[32]||(t[32]=e("p",{class:"text-xs text-gray-500"},"Solicitado",-1))])])}),128))]))])])])]),e("div",{class:"bg-gray-50 dark:bg-[#121c2c] px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:T}," Cerrar ")])])])])):g("",!0)])}}});export{pe as default};
