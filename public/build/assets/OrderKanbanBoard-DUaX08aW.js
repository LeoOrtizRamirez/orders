import{V as Ee}from"./vue-draggable-next.esm-bundler-DWdGXwbi.js";import{b as _e,d as j,_ as Be,u as Ae}from"./main-0YACWvfc.js";import{S as ce}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{r as q,c as Y,d as me,k as c,x as I,l as i,m as e,t as r,H as ue,A as U,K as Ce,n as T,F as E,D as P,a2 as G,y as R,J as Pe,I as Ie,q as z,f as B,u as f,z as Ne,w as Oe,o as Ue,G as Le,E as Te}from"./vendor-CjqaLWPm.js";import{Y as je,h as pe,_ as qe,G as Ve,S as Me}from"./transition-CBBt4QPa.js";import{_ as Re}from"./AlertMessages.vue_vue_type_script_setup_true_lang-CV0GMxpE.js";import"./quill-De1S0mUZ.js";import"./hidden-EHDRiAGA.js";import"./keyboard-DucK85rM.js";import"./open-closed-CzbEUxkg.js";function ze(){const{t:p}=_e(),h=q([]),k=q([]),O=q([]),A=q(!1),M=q(!1),v=q(""),D=q(""),V=q({}),N=q(""),a=q({show:!1,data:null}),w=q(null),t=q({status:"",supplier_id:""}),d={id:null,supplier_id:null,expected_delivery_date:null,notes:"",items:[]},o=q({...d}),x=Y(()=>{let s=h.value;if(N.value){const n=N.value.toLowerCase();s=s.filter(u=>{var l,m,C;return((l=u.order_number)==null?void 0:l.toLowerCase().includes(n))||((C=(m=u.supplier)==null?void 0:m.name)==null?void 0:C.toLowerCase().includes(n))})}return t.value.status&&(s=s.filter(n=>n.status===t.value.status)),t.value.supplier_id&&(s=s.filter(n=>n.supplier_id===parseInt(t.value.supplier_id))),s}),_=Y(()=>h.value.length),$=Y(()=>h.value.filter(s=>s.status==="pending").length),H=Y(()=>h.value.filter(s=>s.status==="approved").length),X=Y(()=>h.value.filter(s=>s.status==="ordered").length),Z=Y(()=>h.value.filter(s=>s.status==="received").length),K=async()=>{A.value=!0,v.value="";try{const s=new URLSearchParams;t.value.status&&s.append("status",t.value.status),t.value.supplier_id&&s.append("supplier_id",t.value.supplier_id);const n=await j.get(`/api/purchase-orders?${s}`);Array.isArray(n.data)?h.value=n.data:n.data&&Array.isArray(n.data.data)?h.value=n.data.data:n.data&&Array.isArray(n.data.orders)?h.value=n.data.orders:(console.warn("Estructura de respuesta inesperada:",n.data),h.value=[])}catch(s){console.error("Error fetching orders:",s),v.value=p("purchase_orders_page.alerts.loading_error"),b(p("purchase_orders_page.alerts.loading_error"),"error")}finally{A.value=!1}},ee=async()=>{try{const s=await j.get("/api/suppliers/for-select");Array.isArray(s.data)?k.value=s.data:s.data&&Array.isArray(s.data.data)?k.value=s.data.data:(console.warn("Estructura de respuesta inesperada para suppliers:",s.data),k.value=[])}catch(s){console.error("Error fetching suppliers:",s),k.value=[]}},he=async()=>{try{const s=await j.get("/api/products/active/list");Array.isArray(s.data)?O.value=s.data:s.data&&Array.isArray(s.data.data)?O.value=s.data.data:(console.warn("Estructura de respuesta inesperada para products:",s.data),O.value=[])}catch(s){console.error("Error fetching products:",s),O.value=[]}},J=s=>s&&O.value.find(n=>n.id===s)||null,ge=(s,n)=>{if(!s)return{valid:!1,message:"Producto no seleccionado"};const u=J(s);if(!u)return{valid:!1,message:"Producto no encontrado"};const l=u.current_stock||0;return n>l?{valid:!1,message:`Stock insuficiente. Stock disponible: ${l}`}:{valid:!0,message:""}},se=async()=>{M.value=!0,V.value={},v.value="",D.value="";try{let s;o.value.id?s=await j.put(`/api/purchase-orders/${o.value.id}`,o.value):s=await j.post("/api/purchase-orders",o.value);const n=s.data.data||s.data;if(o.value.id){const u=h.value.findIndex(l=>l.id===o.value.id);u!==-1&&h.value.splice(u,1,n),b(p("purchase_orders_page.alerts.update_success"))}else h.value.unshift(n),b(p("purchase_orders_page.alerts.save_success"));return!0}catch(s){return s.response&&s.response.status===422?(V.value=s.response.data.errors,v.value=p("purchase_orders_page.alerts.validation_errors")):(console.error("Error saving order:",s),v.value=p("purchase_orders_page.alerts.save_error"),b(p("purchase_orders_page.alerts.save_error"),"error")),!1}finally{M.value=!1}},re=async s=>{var u;if(!s.can_be_deleted)return b(p("purchase_orders_page.alerts.cannot_delete"),"error"),!1;if((await ce.fire({title:p("purchase_orders_page.delete_confirm.title"),text:p("purchase_orders_page.delete_confirm.text"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:p("purchase_orders_page.delete_confirm.confirm"),cancelButtonText:p("purchase_orders_page.delete_confirm.cancel")})).isConfirmed)try{return await j.delete(`/api/purchase-orders/${s.id}`),h.value=h.value.filter(l=>l.id!==s.id),b(p("purchase_orders_page.alerts.delete_success")),!0}catch(l){return console.error("Error deleting order:",l),((u=l.response)==null?void 0:u.status)===400?b(l.response.data.message,"error"):b(p("purchase_orders_page.alerts.delete_error"),"error"),!1}return!1},W=async s=>{var n,u;try{const l=await j.post(`/api/purchase-orders/${s.id}/submit`);if(l.data.success){const m=h.value.findIndex(C=>C.id===s.id);return m!==-1&&h.value.splice(m,1,l.data.order),b(p("purchase_orders_page.alerts.submit_success")),!0}else return b(l.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(l){console.error("Error submitting order:",l);const m=((u=(n=l.response)==null?void 0:n.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return b(m,"error"),!1}},F=async s=>{var n,u;try{const l=await j.post(`/api/purchase-orders/${s.id}/approve`);if(l.data.success){const m=h.value.findIndex(C=>C.id===s.id);return m!==-1&&h.value.splice(m,1,l.data.order),b(p("purchase_orders_page.alerts.approve_success")),!0}else return b(l.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(l){console.error("Error approving order:",l);const m=((u=(n=l.response)==null?void 0:n.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return b(m,"error"),!1}},L=async s=>{var u,l;const{value:n}=await ce.fire({title:p("purchase_orders_page.reject_confirm.title"),input:"textarea",inputLabel:p("purchase_orders_page.reject_confirm.input_label"),inputPlaceholder:p("purchase_orders_page.reject_confirm.input_placeholder"),inputAttributes:{"aria-label":p("purchase_orders_page.reject_confirm.input_label")},showCancelButton:!0,confirmButtonText:p("purchase_orders_page.reject_confirm.confirm"),cancelButtonText:p("purchase_orders_page.reject_confirm.cancel"),inputValidator:m=>m?null:p("purchase_orders_page.reject_confirm.input_required")});if(n)try{const m=await j.post(`/api/purchase-orders/${s.id}/reject`,{rejection_reason:n});if(m.data.success){const C=h.value.findIndex(te=>te.id===s.id);return C!==-1&&h.value.splice(C,1,m.data.order),b(p("purchase_orders_page.alerts.reject_success")),!0}else return b(m.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(m){console.error("Error rejecting order:",m);const C=((l=(u=m.response)==null?void 0:u.data)==null?void 0:l.message)||p("purchase_orders_page.alerts.save_error");return b(C,"error"),!1}return!1},ve=async s=>{var n,u;try{const l=await j.post(`/api/purchase-orders/${s.id}/mark-ordered`);if(l.data.success){const m=h.value.findIndex(C=>C.id===s.id);return m!==-1&&h.value.splice(m,1,l.data.order),b(p("purchase_orders_page.alerts.mark_ordered_success")),!0}else return b(l.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(l){console.error("Error marking order as ordered:",l);const m=((u=(n=l.response)==null?void 0:n.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return b(m,"error"),!1}},fe=async s=>{var n,u;try{const l=await j.post(`/api/purchase-orders/${s.id}/receive`);if(l.data.success){const m=h.value.findIndex(C=>C.id===s.id);return m!==-1&&h.value.splice(m,1,l.data.order),b(p("purchase_orders_page.alerts.receive_success")),!0}else return b(l.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(l){console.error("Error receiving order:",l);const m=((u=(n=l.response)==null?void 0:n.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return b(m,"error"),!1}},ye=async s=>{var u,l;const{value:n}=await ce.fire({title:p("purchase_orders_page.cancel_confirm.title"),input:"textarea",inputLabel:p("purchase_orders_page.cancel_confirm.input_label"),inputPlaceholder:p("purchase_orders_page.cancel_confirm.input_placeholder"),showCancelButton:!0,confirmButtonText:p("purchase_orders_page.cancel_confirm.confirm"),cancelButtonText:p("purchase_orders_page.cancel_confirm.cancel")});if(n!==void 0)try{const m=await j.post(`/api/purchase-orders/${s.id}/cancel`,{reason:n||null});if(m.data.success){const C=h.value.findIndex(te=>te.id===s.id);return C!==-1&&h.value.splice(C,1,m.data.order),b(p("purchase_orders_page.alerts.cancel_success")),!0}else return b(m.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(m){console.error("Error canceling order:",m);const C=((l=(u=m.response)==null?void 0:u.data)==null?void 0:l.message)||p("purchase_orders_page.alerts.save_error");return b(C,"error"),!1}return!1},be=async s=>{var n,u;try{const l=await j.post(`/api/purchase-orders/${s.id}/reopen`);if(l.data.success){const m=h.value.findIndex(C=>C.id===s.id);return m!==-1&&h.value.splice(m,1,l.data.order),b(p("purchase_orders_page.alerts.reopen_success")),!0}else return b(l.data.message||p("purchase_orders_page.alerts.save_error"),"error"),!1}catch(l){console.error("Error reopening order:",l);const m=((u=(n=l.response)==null?void 0:n.data)==null?void 0:u.message)||p("purchase_orders_page.alerts.save_error");return b(m,"error"),!1}},ae=async(s,n)=>{M.value=!0,V.value={},v.value="",D.value="";try{const u=await j.post(`/api/purchase-orders/${s}/split`,n);return u.data?(await K(),b(p("purchase_orders_page.alerts.split_success")),!0):(b(u.data.message||p("purchase_orders_page.alerts.split_error"),"error"),!1)}catch(u){return u.response&&u.response.status===422?(V.value=u.response.data.errors,v.value=p("purchase_orders_page.alerts.validation_errors")):(console.error("Error splitting order:",u),v.value=p("purchase_orders_page.alerts.split_error"),b(p("purchase_orders_page.alerts.split_error"),"error")),!1}finally{M.value=!1}},oe=async s=>{A.value=!0;try{return(await j.get(`/api/purchase-orders/${s}`)).data}catch(n){return console.error("Error fetching order details:",n),b(p("purchase_orders_page.alerts.loading_error"),"error"),null}finally{A.value=!1}},we=async(s=null)=>{var n;if(V.value={},s){const u=await oe(s.id);if(!u)return;w.value=u.notes;const l=u.expected_delivery_date?new Date(u.expected_delivery_date).toISOString().split("T")[0]:null;o.value={id:u.id,supplier_id:u.supplier_id,expected_delivery_date:l,items:((n=u.items)==null?void 0:n.map(m=>({id:m.id,product_id:m.product_id,quantity:m.quantity,itemNotes:m.item_notes||[],notes:"",checked:m.checked??!1})))||[]}}else w.value=null,o.value={...d,items:[de()]}},ne=()=>{o.value={...d},w.value=null,V.value={}},de=()=>({product_id:null,quantity:1,itemNotes:[],checked:!1}),le=()=>{o.value.items.push(de())},ie=s=>{o.value.items.splice(s,1),o.value.items.length===0&&le()},xe=s=>({draft:"bg-gray-100 text-gray-800",pending:"bg-warning/10 text-warning",approved:"bg-success/10 text-success",rejected:"bg-danger/10 text-danger",ordered:"bg-info/10 text-info",received:"bg-secondary/10 text-secondary",cancelled:"bg-danger/10 text-danger"})[s]||"bg-gray-100 text-gray-800",b=(s="",n="success")=>{n==="success"?D.value=s:v.value=s,ce.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3}).fire({icon:n,title:s,padding:"10px 20px"})};return{ordersList:h,suppliers:k,products:O,loading:A,saving:M,errorMessage:v,successMessage:D,errors:V,searchOrder:N,filters:t,params:o,viewModal:a,orderNotes:w,filteredOrdersList:x,totalOrders:_,pendingOrders:$,approvedOrders:H,orderedOrders:X,receivedOrders:Z,fetchOrders:K,fetchSuppliers:ee,fetchProducts:he,getProductInfo:J,validateQuantity:ge,saveOrder:se,deleteOrder:re,submitOrder:W,approveOrder:F,rejectOrder:L,markAsOrdered:ve,receiveOrder:fe,cancelOrder:ye,reopenOrder:be,editOrder:we,resetParams:ne,addItem:le,removeItem:ie,getStatusClass:xe,showMessage:b,formatDate:s=>s?new Date(s).toLocaleDateString("es-ES"):"-",viewOrder:async s=>{a.value={show:!0,data:null};const n=await oe(s);n?a.value.data=n:a.value.show=!1},refreshViewOrderData:async s=>{const n=await oe(s);n&&(a.value.data=n)},closeViewModal:()=>{a.value={show:!1,data:null}},splitOrder:ae}}const He={key:0,class:"fixed inset-0 bg-[black]/60 z-50 overflow-y-auto"},Ke={class:"flex items-start justify-center min-h-screen px-4"},Fe={class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl my-8"},Ge={class:"flex bg-[#fbfbfb] dark:bg-[#1c232f] items-center justify-between px-5 py-3"},Qe={class:"font-bold text-lg"},Ye={class:"p-5"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5"},We={for:"supplier",class:"form-label"},Xe={value:""},Ze=["value"],es={key:0,class:"text-danger mt-1 text-xs"},ss={for:"expected_delivery_date",class:"form-label"},ts={key:0,class:"text-danger mt-1 text-xs"},rs={class:"mb-5"},as={class:"flex justify-between items-center mb-3"},os={class:"form-label"},ns={class:"space-y-4"},ds={class:"grid grid-cols-1 md:grid-cols-[auto_1.5fr_1fr_auto] gap-4 items-start"},ls={class:"flex justify-center mt-8"},is=["onUpdate:modelValue"],cs={class:"form-label"},us=["onUpdate:modelValue"],ps={value:""},_s=["value"],ms={key:0,class:"text-danger text-xs"},hs={key:1,class:"text-success text-xs"},gs={key:0,class:"text-danger mt-1 text-xs"},vs={class:"form-label"},fs=["onUpdate:modelValue","onInput"],ys={key:0,class:"text-danger mt-1 text-xs"},bs={class:"mt-3"},ws={class:"form-label font-semibold text-xs"},xs={class:"bg-gray-100 dark:bg-gray-700 p-2 rounded space-y-2 max-h-24 overflow-y-auto mb-2"},$s={class:"font-semibold"},ks={class:"text-gray-500 text-xs"},Cs={class:"text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Os={key:0,class:"text-gray-500 text-xs"},Ss=["placeholder","onUpdate:modelValue"],Is={class:"flex justify-end mt-7"},js=["onClick"],qs={class:"mb-5"},Vs={class:"form-label font-semibold"},Ms={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded space-y-3 mb-3"},Ds={class:"font-semibold"},Es={class:"text-gray-500 text-xs"},Bs={class:"text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},As={key:0,class:"text-gray-500"},Ps={for:"notes",class:"form-label text-xs"},Ns=["placeholder"],Us={class:"flex justify-end items-center mt-8 border-t pt-4"},Ls=["disabled"],Ts=["disabled"],Rs={key:0,class:"flex items-center"},zs={key:1},Hs=me({__name:"PurchaseOrderModal",props:{show:{type:Boolean},params:{},errors:{},saving:{type:Boolean},suppliers:{},products:{},existingOrderNotes:{}},emits:["close","save","add-item","remove-item","refresh-view-order"],setup(p,{emit:h}){const{t:k}=_e(),O=p,A=h,M=Y(()=>O.products.filter(t=>t.is_active!==!1)),v=Y(()=>{const t=O.params.items.length>0&&O.params.items.every(d=>d.product_id&&d.quantity>0);return O.params.supplier_id&&O.params.expected_delivery_date&&t}),D=(t,d)=>{d<1&&(O.params.items[t].quantity=1)},V=t=>{if(!t)return 0;const d=O.products.find(o=>o.id===t);return(d==null?void 0:d.stock)||0},N=t=>{if(!t)return"";const d=O.products.find(o=>o.id===t);return d?d.stock===0?"text-danger":d.stock<=(d.reorder_point||0)?"text-warning":"text-success":""},a=t=>t?new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",w=()=>{console.log("PurchaseOrderModal: Emitting close event"),A("close")};return(t,d)=>t.show?(i(),c("div",He,[e("div",Ke,[e("div",Fe,[e("div",Ge,[e("h5",Qe,r(t.params.id?t.$t("purchase_orders_page.create_modal.edit_title"):t.$t("purchase_orders_page.create_modal.add_title")),1),e("button",{type:"button",class:"text-white-dark hover:text-dark",onClick:d[0]||(d[0]=o=>w())},[...d[7]||(d[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",Ye,[e("form",{onSubmit:d[6]||(d[6]=ue(o=>t.$emit("save",t.params),["prevent"]))},[e("div",Je,[e("div",null,[e("label",We,r(t.$t("purchase_orders_page.create_modal.fields.supplier"))+" * ",1),U(e("select",{id:"supplier","onUpdate:modelValue":d[1]||(d[1]=o=>t.params.supplier_id=o),class:T(["form-select",{"border-danger":t.errors.supplier_id}]),required:""},[e("option",Xe,r(t.$t("purchase_orders_page.create_modal.placeholders.select_supplier")),1),(i(!0),c(E,null,P(t.suppliers,o=>(i(),c("option",{key:o.id,value:o.id},r(o.name),9,Ze))),128))],2),[[Ce,t.params.supplier_id]]),t.errors.supplier_id?(i(),c("div",es,r(t.errors.supplier_id[0]),1)):I("",!0)]),e("div",null,[e("label",ss,r(t.$t("purchase_orders_page.create_modal.fields.expected_delivery_date"))+" * ",1),U(e("input",{id:"expected_delivery_date",type:"date","onUpdate:modelValue":d[2]||(d[2]=o=>t.params.expected_delivery_date=o),class:T(["form-input",{"border-danger":t.errors.expected_delivery_date}]),required:""},null,2),[[G,t.params.expected_delivery_date]]),t.errors.expected_delivery_date?(i(),c("div",ts,r(t.errors.expected_delivery_date[0]),1)):I("",!0)])]),e("div",rs,[e("div",as,[e("label",os,r(t.$t("purchase_orders_page.create_modal.fields.items"))+" * ",1),e("button",{type:"button",class:"btn btn-primary btn-sm",onClick:d[3]||(d[3]=o=>t.$emit("add-item"))}," + "+r(t.$t("purchase_orders_page.create_modal.buttons.add_item")),1)]),e("div",ns,[(i(!0),c(E,null,P(t.params.items,(o,x)=>(i(),c("div",{key:x,class:"border border-[#e0e6ed] dark:border-[#1b2e4b] rounded p-4 bg-gray-50 dark:bg-[#1a2234]"},[e("div",ds,[e("div",ls,[U(e("input",{type:"checkbox",class:"form-checkbox w-5 h-5","onUpdate:modelValue":_=>o.checked=_},null,8,is),[[Pe,o.checked]])]),e("div",null,[e("label",cs,r(t.$t("purchase_orders_page.create_modal.fields.product"))+" * ",1),U(e("select",{"onUpdate:modelValue":_=>o.product_id=_,class:T(["form-select",{"border-danger":t.errors[`items.${x}.product_id`]||!o.product_id&&o.quantity>0}]),required:""},[e("option",ps,r(t.$t("purchase_orders_page.create_modal.placeholders.select_product")),1),(i(!0),c(E,null,P(M.value,_=>(i(),c("option",{key:_.id,value:_.id},[R(r(_.name)+" ",1),!_.stock||_.stock<=0?(i(),c("span",ms," (Sin stock) ")):(i(),c("span",hs," (Stock: "+r(_.stock)+") ",1))],8,_s))),128))],10,us),[[Ce,o.product_id]]),t.errors[`items.${x}.product_id`]?(i(),c("div",gs,r(t.errors[`items.${x}.product_id`][0]),1)):I("",!0)]),e("div",null,[e("label",vs,r(t.$t("purchase_orders_page.create_modal.fields.quantity"))+" * ",1),U(e("input",{type:"number","onUpdate:modelValue":_=>o.quantity=_,min:"1",class:T(["form-input",{"border-danger":t.errors[`items.${x}.quantity`]}]),onInput:_=>D(x,o.quantity),required:""},null,42,fs),[[G,o.quantity,void 0,{number:!0}]]),t.errors[`items.${x}.quantity`]?(i(),c("div",ys,r(t.errors[`items.${x}.quantity`][0]),1)):I("",!0),o.product_id?(i(),c("div",{key:1,class:T(["mt-1 text-xs",N(o.product_id)])}," Stock actual: "+r(V(o.product_id)),3)):I("",!0),e("div",bs,[e("label",ws,r(t.$t("user_notes.notes_label")),1),e("div",xs,[(i(!0),c(E,null,P(o.itemNotes,_=>{var $;return i(),c("div",{key:_.id,class:"text-xs pb-1 border-b dark:border-gray-600 last:border-b-0"},[e("p",$s,[R(r(($=_.author)==null?void 0:$.name)+" ",1),e("span",ks,"- "+r(a(_.created_at)),1)]),e("p",Cs,r(_.note),1)])}),128)),!o.itemNotes||o.itemNotes.length===0?(i(),c("div",Os,r(t.$t("user_notes.no_notes_for_item")),1)):I("",!0)]),U(e("input",{type:"text",class:"form-input text-xs",placeholder:t.$t("purchase_orders_page.create_modal.placeholders.item_notes"),"onUpdate:modelValue":_=>o.notes=_},null,8,Ss),[[G,o.notes]])])]),e("div",Is,[t.params.items.length>1?(i(),c("button",{key:0,type:"button",class:"btn btn-outline-danger btn-sm p-2",onClick:_=>t.$emit("remove-item",x)},[...d[8]||(d[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,js)):I("",!0)])])]))),128))])]),e("div",qs,[e("label",Vs,r(t.$t("purchase_orders_page.view_modal.fields.notes")),1),e("div",Ms,[(i(!0),c(E,null,P(t.existingOrderNotes,o=>{var x;return i(),c("div",{key:o.id,class:"text-sm pb-2 border-b dark:border-gray-700 last:border-b-0"},[e("p",Ds,[R(r((x=o.author)==null?void 0:x.name)+" ",1),e("span",Es,"- "+r(a(o.created_at)),1)]),e("p",Bs,r(o.note),1)])}),128)),!t.existingOrderNotes||t.existingOrderNotes.length===0?(i(),c("div",As,r(t.$t("user_notes.no_notes_general")),1)):I("",!0)]),e("label",Ps,r(t.$t("purchase_orders_page.create_modal.fields.add_note")),1),U(e("textarea",{id:"notes","onUpdate:modelValue":d[4]||(d[4]=o=>t.params.notes=o),class:"form-textarea min-h-[80px]",placeholder:t.$t("purchase_orders_page.create_modal.placeholders.notes"),rows:"3"},null,8,Ns),[[G,t.params.notes]])]),e("div",Us,[e("button",{type:"button",class:"btn btn-outline-danger mr-3",onClick:d[5]||(d[5]=o=>w()),disabled:t.saving},r(t.$t("purchase_orders_page.create_modal.buttons.cancel")),9,Ls),e("button",{type:"submit",class:"btn btn-primary",disabled:t.saving||!v.value},[t.saving?(i(),c("span",Rs,[d[9]||(d[9]=e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),R(" "+r(t.$t("purchase_orders_page.create_modal.buttons.saving")),1)])):(i(),c("span",zs,r(t.params.id?t.$t("purchase_orders_page.create_modal.buttons.update"):t.$t("purchase_orders_page.create_modal.buttons.add")),1))],8,Ts)])],32)])])])])):I("",!0)}}),Ks={class:"fixed inset-0 overflow-y-auto"},Fs={class:"flex min-h-full items-center justify-center px-4 py-8"},Gs={class:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},Qs={key:0},Ys={key:1,class:"text-gray-500"},Js={class:"p-5"},Ws={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Xs={class:"space-y-4"},Zs={class:"font-semibold text-gray-600"},et={class:"text-lg"},st={class:"text-sm text-gray-500"},tt={class:"text-sm text-gray-500"},rt={class:"font-semibold text-gray-600"},at={class:"font-semibold text-gray-600"},ot={class:"text-sm text-gray-500"},nt={key:0},dt={class:"font-semibold text-gray-600"},lt={class:"text-lg"},it={key:1},ct={class:"font-semibold text-gray-600"},ut={class:"flex flex-wrap gap-2"},pt=["onClick"],_t={class:"space-y-4"},mt={class:"font-semibold text-gray-600"},ht={class:"font-semibold text-gray-600"},gt={key:0,class:"text-xs ml-2"},vt={key:1,class:"text-xs ml-2 text-success"},ft={key:0},yt={class:"font-semibold text-gray-600"},bt={key:1},wt={class:"font-semibold text-gray-600"},xt={class:"text-sm text-gray-500"},$t={class:"mb-6"},kt={class:"text-lg font-semibold mb-4"},Ct={class:"table-responsive"},Ot={class:"table-striped table-hover"},St={class:"text-center"},It={class:"font-semibold"},jt={class:"text-sm text-gray-500"},qt={class:"mt-2 space-y-2 text-xs"},Vt={class:"font-semibold"},Mt={class:"text-gray-500 text-xs"},Dt={class:"text-gray-600 dark:text-gray-300"},Et={key:0,class:"text-gray-500"},Bt={class:"text-center"},At={class:"text-center"},Pt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Nt={class:"space-y-2"},Ut={class:"mb-2"},Lt={class:"font-semibold text-gray-600"},Tt={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded space-y-3"},Rt={class:"font-semibold"},zt={class:"text-gray-500 text-xs"},Ht={class:"text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Kt={key:0,class:"text-gray-500"},Ft={key:0},Gt={class:"font-semibold text-danger"},Qt={class:"bg-danger/10 text-danger p-3 rounded"},Yt={class:"flex justify-end items-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},Jt={key:1,class:"text-center py-8"},Wt={class:"text-gray-500"},Xt=me({__name:"PurchaseOrderViewModal",props:{show:{type:Boolean},order:{}},emits:["close","view-order-id","refresh-view-order"],setup(p,{emit:h}){const k=h,O=a=>({"nuevo pedido":"bg-gray-100 text-gray-800",disponibilidad:"bg-secondary/10 text-secondary","preparar pedido":"bg-success/10 text-success","en preparación":"bg-info/10 text-info",facturación:"bg-primary/10 text-primary","en despacho":"bg-warning/10 text-warning","en ruta":"bg-danger/10 text-danger",entregado:"bg-success/10 text-success"})[a]||"bg-gray-100 text-gray-800",A=a=>!a||a.stock===void 0?"":a.stock===0?"text-danger":a.stock<=(a.reorder_point||0)?"text-warning":"text-success",M=a=>a.expected_delivery_date?new Date(a.expected_delivery_date)<new Date&&a.status!=="received":!1,v=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"-",D=a=>a?new Date(a).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",V=()=>{window.print()},N=()=>{console.log("PurchaseOrderViewModal: Emitting close event"),k("close")};return(a,w)=>(i(),Ie(f(Me),{appear:"",show:a.show,as:"template"},{default:z(()=>[B(f(je),{as:"div",onClose:w[3]||(w[3]=t=>a.$emit("close")),class:"relative z-[51]"},{default:z(()=>[B(f(pe),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:z(()=>[B(f(qe),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",Ks,[e("div",Fs,[B(f(pe),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:z(()=>[B(f(Ve),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-4xl text-black dark:text-white-dark"},{default:z(()=>{var t,d,o,x,_;return[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:w[0]||(w[0]=$=>N())},[...w[4]||(w[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),e("div",Gs,[R(r(a.$t("purchase_orders_page.view_modal.title"))+" ",1),a.order?(i(),c("span",Qs,r(a.order.order_number),1)):(i(),c("span",Ys,r(a.$t("purchase_orders_page.view_modal.status.loading")),1))]),e("div",Js,[a.order?(i(),c(E,{key:0},[e("div",Ws,[e("div",Xs,[e("div",null,[e("label",Zs,r(a.$t("purchase_orders_page.view_modal.fields.supplier"))+": ",1),e("p",et,r((t=a.order.supplier)==null?void 0:t.name),1),e("p",st,r((d=a.order.supplier)==null?void 0:d.contact_person),1),e("p",tt,r((o=a.order.supplier)==null?void 0:o.email),1)]),e("div",null,[e("label",rt,r(a.$t("purchase_orders_page.view_modal.fields.status"))+": ",1),e("span",{class:T(["badge ml-2",O(a.order.status)])},r(a.$t(`purchase_orders_page.status.${a.order.status.replace(/ /g,"_")}`)),3)]),e("div",null,[e("label",at,r(a.$t("purchase_orders_page.view_modal.fields.created_by"))+": ",1),e("p",null,r((x=a.order.creator)==null?void 0:x.name),1),e("p",ot,r(v(a.order.created_at)),1)]),a.order.parent?(i(),c("div",nt,[e("label",dt,r(a.$t("purchase_orders_page.view_modal.fields.parent_order"))+": ",1),e("p",lt,[e("a",{href:"#",onClick:w[1]||(w[1]=ue($=>a.$emit("view-order-id",a.order.parent.id),["prevent"])),class:"btn btn-outline-info btn-sm"}," #"+r(a.order.parent.order_number),1)])])):I("",!0),a.order.sub_orders&&a.order.sub_orders.length>0?(i(),c("div",it,[e("label",ct,r(a.$t("purchase_orders_page.view_modal.fields.sub_orders"))+": ",1),e("div",ut,[(i(!0),c(E,null,P(a.order.sub_orders,$=>(i(),c("a",{key:$.id,href:"#",onClick:ue(H=>a.$emit("view-order-id",$.id),["prevent"]),class:"btn btn-outline-info btn-sm"}," #"+r($.order_number),9,pt))),128))])])):I("",!0)]),e("div",_t,[e("div",null,[e("label",mt,r(a.$t("purchase_orders_page.view_modal.fields.order_date"))+": ",1),e("p",null,r(v(a.order.order_date)),1)]),e("div",null,[e("label",ht,r(a.$t("purchase_orders_page.view_modal.fields.expected_delivery"))+": ",1),e("p",{class:T({"text-warning":M(a.order)})},[R(r(v(a.order.expected_delivery_date))+" ",1),M(a.order)?(i(),c("span",gt," ("+r(a.$t("purchase_orders_page.view_modal.delivery_status.delayed"))+") ",1)):a.order.expected_delivery_date?(i(),c("span",vt," ("+r(a.$t("purchase_orders_page.view_modal.delivery_status.on_time"))+") ",1)):I("",!0)],2)]),a.order.delivery_date?(i(),c("div",ft,[e("label",yt,r(a.$t("purchase_orders_page.view_modal.fields.delivery_date"))+": ",1),e("p",null,r(v(a.order.delivery_date)),1)])):I("",!0),a.order.approved_by?(i(),c("div",bt,[e("label",wt,r(a.$t("purchase_orders_page.view_modal.fields.approved_by"))+": ",1),e("p",null,r((_=a.order.approver)==null?void 0:_.name),1),e("p",xt,r(v(a.order.approved_at)),1)])):I("",!0)])]),e("div",$t,[e("h3",kt,r(a.$t("purchase_orders_page.view_modal.sections.order_items")),1),e("div",Ct,[e("table",Ot,[e("thead",null,[e("tr",null,[e("th",null,r(a.$t("purchase_orders_page.view_modal.fields.product")),1),e("th",St,r(a.$t("purchase_orders_page.view_modal.fields.quantity")),1),w[5]||(w[5]=e("th",{class:"text-center"}," Stock Actual ",-1))])]),e("tbody",null,[(i(!0),c(E,null,P(a.order.items,$=>{var H,X,Z;return i(),c("tr",{key:$.id},[e("td",null,[e("div",It,r((H=$.product)==null?void 0:H.name),1),e("div",jt,r((X=$.product)==null?void 0:X.sku),1),e("div",qt,[(i(!0),c(E,null,P($.item_notes,K=>{var ee;return i(),c("div",{key:K.id,class:"p-2 rounded bg-gray-100 dark:bg-gray-700"},[e("p",Vt,[R(r((ee=K.author)==null?void 0:ee.name)+" ",1),e("span",Mt,"- "+r(D(K.created_at)),1)]),e("p",Dt,r(K.note),1)])}),128)),!$.item_notes||$.item_notes.length===0?(i(),c("div",Et,r(a.$t("user_notes.no_notes_for_item")),1)):I("",!0)])]),e("td",Bt,r($.quantity),1),e("td",At,[e("span",{class:T(A($.product))},r(((Z=$.product)==null?void 0:Z.stock)??"-"),3)])])}),128))])])])]),e("div",Pt,[e("div",Nt,[e("div",Ut,[e("label",Lt,r(a.$t("purchase_orders_page.view_modal.fields.notes"))+": ",1),e("div",Tt,[(i(!0),c(E,null,P(a.order.notes,$=>{var H;return i(),c("div",{key:$.id,class:"text-sm pb-2 border-b dark:border-gray-700 last:border-b-0"},[e("p",Rt,[R(r((H=$.author)==null?void 0:H.name)+" ",1),e("span",zt,"- "+r(D($.created_at)),1)]),e("p",Ht,r($.note),1)])}),128)),!a.order.notes||a.order.notes.length===0?(i(),c("div",Kt,r(a.$t("user_notes.no_notes_general")),1)):I("",!0)])]),a.order.rejection_reason?(i(),c("div",Ft,[e("label",Gt,r(a.$t("purchase_orders_page.view_modal.fields.rejection_reason"))+": ",1),e("p",Qt,r(a.order.rejection_reason),1)])):I("",!0)])]),e("div",Yt,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:V},[w[6]||(w[6]=e("svg",{class:"w-4 h-4 ltr:mr-2 rtl:ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)),R(" "+r(a.$t("purchase_orders_page.view_modal.buttons.print")),1)]),e("button",{type:"button",class:"btn btn-outline-danger ltr:ml-4 rtl:mr-4",onClick:w[2]||(w[2]=$=>N())},r(a.$t("purchase_orders_page.view_modal.buttons.close")),1)])],64)):(i(),c("div",Jt,[w[7]||(w[7]=e("div",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-8 h-8 mx-auto mb-4"},null,-1)),e("p",Wt,r(a.$t("purchase_orders_page.view_modal.status.loading")),1)]))])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),Zt=Be(Xt,[["__scopeId","data-v-2f843438"]]),er={class:"fixed inset-0 overflow-y-auto"},sr={class:"flex min-h-full items-center justify-center px-4 py-8"},tr={class:"text-lg font-bold bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},rr={class:"p-5"},ar={class:"mb-5"},or={for:"expectedDeliveryDate"},nr=["placeholder"],dr={key:0,class:"text-danger mt-1"},lr={class:"mb-5"},ir={key:0},cr={class:"flex items-center justify-between mb-2"},ur={class:"flex-grow"},pr={class:"font-semibold"},_r={class:"w-1/3 ml-4 flex gap-2"},mr=["placeholder","onUpdate:modelValue","max","onInput"],hr=["onClick"],gr=["placeholder","onUpdate:modelValue"],vr={key:0,class:"text-danger mt-1 w-full"},fr={key:0,class:"text-danger mt-1"},yr={key:1,class:"text-center text-gray-500"},br={class:"mb-5"},wr={key:0},xr={class:"flex items-start justify-between gap-3"},$r={class:"flex-grow"},kr=["onUpdate:modelValue"],Cr=["value"],Or={class:"w-24"},Sr=["onUpdate:modelValue"],Ir=["onClick"],jr=["placeholder","onUpdate:modelValue"],qr={key:1,class:"text-center text-gray-500 text-sm"},Vr={class:"mt-8 flex items-center justify-end"},Mr=["disabled"],Dr={key:0},Er={key:1},Br=me({__name:"PurchaseOrderSplitModal",props:{show:{type:Boolean},order:{},products:{},errors:{},saving:{type:Boolean}},emits:["close","split"],setup(p,{emit:h}){const{t:k}=_e(),O=h,A=p,M={expected_delivery_date:"",items:[],newItems:[]},v=Ne({...M});Oe(()=>A.order,t=>{t&&t.items?(v.items=t.items.map(d=>{var o;return{item_id:d.id,quantity:d.quantity,product_name:((o=d.product)==null?void 0:o.name)||"Unknown Product",original_quantity:d.quantity,notes:""}}).sort((d,o)=>d.product_name.localeCompare(o.product_name)),v.expected_delivery_date="",v.newItems=[]):(v.items=[],v.newItems=[])},{immediate:!0}),Oe(()=>A.show,t=>{t||(Object.assign(v,M),v.items=[],v.newItems=[])});const D=(t,d)=>{v.items[t].quantity<0?v.items[t].quantity=0:v.items[t].quantity>d&&(v.items[t].quantity=d)},V=t=>{v.items.splice(t,1)},N=()=>{v.newItems.push({product_id:null,quantity:1,notes:""})},a=t=>{v.newItems.splice(t,1)},w=()=>{const t=v.items.filter(_=>_.quantity>0),d=v.newItems.filter(_=>_.product_id&&_.quantity>0);if(t.length===0&&d.length===0){alert(k("purchase_orders_page.split_modal.alerts.no_items_selected"));return}const x=[...t.map(_=>({item_id:_.item_id,quantity:_.quantity,notes:_.notes})),...d];O("split",{expected_delivery_date:v.expected_delivery_date,items:x})};return(t,d)=>(i(),Ie(f(Me),{appear:"",show:t.show,as:"template"},{default:z(()=>[B(f(je),{as:"div",onClose:d[3]||(d[3]=o=>O("close")),class:"relative z-[51]"},{default:z(()=>[B(f(pe),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:z(()=>[B(f(qe),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",er,[e("div",sr,[B(f(pe),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:z(()=>[B(f(Ve),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark"},{default:z(()=>[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:d[0]||(d[0]=o=>O("close"))},[...d[4]||(d[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),e("div",tr,r(f(k)("purchase_orders_page.split_modal.title")),1),e("div",rr,[e("form",{onSubmit:ue(w,["prevent"])},[e("div",ar,[e("label",or,r(f(k)("purchase_orders_page.split_modal.fields.expected_delivery_date")),1),U(e("input",{id:"expectedDeliveryDate",type:"date",placeholder:f(k)("purchase_orders_page.split_modal.placeholders.expected_delivery_date"),class:T(["form-input",[t.errors.expected_delivery_date?"border-danger":""]]),"onUpdate:modelValue":d[1]||(d[1]=o=>v.expected_delivery_date=o)},null,10,nr),[[G,v.expected_delivery_date]]),t.errors.expected_delivery_date?(i(),c("p",dr,r(t.errors.expected_delivery_date[0]),1)):I("",!0)]),e("div",lr,[e("label",null,r(f(k)("purchase_orders_page.split_modal.fields.items_to_split")),1),v.items.length>0?(i(),c("div",ir,[(i(!0),c(E,null,P(v.items,(o,x)=>(i(),c("div",{key:o.item_id,class:"flex flex-col mb-3 border p-3 rounded"},[e("div",cr,[e("div",ur,[e("p",pr,r(o.product_name)+" ("+r(o.original_quantity)+" "+r(f(k)("purchase_orders_page.split_modal.available"))+")",1)]),e("div",_r,[U(e("input",{type:"number",placeholder:f(k)("purchase_orders_page.split_modal.placeholders.quantity_to_split"),class:"form-input","onUpdate:modelValue":_=>o.quantity=_,min:0,max:o.original_quantity,onInput:_=>D(x,o.original_quantity)},null,40,mr),[[G,o.quantity,void 0,{number:!0}]]),e("button",{type:"button",class:"btn btn-outline-danger btn-sm p-2",onClick:_=>V(x)},[...d[5]||(d[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,hr)])]),e("div",null,[U(e("input",{type:"text",class:"form-input text-xs",placeholder:f(k)("purchase_orders_page.create_modal.placeholders.item_notes"),"onUpdate:modelValue":_=>o.notes=_},null,8,gr),[[G,o.notes]])]),t.errors[`items.${x}.quantity`]?(i(),c("p",vr,r(t.errors[`items.${x}.quantity`][0]),1)):I("",!0)]))),128)),t.errors.items?(i(),c("p",fr,r(t.errors.items[0]),1)):I("",!0)])):(i(),c("div",yr,r(f(k)("purchase_orders_page.split_modal.no_items")),1))]),e("div",br,[e("div",{class:"flex items-center justify-between mb-2"},[d[6]||(d[6]=e("label",{class:"font-bold"},"Agregar Productos Extra",-1)),e("button",{type:"button",class:"btn btn-primary btn-sm",onClick:N}," + Agregar Item ")]),v.newItems.length>0?(i(),c("div",wr,[(i(!0),c(E,null,P(v.newItems,(o,x)=>(i(),c("div",{key:x,class:"flex flex-col mb-3 border p-3 rounded gap-3"},[e("div",xr,[e("div",$r,[U(e("select",{"onUpdate:modelValue":_=>o.product_id=_,class:"form-select w-full",required:""},[d[7]||(d[7]=e("option",{value:null},"Seleccionar Producto",-1)),(i(!0),c(E,null,P(t.products,_=>(i(),c("option",{key:_.id,value:_.id},r(_.name),9,Cr))),128))],8,kr),[[Ce,o.product_id]])]),e("div",Or,[U(e("input",{type:"number",class:"form-input","onUpdate:modelValue":_=>o.quantity=_,min:"1",placeholder:"Cant.",required:""},null,8,Sr),[[G,o.quantity,void 0,{number:!0}]])]),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>a(x)},[...d[8]||(d[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-5 h-5"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Ir)]),e("div",null,[U(e("input",{type:"text",class:"form-input text-xs",placeholder:f(k)("purchase_orders_page.create_modal.placeholders.item_notes"),"onUpdate:modelValue":_=>o.notes=_},null,8,jr),[[G,o.notes]])])]))),128))])):(i(),c("div",qr," No hay productos extra agregados. "))]),e("div",Vr,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:d[2]||(d[2]=o=>O("close"))},r(f(k)("purchase_orders_page.split_modal.buttons.cancel")),1),e("button",{type:"submit",class:"btn btn-primary ltr:ml-4 rtl:mr-4",disabled:t.saving},[t.saving?(i(),c("span",Dr,r(f(k)("purchase_orders_page.split_modal.buttons.splitting")),1)):(i(),c("span",Er,r(f(k)("purchase_orders_page.split_modal.buttons.split")),1))],8,Mr)])],32)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),Ar={class:"flex space-x-2 rtl:space-x-reverse mb-6"},Pr={href:"javascript:;",class:"text-primary hover:underline"},Nr={class:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2"},Ur={class:"scrumboard-v2 space-y-8"},Lr={class:"flex items-center justify-between flex-wrap gap-4"},Tr={class:"text-xl leading-relaxed"},Rr={class:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4"},zr={class:"flex gap-3"},Hr={class:"relative pt-5"},Kr={class:"h-full -mx-2"},Fr={key:0,class:"grid place-content-center h-[500px]"},Gr={key:1,class:"overflow-x-auto flex items-start flex-nowrap gap-5 px-2 pb-2"},Qr={class:"flex justify-between mb-5"},Yr={class:"text-base font-semibold"},Jr={class:"shadow bg-[#f4f4f4] dark:bg-white-dark/20 p-3 pb-5 rounded-md mb-5 space-y-3 cursor-move"},Wr={key:0,class:"flex items-center text-xs text-info font-semibold"},Xr={key:1,class:"flex items-center text-xs text-primary font-semibold"},Zr={class:"text-base font-medium"},ea={class:"flex items-center text-sm text-gray-500 font-semibold"},sa={class:"break-all text-sm text-gray-700 dark:text-gray-400"},ta={class:"flex items-center justify-between text-xs text-gray-500 mt-2"},ra={class:"flex justify-end mt-4 gap-2"},aa=["onClick"],oa=["onClick"],na=["onClick"],da=["onClick"],fa=me({__name:"OrderKanbanBoard",setup(p){const{t:h}=_e();Te();const k=Le();Ae({title:h("ordenes.order_kanban_board")});const{fetchSuppliers:O,fetchProducts:A,suppliers:M,products:v,loading:D,saving:V,errorMessage:N,successMessage:a,errors:w,params:t,viewModal:d,orderNotes:o,saveOrder:x,deleteOrder:_,editOrder:$,resetParams:H,viewOrder:X,refreshViewOrderData:Z,closeViewModal:K,addItem:ee,removeItem:he,showMessage:J,splitOrder:ge}=ze(),se=q(!1),re=q(!1),W=q(null),F=q([{id:"nuevo pedido",title:h("ordenes.status.nuevo_pedido"),badgeClass:"badge-outline-dark",borderColorClass:"border-gray-500",orders:[]},{id:"disponibilidad",title:h("ordenes.status.disponibilidad"),badgeClass:"badge-outline-secondary",borderColorClass:"border-secondary",orders:[]},{id:"preparar pedido",title:h("ordenes.status.preparar_pedido"),badgeClass:"badge-outline-success",borderColorClass:"border-success",orders:[]},{id:"en preparación",title:h("ordenes.status.en_preparacion"),badgeClass:"badge-outline-info",borderColorClass:"border-info",orders:[]},{id:"facturación",title:h("ordenes.status.facturacion"),badgeClass:"badge-outline-primary",borderColorClass:"border-primary",orders:[]},{id:"en despacho",title:h("ordenes.status.en_despacho"),badgeClass:"badge-outline-warning",borderColorClass:"border-warning",orders:[]},{id:"en ruta",title:h("ordenes.status.en_ruta"),badgeClass:"badge-outline-danger",borderColorClass:"border-danger",orders:[]},{id:"entregado",title:h("ordenes.status.entregado"),badgeClass:"badge-outline-success",borderColorClass:"border-success",orders:[]}]),L=async()=>{var g,y;D.value=!0;try{const s=(await j.get("/api/purchase-orders")).data.data;F.value.forEach(n=>{n.orders=[]}),s.forEach(n=>{const u=F.value.find(l=>l.id===n.status);if(u)u.orders.push(n);else{console.warn(`Order ${n.id} has unknown status: ${n.status}. Defaulting to 'nuevo pedido'.`);const l=F.value.find(m=>m.id==="nuevo pedido");l&&l.orders.push(n)}})}catch(S){console.error("Error fetching orders for Kanban:",S);const s=((y=(g=S.response)==null?void 0:g.data)==null?void 0:y.message)||h("ordenes.error_fetching_orders");J(s,"error")}finally{D.value=!1}},ve=async g=>{var C,te;const y=g.item._underlying_vm_.id,S=g.from.dataset.statusId,s=g.to.dataset.statusId;if(!s||!S){console.warn("Source or target status ID is undefined. Drag operation might be invalid. Reverting."),await L();return}const n=F.value.find(Q=>Q.id===S),u=F.value.find(Q=>Q.id===s);if(!n||!u){console.warn("Source or target status column not found. Reverting."),await L();return}const l=u.orders.find(Q=>Q.id===y);if(!l){console.warn(`Order with ID ${y} not found in new status column ${s}. Reverting.`),await L();return}const m=S;try{await j.put(`/api/purchase-orders/${y}/status`,{status:s}),J(h("ordenes.order_status_updated_successfully"),"success"),l&&(l.status=s)}catch(Q){console.error("Error updating order status:",Q);const De=((te=(C=Q.response)==null?void 0:C.data)==null?void 0:te.message)||h("ordenes.error_updating_order_status");J(De,"error");const Se=u.orders.findIndex(ke=>ke.id===y);if(Se!==-1){const ke=u.orders.splice(Se,1)[0];n.orders.splice(g.oldIndex,0,ke)}l&&(l.status=m),await L()}},fe=g=>{const y=["nuevo pedido","disponibilidad","preparar pedido","en preparación"];return!g.parent_id&&y.includes(g.status)},ye=()=>{$(null),se.value=!0},be=g=>{$(g),se.value=!0},ae=g=>{const y=typeof g=="number"?g:g.id;X(y)},oe=g=>{Z(g)},we=async g=>{await _(g)&&await L()},ne=()=>{se.value=!1,H(),L()},de=async()=>{await x()&&ne()},le=g=>{W.value=g,re.value=!0},ie=()=>{re.value=!1,W.value=null,w.value={}},xe=async g=>{var S;if(!((S=W.value)!=null&&S.id)){J(h("purchase_orders_page.split_modal.alerts.no_order_selected"),"error");return}await ge(W.value.id,g)&&(ie(),await L())},b=g=>{if(!g)return"";const y={year:"numeric",month:"short",day:"numeric"};return new Date(g).toLocaleDateString(void 0,y)},$e=g=>{if(!g)return;let y=null;for(const S of F.value)if(y=S.orders.find(s=>s.id===parseInt(g)),y)break;y&&ae(y)};return Ue(async()=>{await Promise.all([L(),O(),A()]),$e(k.params.orderId)}),Oe(()=>k.params.orderId,g=>{g&&$e(g)}),(g,y)=>(i(),c("div",null,[e("ul",Ar,[e("li",null,[e("a",Pr,r(g.$t("dashboard")),1)]),e("li",Nr,[e("span",null,r(g.$t("ordenes.kanban_board")),1)])]),e("div",Ur,[e("div",Lr,[e("h2",Tr,r(g.$t("ordenes.order_kanban_board")),1),e("div",Rr,[e("div",zr,[e("button",{type:"button",class:"btn btn-primary",onClick:ye},[y[2]||(y[2]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-5 h-5 ltr:mr-3 rtl:ml-3"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)),R(" "+r(g.$t("purchase_orders_page.add_order_btn")),1)]),e("button",{type:"button",class:"btn btn-primary",onClick:L},[y[3]||(y[3]=e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5"},[e("path",{d:"M20.9999 12C20.9999 16.9706 16.9705 21 11.9999 21C7.02934 21 2.99994 16.9706 2.99994 12C2.99994 7.02944 7.02934 3 11.9999 3",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M18.8477 15.6529C19.7897 14.0533 20.2522 13.0166 20.4939 12",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M17.9999 3L20.9999 7H16.9999",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),R(" "+r(g.$t("ordenes.refresh")),1)])])])]),B(Re,{"error-message":f(N),"success-message":f(a),onClearError:y[0]||(y[0]=S=>N.value=""),onClearSuccess:y[1]||(y[1]=S=>a.value="")},null,8,["error-message","success-message"]),e("div",Hr,[e("div",Kr,[f(D)?(i(),c("div",Fr,[...y[4]||(y[4]=[e("span",{class:"animate-spin border-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle"},null,-1)])])):(i(),c("div",Gr,[(i(!0),c(E,null,P(F.value,S=>(i(),c("div",{key:S.id,class:T(["panel w-80 flex-none border-2 border-solid rounded-lg",S.borderColorClass])},[e("div",Qr,[e("h4",Yr,r(S.title),1),e("span",{class:T(["badge",S.badgeClass])},r(S.orders.length),3)]),B(f(Ee),{class:"connect-sorting-content min-h-[150px]",list:S.orders,group:"kanban-board","ghost-class":"sortable-ghost","drag-class":"sortable-drag",animation:200,onEnd:ve,"data-status-id":S.id},{default:z(()=>[(i(!0),c(E,null,P(S.orders,s=>{var n,u;return i(),c("div",{class:"sortable-list",key:s.id},[e("div",Jr,[s.parent_id?(i(),c("div",Wr,[y[5]||(y[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-4 h-4 mr-1"},[e("polyline",{points:"15 10 20 15 15 20"}),e("path",{d:"M4 4v7a4 4 0 0 0 4 4h12"})],-1)),e("span",null,r(g.$t("ordenes.sub_order")),1)])):I("",!0),s.sub_orders_count>0&&!s.parent_id?(i(),c("div",Xr,[...y[6]||(y[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-4 h-4 mr-1"},[e("path",{d:"M17 2.1l4 4-4 4"}),e("path",{d:"M3 12.6v-2.1c0-4.4 3.6-8 8-8h7"}),e("path",{d:"M7 21.9l-4-4 4-4"}),e("path",{d:"M21 11.4v2.1c0 4.4-3.6 8-8 8H6"})],-1),e("span",null,"Orden Principal",-1)])])):I("",!0),e("div",Zr,r(s.order_number)+" - "+r(((n=s.creator)==null?void 0:n.name)||"N/A"),1),e("div",ea,[y[7]||(y[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-3.5 h-3.5 mr-1"},[e("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),e("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})],-1)),e("span",null,r(((u=s.supplier)==null?void 0:u.name)||g.$t("purchase_orders_page.kanban.no_supplier")),1)]),e("p",sa,r(s.notes?Array.isArray(s.notes)&&s.notes.length>0?s.notes[0].note:"":g.$t("purchase_orders_page.kanban.no_description")),1),e("div",ta,[e("span",null,r(g.$t("ordenes.created_at"))+": "+r(b(s.created_at)),1)]),e("div",ra,[e("button",{type:"button",class:"btn btn-outline-info btn-sm",onClick:l=>ae(s)},r(g.$t("ordenes.view_details")),9,aa),e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:l=>be(s)},r(g.$t("edit")),9,oa),fe(s)?(i(),c("button",{key:0,type:"button",class:"btn btn-outline-warning btn-sm",onClick:l=>le(s)},r(g.$t("purchase_orders_page.actions.split")),9,na)):I("",!0),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>we(s)},r(g.$t("delete")),9,da)])])])}),128))]),_:2},1032,["list","data-status-id"])],2))),128))]))])])]),B(Hs,{show:se.value,params:f(t),errors:f(w),saving:f(V),suppliers:f(M),products:f(v),existingOrderNotes:f(o)||[],onClose:ne,onSave:de,onAddItem:f(ee),onRemoveItem:f(he)},null,8,["show","params","errors","saving","suppliers","products","existingOrderNotes","onAddItem","onRemoveItem"]),B(Zt,{show:f(d).show,order:f(d).data,onClose:f(K),onViewOrderId:ae,onRefreshViewOrder:oe},null,8,["show","order","onClose"]),B(Br,{show:re.value,order:W.value,products:f(v),errors:f(w),saving:f(V),onClose:ie,onSplit:xe},null,8,["show","order","products","errors","saving"])]))}});export{fa as default};
