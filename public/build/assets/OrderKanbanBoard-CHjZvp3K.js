import{V as je}from"./vue-draggable-next.esm-bundler-DWdGXwbi.js";import{d as we,c as S,_ as qe,u as Me}from"./main-yUnecxyl.js";import{S as ae}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{r as M,c as z,d as le,k as c,x,l,m as e,t,H as de,A as U,K as ke,n as B,F as D,D as P,a2 as G,y as N,I as Oe,q as Q,f as A,u as f,z as Ee,w as be,Z as xe,o as Ie,G as Be,E as Ve}from"./vendor-CjqaLWPm.js";import{Y as De,h as Ce,_ as Ae,G as Pe,S as Te}from"./transition-CBBt4QPa.js";import{_ as Le}from"./AlertMessages.vue_vue_type_script_setup_true_lang-CV0GMxpE.js";import"./quill-De1S0mUZ.js";import"./hidden-EHDRiAGA.js";import"./keyboard-DucK85rM.js";import"./open-closed-CzbEUxkg.js";function Ue(){const{t:u}=we(),p=M([]),y=M([]),j=M([]),I=M(!1),E=M(!1),m=M(""),O=M(""),o=M({}),s=M(""),a=M({show:!1,data:null}),g=M({status:"",supplier_id:""}),w={id:null,supplier_id:null,expected_delivery_date:null,notes:"",items:[]},q=M({...w}),Y=z(()=>{let r=p.value;if(s.value){const n=s.value.toLowerCase();r=r.filter(i=>{var d,_,k;return((d=i.order_number)==null?void 0:d.toLowerCase().includes(n))||((k=(_=i.supplier)==null?void 0:_.name)==null?void 0:k.toLowerCase().includes(n))})}return g.value.status&&(r=r.filter(n=>n.status===g.value.status)),g.value.supplier_id&&(r=r.filter(n=>n.supplier_id===parseInt(g.value.supplier_id))),r}),Z=z(()=>p.value.length),$=z(()=>p.value.filter(r=>r.status==="pending").length),T=z(()=>p.value.filter(r=>r.status==="approved").length),J=z(()=>p.value.filter(r=>r.status==="ordered").length),H=z(()=>p.value.filter(r=>r.status==="received").length),W=async()=>{I.value=!0,m.value="";try{const r=new URLSearchParams;g.value.status&&r.append("status",g.value.status),g.value.supplier_id&&r.append("supplier_id",g.value.supplier_id);const n=await S.get(`/api/purchase-orders?${r}`);Array.isArray(n.data)?p.value=n.data:n.data&&Array.isArray(n.data.data)?p.value=n.data.data:n.data&&Array.isArray(n.data.orders)?p.value=n.data.orders:(console.warn("Estructura de respuesta inesperada:",n.data),p.value=[])}catch(r){console.error("Error fetching orders:",r),m.value=u("purchase_orders_page.alerts.loading_error"),v(u("purchase_orders_page.alerts.loading_error"),"error")}finally{I.value=!1}},ie=async()=>{try{const r=await S.get("/api/suppliers/for-select");Array.isArray(r.data)?y.value=r.data:r.data&&Array.isArray(r.data.data)?y.value=r.data.data:(console.warn("Estructura de respuesta inesperada para suppliers:",r.data),y.value=[])}catch(r){console.error("Error fetching suppliers:",r),y.value=[]}},ce=async()=>{try{const r=await S.get("/api/products/active/list");Array.isArray(r.data)?j.value=r.data:r.data&&Array.isArray(r.data.data)?j.value=r.data.data:(console.warn("Estructura de respuesta inesperada para products:",r.data),j.value=[])}catch(r){console.error("Error fetching products:",r),j.value=[]}},K=r=>r&&j.value.find(n=>n.id===r)||null,ue=(r,n)=>{if(!r)return{valid:!1,message:"Producto no seleccionado"};const i=K(r);if(!i)return{valid:!1,message:"Producto no encontrado"};const d=i.current_stock||0;return n>d?{valid:!1,message:`Stock insuficiente. Stock disponible: ${d}`}:{valid:!0,message:""}},X=async()=>{E.value=!0,o.value={},m.value="",O.value="";try{let r;q.value.id?r=await S.put(`/api/purchase-orders/${q.value.id}`,q.value):r=await S.post("/api/purchase-orders",q.value);const n=r.data.data||r.data;if(q.value.id){const i=p.value.findIndex(d=>d.id===q.value.id);i!==-1&&p.value.splice(i,1,n),v(u("purchase_orders_page.alerts.update_success"))}else p.value.unshift(n),v(u("purchase_orders_page.alerts.save_success"));return!0}catch(r){return r.response&&r.response.status===422?(o.value=r.response.data.errors,m.value=u("purchase_orders_page.alerts.validation_errors")):(console.error("Error saving order:",r),m.value=u("purchase_orders_page.alerts.save_error"),v(u("purchase_orders_page.alerts.save_error"),"error")),!1}finally{E.value=!1}},se=async r=>{var i;if(!r.can_be_deleted)return v(u("purchase_orders_page.alerts.cannot_delete"),"error"),!1;if((await ae.fire({title:u("purchase_orders_page.delete_confirm.title"),text:u("purchase_orders_page.delete_confirm.text"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:u("purchase_orders_page.delete_confirm.confirm"),cancelButtonText:u("purchase_orders_page.delete_confirm.cancel")})).isConfirmed)try{return await S.delete(`/api/purchase-orders/${r.id}`),p.value=p.value.filter(d=>d.id!==r.id),v(u("purchase_orders_page.alerts.delete_success")),!0}catch(d){return console.error("Error deleting order:",d),((i=d.response)==null?void 0:i.status)===400?v(d.response.data.message,"error"):v(u("purchase_orders_page.alerts.delete_error"),"error"),!1}return!1},F=async r=>{var n,i;try{const d=await S.post(`/api/purchase-orders/${r.id}/submit`);if(d.data.success){const _=p.value.findIndex(k=>k.id===r.id);return _!==-1&&p.value.splice(_,1,d.data.order),v(u("purchase_orders_page.alerts.submit_success")),!0}else return v(d.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(d){console.error("Error submitting order:",d);const _=((i=(n=d.response)==null?void 0:n.data)==null?void 0:i.message)||u("purchase_orders_page.alerts.save_error");return v(_,"error"),!1}},L=async r=>{var n,i;try{const d=await S.post(`/api/purchase-orders/${r.id}/approve`);if(d.data.success){const _=p.value.findIndex(k=>k.id===r.id);return _!==-1&&p.value.splice(_,1,d.data.order),v(u("purchase_orders_page.alerts.approve_success")),!0}else return v(d.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(d){console.error("Error approving order:",d);const _=((i=(n=d.response)==null?void 0:n.data)==null?void 0:i.message)||u("purchase_orders_page.alerts.save_error");return v(_,"error"),!1}},V=async r=>{var i,d;const{value:n}=await ae.fire({title:u("purchase_orders_page.reject_confirm.title"),input:"textarea",inputLabel:u("purchase_orders_page.reject_confirm.input_label"),inputPlaceholder:u("purchase_orders_page.reject_confirm.input_placeholder"),inputAttributes:{"aria-label":u("purchase_orders_page.reject_confirm.input_label")},showCancelButton:!0,confirmButtonText:u("purchase_orders_page.reject_confirm.confirm"),cancelButtonText:u("purchase_orders_page.reject_confirm.cancel"),inputValidator:_=>_?null:u("purchase_orders_page.reject_confirm.input_required")});if(n)try{const _=await S.post(`/api/purchase-orders/${r.id}/reject`,{rejection_reason:n});if(_.data.success){const k=p.value.findIndex(ee=>ee.id===r.id);return k!==-1&&p.value.splice(k,1,_.data.order),v(u("purchase_orders_page.alerts.reject_success")),!0}else return v(_.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(_){console.error("Error rejecting order:",_);const k=((d=(i=_.response)==null?void 0:i.data)==null?void 0:d.message)||u("purchase_orders_page.alerts.save_error");return v(k,"error"),!1}return!1},pe=async r=>{var n,i;try{const d=await S.post(`/api/purchase-orders/${r.id}/mark-ordered`);if(d.data.success){const _=p.value.findIndex(k=>k.id===r.id);return _!==-1&&p.value.splice(_,1,d.data.order),v(u("purchase_orders_page.alerts.mark_ordered_success")),!0}else return v(d.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(d){console.error("Error marking order as ordered:",d);const _=((i=(n=d.response)==null?void 0:n.data)==null?void 0:i.message)||u("purchase_orders_page.alerts.save_error");return v(_,"error"),!1}},_e=async r=>{var n,i;try{const d=await S.post(`/api/purchase-orders/${r.id}/receive`);if(d.data.success){const _=p.value.findIndex(k=>k.id===r.id);return _!==-1&&p.value.splice(_,1,d.data.order),v(u("purchase_orders_page.alerts.receive_success")),!0}else return v(d.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(d){console.error("Error receiving order:",d);const _=((i=(n=d.response)==null?void 0:n.data)==null?void 0:i.message)||u("purchase_orders_page.alerts.save_error");return v(_,"error"),!1}},me=async r=>{var i,d;const{value:n}=await ae.fire({title:u("purchase_orders_page.cancel_confirm.title"),input:"textarea",inputLabel:u("purchase_orders_page.cancel_confirm.input_label"),inputPlaceholder:u("purchase_orders_page.cancel_confirm.input_placeholder"),showCancelButton:!0,confirmButtonText:u("purchase_orders_page.cancel_confirm.confirm"),cancelButtonText:u("purchase_orders_page.cancel_confirm.cancel")});if(n!==void 0)try{const _=await S.post(`/api/purchase-orders/${r.id}/cancel`,{reason:n||null});if(_.data.success){const k=p.value.findIndex(ee=>ee.id===r.id);return k!==-1&&p.value.splice(k,1,_.data.order),v(u("purchase_orders_page.alerts.cancel_success")),!0}else return v(_.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(_){console.error("Error canceling order:",_);const k=((d=(i=_.response)==null?void 0:i.data)==null?void 0:d.message)||u("purchase_orders_page.alerts.save_error");return v(k,"error"),!1}return!1},re=async r=>{var n,i;try{const d=await S.post(`/api/purchase-orders/${r.id}/reopen`);if(d.data.success){const _=p.value.findIndex(k=>k.id===r.id);return _!==-1&&p.value.splice(_,1,d.data.order),v(u("purchase_orders_page.alerts.reopen_success")),!0}else return v(d.data.message||u("purchase_orders_page.alerts.save_error"),"error"),!1}catch(d){console.error("Error reopening order:",d);const _=((i=(n=d.response)==null?void 0:n.data)==null?void 0:i.message)||u("purchase_orders_page.alerts.save_error");return v(_,"error"),!1}},he=async(r,n)=>{E.value=!0,o.value={},m.value="",O.value="";try{const i=await S.post(`/api/purchase-orders/${r}/split`,n);return i.data?(await W(),v(u("purchase_orders_page.alerts.split_success")),!0):(v(i.data.message||u("purchase_orders_page.alerts.split_error"),"error"),!1)}catch(i){return i.response&&i.response.status===422?(o.value=i.response.data.errors,m.value=u("purchase_orders_page.alerts.validation_errors")):(console.error("Error splitting order:",i),m.value=u("purchase_orders_page.alerts.split_error"),v(u("purchase_orders_page.alerts.split_error"),"error")),!1}finally{E.value=!1}},oe=(r=null)=>{var n;o.value={},r?q.value={id:r.id,supplier_id:r.supplier_id,expected_delivery_date:r.expected_delivery_date,notes:r.notes&&Array.isArray(r.notes)&&r.notes.length>0?r.notes[0].note:"",items:((n=r.items)==null?void 0:n.map(i=>({id:i.id,product_id:i.product_id,quantity:i.quantity,notes:i.notes&&Array.isArray(i.notes)&&i.notes.length>0?i.notes[0].note:""})))||[]}:(q.value={...w},q.value.items=[ne()])},ge=()=>{q.value={...w},o.value={}},ne=()=>({product_id:null,quantity:1,notes:""}),te=()=>{q.value.items.push(ne())},ve=r=>{q.value.items.splice(r,1),q.value.items.length===0&&te()},fe=r=>({draft:"bg-gray-100 text-gray-800",pending:"bg-warning/10 text-warning",approved:"bg-success/10 text-success",rejected:"bg-danger/10 text-danger",ordered:"bg-info/10 text-info",received:"bg-secondary/10 text-secondary",cancelled:"bg-danger/10 text-danger"})[r]||"bg-gray-100 text-gray-800",v=(r="",n="success")=>{n==="success"?O.value=r:m.value=r,ae.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3}).fire({icon:n,title:r,padding:"10px 20px"})};return{ordersList:p,suppliers:y,products:j,loading:I,saving:E,errorMessage:m,successMessage:O,errors:o,searchOrder:s,filters:g,params:q,viewModal:a,filteredOrdersList:Y,totalOrders:Z,pendingOrders:$,approvedOrders:T,orderedOrders:J,receivedOrders:H,fetchOrders:W,fetchSuppliers:ie,fetchProducts:ce,getProductInfo:K,validateQuantity:ue,saveOrder:X,deleteOrder:se,submitOrder:F,approveOrder:L,rejectOrder:V,markAsOrdered:pe,receiveOrder:_e,cancelOrder:me,reopenOrder:re,editOrder:oe,resetParams:ge,addItem:te,removeItem:ve,getStatusClass:fe,showMessage:v,formatDate:r=>r?new Date(r).toLocaleDateString("es-ES"):"-",viewOrder:async r=>{I.value=!0,a.value={show:!0,data:null};try{const n=await S.get(`/api/purchase-orders/${r}`);a.value.data=n.data}catch(n){console.error("Error fetching order for view:",n),v(u("purchase_orders_page.alerts.loading_error"),"error"),a.value.show=!1}finally{I.value=!1}},closeViewModal:()=>{a.value={show:!1,data:null}},splitOrder:he}}const Ne={key:0,class:"fixed inset-0 bg-[black]/60 z-50 overflow-y-auto"},Re={class:"flex items-start justify-center min-h-screen px-4"},ze={class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl my-8"},Qe={class:"flex bg-[#fbfbfb] dark:bg-[#1c232f] items-center justify-between px-5 py-3"},He={class:"font-bold text-lg"},Ke={class:"p-5"},Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5"},Ge={for:"supplier",class:"form-label"},Ye={value:""},Ze=["value"],Je={key:0,class:"text-danger mt-1 text-xs"},We={for:"expected_delivery_date",class:"form-label"},Xe={key:0,class:"text-danger mt-1 text-xs"},es={class:"mb-5"},ss={class:"flex justify-between items-center mb-3"},rs={class:"form-label"},ts={class:"space-y-4"},as={class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-start"},os={class:"md:col-span-6"},ns={class:"form-label"},ds=["onUpdate:modelValue"],ls={value:""},is=["value","disabled"],cs={key:0,class:"text-danger text-xs"},us={key:1,class:"text-success text-xs"},ps={key:0,class:"text-danger mt-1 text-xs"},_s={class:"md:col-span-4"},ms={class:"form-label"},hs=["onUpdate:modelValue","max","onInput"],gs={key:0,class:"text-danger mt-1 text-xs"},vs={key:1,class:"text-danger mt-1 text-xs"},fs={key:2,class:"text-info mt-1 text-xs"},ys={class:"md:col-span-2"},bs=["onClick","disabled"],ws={class:"mt-3"},$s={class:"form-label"},ks=["onUpdate:modelValue","placeholder"],xs={class:"mb-5"},Cs={for:"notes",class:"form-label"},qs=["placeholder"],Os={class:"flex justify-end items-center mt-8 border-t pt-4"},Ss=["disabled"],js=["disabled"],Ms={key:0,class:"flex items-center"},Es={key:1},Is=le({__name:"PurchaseOrderModal",props:{show:{type:Boolean},params:{},errors:{},saving:{type:Boolean},suppliers:{},products:{}},emits:["close","save","add-item","remove-item"],setup(u,{emit:p}){const y=u,j=z(()=>y.products.filter(o=>o.is_active!==!1)),I=z(()=>{const o=y.params.items.length>0&&y.params.items.every(s=>s.product_id&&s.quantity>0&&s.quantity<=m(s.product_id));return y.params.supplier_id&&y.params.expected_delivery_date&&o}),E=(o,s)=>{s<1&&(y.params.items[o].quantity=1);const a=m(y.params.items[o].product_id);s>a&&(y.params.items[o].quantity=a)},m=o=>{if(!o)return 0;const s=y.products.find(a=>a.id===o);return(s==null?void 0:s.stock)||0},O=(o,s)=>{if(!o)return{hasError:!1,message:""};const a=m(o);return s>a?{hasError:!0,message:`Excede stock disponible (${a})`}:{hasError:!1,message:""}};return(o,s)=>o.show?(l(),c("div",Ne,[e("div",Re,[e("div",ze,[e("div",Qe,[e("h5",He,t(o.params.id?o.$t("purchase_orders_page.create_modal.edit_title"):o.$t("purchase_orders_page.create_modal.add_title")),1),e("button",{type:"button",class:"text-white-dark hover:text-dark",onClick:s[0]||(s[0]=a=>o.$emit("close"))},[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",Ke,[e("form",{onSubmit:s[6]||(s[6]=de(a=>o.$emit("save",o.params),["prevent"]))},[e("div",Fe,[e("div",null,[e("label",Ge,t(o.$t("purchase_orders_page.create_modal.fields.supplier"))+" * ",1),U(e("select",{id:"supplier","onUpdate:modelValue":s[1]||(s[1]=a=>o.params.supplier_id=a),class:B(["form-select",{"border-danger":o.errors.supplier_id}]),required:""},[e("option",Ye,t(o.$t("purchase_orders_page.create_modal.placeholders.select_supplier")),1),(l(!0),c(D,null,P(o.suppliers,a=>(l(),c("option",{key:a.id,value:a.id},t(a.name),9,Ze))),128))],2),[[ke,o.params.supplier_id]]),o.errors.supplier_id?(l(),c("div",Je,t(o.errors.supplier_id[0]),1)):x("",!0)]),e("div",null,[e("label",We,t(o.$t("purchase_orders_page.create_modal.fields.expected_delivery_date"))+" * ",1),U(e("input",{id:"expected_delivery_date",type:"date","onUpdate:modelValue":s[2]||(s[2]=a=>o.params.expected_delivery_date=a),class:B(["form-input",{"border-danger":o.errors.expected_delivery_date}]),required:""},null,2),[[G,o.params.expected_delivery_date]]),o.errors.expected_delivery_date?(l(),c("div",Xe,t(o.errors.expected_delivery_date[0]),1)):x("",!0)])]),e("div",es,[e("div",ss,[e("label",rs,t(o.$t("purchase_orders_page.create_modal.fields.items"))+" * ",1),e("button",{type:"button",class:"btn btn-primary btn-sm",onClick:s[3]||(s[3]=a=>o.$emit("add-item"))}," + "+t(o.$t("purchase_orders_page.create_modal.buttons.add_item")),1)]),e("div",ts,[(l(!0),c(D,null,P(o.params.items,(a,g)=>(l(),c("div",{key:g,class:"border border-[#e0e6ed] dark:border-[#1b2e4b] rounded p-4 bg-gray-50 dark:bg-[#1a2234]"},[e("div",as,[e("div",os,[e("label",ns,t(o.$t("purchase_orders_page.create_modal.fields.product"))+" * ",1),U(e("select",{"onUpdate:modelValue":w=>a.product_id=w,class:B(["form-select",{"border-danger":o.errors[`items.${g}.product_id`]||!a.product_id&&a.quantity>0}]),required:""},[e("option",ls,t(o.$t("purchase_orders_page.create_modal.placeholders.select_product")),1),(l(!0),c(D,null,P(j.value,w=>(l(),c("option",{key:w.id,value:w.id,disabled:!w.stock||w.stock<=0},[N(t(w.name)+" ",1),!w.stock||w.stock<=0?(l(),c("span",cs," (Sin stock) ")):(l(),c("span",us," (Stock: "+t(w.stock)+") ",1))],8,is))),128))],10,ds),[[ke,a.product_id]]),o.errors[`items.${g}.product_id`]?(l(),c("div",ps,t(o.errors[`items.${g}.product_id`][0]),1)):x("",!0)]),e("div",_s,[e("label",ms,t(o.$t("purchase_orders_page.create_modal.fields.quantity"))+" * ",1),U(e("input",{type:"number","onUpdate:modelValue":w=>a.quantity=w,min:"1",max:m(a.product_id),class:B(["form-input",{"border-danger":o.errors[`items.${g}.quantity`]||O(a.product_id,a.quantity).hasError}]),onInput:w=>E(g,a.quantity),required:""},null,42,hs),[[G,a.quantity,void 0,{number:!0}]]),o.errors[`items.${g}.quantity`]?(l(),c("div",gs,t(o.errors[`items.${g}.quantity`][0]),1)):x("",!0),O(a.product_id,a.quantity).hasError?(l(),c("div",vs,t(O(a.product_id,a.quantity).message),1)):x("",!0),a.product_id&&m(a.product_id)>0?(l(),c("div",fs," Máx: "+t(m(a.product_id)),1)):x("",!0)]),e("div",ys,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm w-full",onClick:w=>o.$emit("remove-item",g),disabled:o.params.items.length===1},t(o.$t("purchase_orders_page.create_modal.buttons.remove_item")),9,bs)])]),e("div",ws,[e("label",$s,t(o.$t("purchase_orders_page.create_modal.fields.item_notes")),1),U(e("textarea",{"onUpdate:modelValue":w=>a.notes=w,class:"form-textarea min-h-[60px]",placeholder:o.$t("purchase_orders_page.create_modal.placeholders.item_notes"),rows:"2"},null,8,ks),[[G,a.notes]])])]))),128))])]),e("div",xs,[e("label",Cs,t(o.$t("purchase_orders_page.create_modal.fields.notes")),1),U(e("textarea",{id:"notes","onUpdate:modelValue":s[4]||(s[4]=a=>o.params.notes=a),class:"form-textarea min-h-[80px]",placeholder:o.$t("purchase_orders_page.create_modal.placeholders.notes"),rows:"3"},null,8,qs),[[G,o.params.notes]])]),e("div",Os,[e("button",{type:"button",class:"btn btn-outline-danger mr-3",onClick:s[5]||(s[5]=a=>o.$emit("close")),disabled:o.saving},t(o.$t("purchase_orders_page.create_modal.buttons.cancel")),9,Ss),e("button",{type:"submit",class:"btn btn-primary",disabled:o.saving||!I.value},[o.saving?(l(),c("span",Ms,[s[8]||(s[8]=e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),N(" "+t(o.$t("purchase_orders_page.create_modal.buttons.saving")),1)])):(l(),c("span",Es,t(o.params.id?o.$t("purchase_orders_page.create_modal.buttons.update"):o.$t("purchase_orders_page.create_modal.buttons.add")),1))],8,js)])],32)])])])])):x("",!0)}}),Bs={class:"fixed inset-0 overflow-y-auto"},Vs={class:"flex min-h-full items-center justify-center px-4 py-8"},Ds={class:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},As={key:0},Ps={key:1,class:"text-gray-500"},Ts={class:"p-5"},Ls={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Us={class:"space-y-4"},Ns={class:"font-semibold text-gray-600"},Rs={class:"text-lg"},zs={class:"text-sm text-gray-500"},Qs={class:"text-sm text-gray-500"},Hs={class:"font-semibold text-gray-600"},Ks={class:"font-semibold text-gray-600"},Fs={class:"text-sm text-gray-500"},Gs={key:0},Ys={class:"font-semibold text-gray-600"},Zs={class:"text-lg"},Js={key:1},Ws={class:"font-semibold text-gray-600"},Xs={class:"flex flex-wrap gap-2"},er=["onClick"],sr={class:"space-y-4"},rr={class:"font-semibold text-gray-600"},tr={class:"font-semibold text-gray-600"},ar={key:0,class:"text-xs ml-2"},or={key:1,class:"text-xs ml-2 text-success"},nr={key:0},dr={class:"font-semibold text-gray-600"},lr={key:1},ir={class:"font-semibold text-gray-600"},cr={class:"text-sm text-gray-500"},ur={class:"mb-6"},pr={class:"text-lg font-semibold mb-4"},_r={class:"table-responsive"},mr={class:"table-striped table-hover"},hr={class:"text-center"},gr={class:"text-center"},vr={class:"text-center"},fr={class:"font-semibold"},yr={class:"text-sm text-gray-500"},br={key:0,class:"mt-2 space-y-2 text-xs"},wr={class:"font-semibold"},$r={class:"text-gray-500 text-xs"},kr={class:"text-gray-600 dark:text-gray-300"},xr={class:"text-center"},Cr={class:"text-center"},qr={class:"text-center"},Or={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Sr={class:"space-y-2"},jr={key:0},Mr={class:"font-semibold text-gray-600"},Er={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded space-y-3"},Ir={key:0,class:"text-gray-500"},Br={class:"font-semibold"},Vr={class:"text-gray-500 text-xs"},Dr={class:"text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Ar={key:1},Pr={class:"font-semibold text-danger"},Tr={class:"bg-danger/10 text-danger p-3 rounded"},Lr={class:"flex justify-end items-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},Ur={key:1,class:"text-center py-8"},Nr={class:"text-gray-500"},Rr=le({__name:"PurchaseOrderViewModal",props:{show:{type:Boolean},order:{}},emits:["close","view-order-id"],setup(u,{emit:p}){const y=s=>({"nuevo pedido":"bg-gray-100 text-gray-800",disponibilidad:"bg-secondary/10 text-secondary","preparar pedido":"bg-success/10 text-success","en preparación":"bg-info/10 text-info",facturación:"bg-primary/10 text-primary","en despacho":"bg-warning/10 text-warning","en ruta":"bg-danger/10 text-danger",entregado:"bg-success/10 text-success"})[s]||"bg-gray-100 text-gray-800",j=s=>s.received_quantity===0?"text-danger":s.received_quantity<s.quantity?"text-warning":"text-success",I=s=>{const a=s.quantity-s.received_quantity;return a===0?"text-success":a>0?"text-warning":"text-danger"},E=s=>s.expected_delivery_date?new Date(s.expected_delivery_date)<new Date&&s.status!=="received":!1,m=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"-",O=s=>s?new Date(s).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",o=()=>{window.print()};return(s,a)=>(l(),Oe(f(Te),{appear:"",show:s.show,as:"template"},{default:Q(()=>[A(f(De),{as:"div",onClose:a[3]||(a[3]=g=>s.$emit("close")),class:"relative z-[51]"},{default:Q(()=>[A(f(Ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:Q(()=>[A(f(Ae),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",Bs,[e("div",Vs,[A(f(Ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:Q(()=>[A(f(Pe),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-4xl text-black dark:text-white-dark"},{default:Q(()=>{var g,w,q,Y,Z;return[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:a[0]||(a[0]=$=>s.$emit("close"))},[...a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),e("div",Ds,[N(t(s.$t("purchase_orders_page.view_modal.title"))+" ",1),s.order?(l(),c("span",As,t(s.order.order_number),1)):(l(),c("span",Ps,t(s.$t("purchase_orders_page.view_modal.status.loading")),1))]),e("div",Ts,[s.order?(l(),c(D,{key:0},[e("div",Ls,[e("div",Us,[e("div",null,[e("label",Ns,t(s.$t("purchase_orders_page.view_modal.fields.supplier"))+": ",1),e("p",Rs,t((g=s.order.supplier)==null?void 0:g.name),1),e("p",zs,t((w=s.order.supplier)==null?void 0:w.contact_person),1),e("p",Qs,t((q=s.order.supplier)==null?void 0:q.email),1)]),e("div",null,[e("label",Hs,t(s.$t("purchase_orders_page.view_modal.fields.status"))+": ",1),e("span",{class:B(["badge ml-2",y(s.order.status)])},t(s.$t(`purchase_orders_page.status.${s.order.status.replace(/ /g,"_")}`)),3)]),e("div",null,[e("label",Ks,t(s.$t("purchase_orders_page.view_modal.fields.created_by"))+": ",1),e("p",null,t((Y=s.order.creator)==null?void 0:Y.name),1),e("p",Fs,t(m(s.order.created_at)),1)]),s.order.parent?(l(),c("div",Gs,[e("label",Ys,t(s.$t("purchase_orders_page.view_modal.fields.parent_order"))+": ",1),e("p",Zs,[e("a",{href:"#",onClick:a[1]||(a[1]=de($=>s.$emit("view-order-id",s.order.parent.id),["prevent"])),class:"btn btn-outline-info btn-sm"}," #"+t(s.order.parent.order_number),1)])])):x("",!0),s.order.sub_orders&&s.order.sub_orders.length>0?(l(),c("div",Js,[e("label",Ws,t(s.$t("purchase_orders_page.view_modal.fields.sub_orders"))+": ",1),e("div",Xs,[(l(!0),c(D,null,P(s.order.sub_orders,$=>(l(),c("a",{key:$.id,href:"#",onClick:de(T=>s.$emit("view-order-id",$.id),["prevent"]),class:"btn btn-outline-info btn-sm"}," #"+t($.order_number),9,er))),128))])])):x("",!0)]),e("div",sr,[e("div",null,[e("label",rr,t(s.$t("purchase_orders_page.view_modal.fields.order_date"))+": ",1),e("p",null,t(m(s.order.order_date)),1)]),e("div",null,[e("label",tr,t(s.$t("purchase_orders_page.view_modal.fields.expected_delivery"))+": ",1),e("p",{class:B({"text-warning":E(s.order)})},[N(t(m(s.order.expected_delivery_date))+" ",1),E(s.order)?(l(),c("span",ar," ("+t(s.$t("purchase_orders_page.view_modal.delivery_status.delayed"))+") ",1)):s.order.expected_delivery_date?(l(),c("span",or," ("+t(s.$t("purchase_orders_page.view_modal.delivery_status.on_time"))+") ",1)):x("",!0)],2)]),s.order.delivery_date?(l(),c("div",nr,[e("label",dr,t(s.$t("purchase_orders_page.view_modal.fields.delivery_date"))+": ",1),e("p",null,t(m(s.order.delivery_date)),1)])):x("",!0),s.order.approved_by?(l(),c("div",lr,[e("label",ir,t(s.$t("purchase_orders_page.view_modal.fields.approved_by"))+": ",1),e("p",null,t((Z=s.order.approver)==null?void 0:Z.name),1),e("p",cr,t(m(s.order.approved_at)),1)])):x("",!0)])]),e("div",ur,[e("h3",pr,t(s.$t("purchase_orders_page.view_modal.sections.order_items")),1),e("div",_r,[e("table",mr,[e("thead",null,[e("tr",null,[e("th",null,t(s.$t("purchase_orders_page.view_modal.fields.product")),1),e("th",hr,t(s.$t("purchase_orders_page.view_modal.fields.quantity")),1),e("th",gr,t(s.$t("purchase_orders_page.view_modal.fields.received")),1),e("th",vr,t(s.$t("purchase_orders_page.view_modal.fields.pending")),1)])]),e("tbody",null,[(l(!0),c(D,null,P(s.order.items,$=>{var T,J;return l(),c("tr",{key:$.id},[e("td",null,[e("div",fr,t((T=$.product)==null?void 0:T.name),1),e("div",yr,t((J=$.product)==null?void 0:J.sku),1),$.notes&&$.notes.length?(l(),c("div",br,[(l(!0),c(D,null,P($.notes,(H,W)=>(l(),c("div",{key:W,class:"p-2 rounded bg-gray-100 dark:bg-gray-700"},[e("p",wr,[N(t(H.user_name)+" ",1),e("span",$r,"- "+t(O(H.timestamp)),1)]),e("p",kr,t(H.note),1)]))),128))])):x("",!0)]),e("td",xr,t($.quantity),1),e("td",Cr,[e("span",{class:B(j($))},t($.received_quantity),3)]),e("td",qr,[e("span",{class:B(I($))},t($.quantity-$.received_quantity),3)])])}),128))])])])]),e("div",Or,[e("div",Sr,[s.order.notes?(l(),c("div",jr,[e("label",Mr,t(s.$t("purchase_orders_page.view_modal.fields.notes"))+": ",1),e("div",Er,[!s.order.notes||s.order.notes.length===0?(l(),c("div",Ir," No hay notas generales. ")):x("",!0),(l(!0),c(D,null,P(s.order.notes,($,T)=>(l(),c("div",{key:T,class:"text-sm pb-2 border-b dark:border-gray-700 last:border-b-0"},[e("p",Br,[N(t($.user_name)+" ",1),e("span",Vr,"- "+t(O($.timestamp)),1)]),e("p",Dr,t($.note),1)]))),128))])])):x("",!0),s.order.rejection_reason?(l(),c("div",Ar,[e("label",Pr,t(s.$t("purchase_orders_page.view_modal.fields.rejection_reason"))+": ",1),e("p",Tr,t(s.order.rejection_reason),1)])):x("",!0)])]),e("div",Lr,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:o},[a[5]||(a[5]=e("svg",{class:"w-4 h-4 ltr:mr-2 rtl:ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)),N(" "+t(s.$t("purchase_orders_page.view_modal.buttons.print")),1)]),e("button",{type:"button",class:"btn btn-outline-danger ltr:ml-4 rtl:mr-4",onClick:a[2]||(a[2]=$=>s.$emit("close"))},t(s.$t("purchase_orders_page.view_modal.buttons.close")),1)])],64)):(l(),c("div",Ur,[a[6]||(a[6]=e("div",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-8 h-8 mx-auto mb-4"},null,-1)),e("p",Nr,t(s.$t("purchase_orders_page.view_modal.status.loading")),1)]))])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),zr=qe(Rr,[["__scopeId","data-v-89c892dd"]]),Qr={key:0,class:"fixed inset-0 z-[999] bg-[rgba(0,0,0,0.2)]"},Hr={key:0,class:"panel absolute top-1/2 left-1/2 w-full max-w-lg -translate-x-1/2 -translate-y-1/2"},Kr={class:"flex items-center justify-between bg-[#fbfbfb] px-5 py-3 dark:bg-[#121c2c]"},Fr={class:"text-lg font-bold"},Gr={class:"p-5"},Yr={class:"mb-5"},Zr={for:"expectedDeliveryDate"},Jr=["placeholder"],Wr={key:0,class:"text-danger mt-1"},Xr={class:"mb-5"},et={for:"notes"},st=["placeholder"],rt={key:0,class:"text-danger mt-1"},tt={class:"mb-5"},at={key:0},ot={class:"flex-grow"},nt={class:"font-semibold"},dt={class:"w-1/3 ml-4"},lt=["placeholder","onUpdate:modelValue","max","onInput"],it={key:0,class:"text-danger mt-1"},ct={key:0,class:"text-danger mt-1"},ut={key:1,class:"text-center text-gray-500"},pt={class:"mt-8 flex items-center justify-end"},_t=["disabled"],mt={key:0},ht={key:1},gt=le({__name:"PurchaseOrderSplitModal",props:{show:{type:Boolean},order:{},errors:{},saving:{type:Boolean}},emits:["close","split"],setup(u,{emit:p}){const{t:y}=we(),j=p,I=u,E={expected_delivery_date:"",notes:"",items:[]},m=Ee({...E});be(()=>I.order,s=>{s&&s.items?(m.items=s.items.map(a=>({item_id:a.id,quantity:a.quantity})),m.expected_delivery_date="",m.notes=""):m.items=[]},{immediate:!0}),be(()=>I.show,s=>{s||(Object.assign(m,E),m.items=[])});const O=(s,a)=>{m.items[s].quantity<0?m.items[s].quantity=0:m.items[s].quantity>a&&(m.items[s].quantity=a)},o=()=>{const s=m.items.filter(a=>a.quantity>0);if(s.length===0){alert(y("purchase_orders_page.split_modal.alerts.no_items_selected"));return}j("split",{expected_delivery_date:m.expected_delivery_date,notes:m.notes,items:s})};return(s,a)=>(l(),Oe(xe,{appear:"","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:Q(()=>[s.show?(l(),c("div",Qr,[A(xe,{appear:"","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:Q(()=>[s.show?(l(),c("div",Hr,[e("div",Kr,[e("h5",Fr,t(f(y)("purchase_orders_page.split_modal.title")),1),e("button",{type:"button",class:"text-white-dark hover:text-dark",onClick:a[0]||(a[0]=g=>j("close"))},[...a[4]||(a[4]=[e("svg",null,"...",-1)])])]),e("div",Gr,[e("form",{onSubmit:de(o,["prevent"])},[e("div",Yr,[e("label",Zr,t(f(y)("purchase_orders_page.split_modal.fields.expected_delivery_date")),1),U(e("input",{id:"expectedDeliveryDate",type:"date",placeholder:f(y)("purchase_orders_page.split_modal.placeholders.expected_delivery_date"),class:B(["form-input",[s.errors.expected_delivery_date?"border-danger":""]]),"onUpdate:modelValue":a[1]||(a[1]=g=>m.expected_delivery_date=g)},null,10,Jr),[[G,m.expected_delivery_date]]),s.errors.expected_delivery_date?(l(),c("p",Wr,t(s.errors.expected_delivery_date[0]),1)):x("",!0)]),e("div",Xr,[e("label",et,t(f(y)("purchase_orders_page.split_modal.fields.notes")),1),U(e("textarea",{id:"notes",rows:"3",placeholder:f(y)("purchase_orders_page.split_modal.placeholders.notes"),class:B(["form-textarea",[s.errors.notes?"border-danger":""]]),"onUpdate:modelValue":a[2]||(a[2]=g=>m.notes=g)},null,10,st),[[G,m.notes]]),s.errors.notes?(l(),c("p",rt,t(s.errors.notes[0]),1)):x("",!0)]),e("div",tt,[e("label",null,t(f(y)("purchase_orders_page.split_modal.fields.items_to_split")),1),s.order&&s.order.items&&s.order.items.length>0?(l(),c("div",at,[(l(!0),c(D,null,P(s.order.items,(g,w)=>(l(),c("div",{key:g.id,class:"flex items-center justify-between mb-3 border p-3 rounded"},[e("div",ot,[e("p",nt,t(g.product.name)+" ("+t(g.quantity)+" "+t(f(y)("purchase_orders_page.split_modal.available"))+")",1)]),e("div",dt,[U(e("input",{type:"number",placeholder:f(y)("purchase_orders_page.split_modal.placeholders.quantity_to_split"),class:"form-input","onUpdate:modelValue":q=>m.items[w].quantity=q,min:0,max:g.quantity,onInput:q=>O(w,g.quantity)},null,40,lt),[[G,m.items[w].quantity,void 0,{number:!0}]]),s.errors[`items.${w}.quantity`]?(l(),c("p",it,t(s.errors[`items.${w}.quantity`][0]),1)):x("",!0)])]))),128)),s.errors.items?(l(),c("p",ct,t(s.errors.items[0]),1)):x("",!0)])):(l(),c("div",ut,t(f(y)("purchase_orders_page.split_modal.no_items")),1))]),e("div",pt,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:a[3]||(a[3]=g=>j("close"))},t(f(y)("purchase_orders_page.split_modal.buttons.cancel")),1),e("button",{type:"submit",class:"btn btn-primary ltr:ml-4 rtl:mr-4",disabled:s.saving},[s.saving?(l(),c("span",mt,t(f(y)("purchase_orders_page.split_modal.buttons.splitting")),1)):(l(),c("span",ht,t(f(y)("purchase_orders_page.split_modal.buttons.split")),1))],8,_t)])],32)])])):x("",!0)]),_:1})])):x("",!0)]),_:1}))}}),vt=qe(gt,[["__scopeId","data-v-d90f3303"]]),ft={class:"flex space-x-2 rtl:space-x-reverse mb-6"},yt={href:"javascript:;",class:"text-primary hover:underline"},bt={class:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2"},wt={class:"scrumboard-v2 space-y-8"},$t={class:"flex items-center justify-between flex-wrap gap-4"},kt={class:"text-xl leading-relaxed"},xt={class:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4"},Ct={class:"flex gap-3"},qt={class:"relative pt-5"},Ot={class:"h-full -mx-2"},St={key:0,class:"grid place-content-center h-[500px]"},jt={key:1,class:"overflow-x-auto flex items-start flex-nowrap gap-5 px-2 pb-2"},Mt={class:"flex justify-between mb-5"},Et={class:"text-base font-semibold"},It={class:"shadow bg-[#f4f4f4] dark:bg-white-dark/20 p-3 pb-5 rounded-md mb-5 space-y-3 cursor-move"},Bt={key:0,class:"flex items-center text-xs text-info font-semibold"},Vt={key:1,class:"flex items-center text-xs text-primary font-semibold"},Dt={class:"text-base font-medium"},At={class:"break-all text-sm text-gray-700 dark:text-gray-400"},Pt={class:"flex items-center justify-between text-xs text-gray-500 mt-2"},Tt={class:"flex justify-end mt-4 gap-2"},Lt=["onClick"],Ut=["onClick"],Nt=["onClick"],Rt=["onClick"],Xt=le({__name:"OrderKanbanBoard",setup(u){const{t:p}=we();Ve();const y=Be();Me({title:p("ordenes.order_kanban_board")});const{fetchSuppliers:j,fetchProducts:I,suppliers:E,products:m,loading:O,saving:o,errorMessage:s,successMessage:a,errors:g,params:w,viewModal:q,saveOrder:Y,deleteOrder:Z,editOrder:$,resetParams:T,viewOrder:J,closeViewModal:H,addItem:W,removeItem:ie,handleProductChange:ce,showMessage:K,splitOrder:ue}=Ue(),X=M(!1),se=M(!1),F=M(null),L=M([{id:"nuevo pedido",title:p("ordenes.status.nuevo_pedido"),badgeClass:"badge-outline-dark",borderColorClass:"border-gray-500",orders:[]},{id:"disponibilidad",title:p("ordenes.status.disponibilidad"),badgeClass:"badge-outline-secondary",borderColorClass:"border-secondary",orders:[]},{id:"preparar pedido",title:p("ordenes.status.preparar_pedido"),badgeClass:"badge-outline-success",borderColorClass:"border-success",orders:[]},{id:"en preparación",title:p("ordenes.status.en_preparacion"),badgeClass:"badge-outline-info",borderColorClass:"border-info",orders:[]},{id:"facturación",title:p("ordenes.status.facturacion"),badgeClass:"badge-outline-primary",borderColorClass:"border-primary",orders:[]},{id:"en despacho",title:p("ordenes.status.en_despacho"),badgeClass:"badge-outline-warning",borderColorClass:"border-warning",orders:[]},{id:"en ruta",title:p("ordenes.status.en_ruta"),badgeClass:"badge-outline-danger",borderColorClass:"border-danger",orders:[]},{id:"entregado",title:p("ordenes.status.entregado"),badgeClass:"badge-outline-success",borderColorClass:"border-success",orders:[]}]),V=async()=>{var h,b;O.value=!0;try{const r=(await S.get("/api/purchase-orders")).data.data;L.value.forEach(n=>{n.orders=[]}),r.forEach(n=>{const i=L.value.find(d=>d.id===n.status);if(i)i.orders.push(n);else{console.warn(`Order ${n.id} has unknown status: ${n.status}. Defaulting to 'nuevo pedido'.`);const d=L.value.find(_=>_.id==="nuevo pedido");d&&d.orders.push(n)}})}catch(C){console.error("Error fetching orders for Kanban:",C);const r=((b=(h=C.response)==null?void 0:h.data)==null?void 0:b.message)||p("ordenes.error_fetching_orders");K(r,"error")}finally{O.value=!1}},pe=async h=>{var k,ee;const b=h.item._underlying_vm_.id,C=h.from.dataset.statusId,r=h.to.dataset.statusId;if(!r||!C){console.warn("Source or target status ID is undefined. Drag operation might be invalid. Reverting."),await V();return}const n=L.value.find(R=>R.id===C),i=L.value.find(R=>R.id===r);if(!n||!i){console.warn("Source or target status column not found. Reverting."),await V();return}const d=i.orders.find(R=>R.id===b);if(!d){console.warn(`Order with ID ${b} not found in new status column ${r}. Reverting.`),await V();return}const _=C;try{await S.put(`/api/purchase-orders/${b}/status`,{status:r}),K(p("ordenes.order_status_updated_successfully"),"success")}catch(R){console.error("Error updating order status:",R);const Se=((ee=(k=R.response)==null?void 0:k.data)==null?void 0:ee.message)||p("ordenes.error_updating_order_status");K(Se,"error");const $e=i.orders.findIndex(ye=>ye.id===b);if($e!==-1){const ye=i.orders.splice($e,1)[0];n.orders.splice(h.oldIndex,0,ye)}d&&(d.status=_),await V()}},_e=()=>{$(null),X.value=!0},me=h=>{$(h),X.value=!0},re=h=>{const b=typeof h=="number"?h:h.id;J(b)},he=async h=>{(await ae.fire({title:p("purchase_orders_page.delete_confirm.title"),text:p("purchase_orders_page.delete_confirm.text"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:p("purchase_orders_page.delete_confirm.confirm"),cancelButtonText:p("purchase_orders_page.delete_confirm.cancel")})).isConfirmed&&(await Z(h),await V())},oe=()=>{X.value=!1,T(),V()},ge=async()=>{await Y()&&oe()},ne=h=>{F.value=h,se.value=!0},te=()=>{se.value=!1,F.value=null,g.value={}},ve=async h=>{var C;if(!((C=F.value)!=null&&C.id)){K(p("purchase_orders_page.split_modal.alerts.no_order_selected"),"error");return}await ue(F.value.id,h)&&(te(),await V())},fe=h=>{if(!h)return"";const b={year:"numeric",month:"short",day:"numeric"};return new Date(h).toLocaleDateString(void 0,b)},v=h=>{if(!h)return;let b=null;for(const C of L.value)if(b=C.orders.find(r=>r.id===parseInt(h)),b)break;b&&re(b)};return Ie(async()=>{await Promise.all([V(),j(),I()]),v(y.params.orderId)}),be(()=>y.params.orderId,h=>{h&&v(h)}),(h,b)=>(l(),c("div",null,[e("ul",ft,[e("li",null,[e("a",yt,t(h.$t("dashboard")),1)]),e("li",bt,[e("span",null,t(h.$t("ordenes.kanban_board")),1)])]),e("div",wt,[e("div",$t,[e("h2",kt,t(h.$t("ordenes.order_kanban_board")),1),e("div",xt,[e("div",Ct,[e("button",{type:"button",class:"btn btn-primary",onClick:_e},[b[2]||(b[2]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-5 h-5 ltr:mr-3 rtl:ml-3"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)),N(" "+t(h.$t("purchase_orders_page.add_order_btn")),1)]),e("button",{type:"button",class:"btn btn-primary",onClick:V},[b[3]||(b[3]=e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5"},[e("path",{d:"M20.9999 12C20.9999 16.9706 16.9705 21 11.9999 21C7.02934 21 2.99994 16.9706 2.99994 12C2.99994 7.02944 7.02934 3 11.9999 3",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M18.8477 15.6529C19.7897 14.0533 20.2522 13.0166 20.4939 12",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M17.9999 3L20.9999 7H16.9999",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),N(" "+t(h.$t("ordenes.refresh")),1)])])])]),A(Le,{"error-message":f(s),"success-message":f(a),onClearError:b[0]||(b[0]=C=>s.value=""),onClearSuccess:b[1]||(b[1]=C=>a.value="")},null,8,["error-message","success-message"]),e("div",qt,[e("div",Ot,[f(O)?(l(),c("div",St,[...b[4]||(b[4]=[e("span",{class:"animate-spin border-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle"},null,-1)])])):(l(),c("div",jt,[(l(!0),c(D,null,P(L.value,C=>(l(),c("div",{key:C.id,class:B(["panel w-80 flex-none border-2 border-solid rounded-lg",C.borderColorClass])},[e("div",Mt,[e("h4",Et,t(C.title),1),e("span",{class:B(["badge",C.badgeClass])},t(C.orders.length),3)]),A(f(je),{class:"connect-sorting-content min-h-[150px]",list:C.orders,group:"kanban-board","ghost-class":"sortable-ghost","drag-class":"sortable-drag",animation:200,onEnd:pe,"data-status-id":C.id},{default:Q(()=>[(l(!0),c(D,null,P(C.orders,r=>{var n;return l(),c("div",{class:"sortable-list",key:r.id},[e("div",It,[r.parent_id?(l(),c("div",Bt,[b[5]||(b[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-4 h-4 mr-1"},[e("polyline",{points:"15 10 20 15 15 20"}),e("path",{d:"M4 4v7a4 4 0 0 0 4 4h12"})],-1)),e("span",null,t(h.$t("ordenes.sub_order")),1)])):x("",!0),r.sub_orders_count>0&&!r.parent_id?(l(),c("div",Vt,[...b[6]||(b[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-4 h-4 mr-1"},[e("path",{d:"M17 2.1l4 4-4 4"}),e("path",{d:"M3 12.6v-2.1c0-4.4 3.6-8 8-8h7"}),e("path",{d:"M7 21.9l-4-4 4-4"}),e("path",{d:"M21 11.4v2.1c0 4.4-3.6 8-8 8H6"})],-1),e("span",null,"Orden Principal",-1)])])):x("",!0),e("div",Dt,t(r.order_number)+" - "+t(((n=r.creator)==null?void 0:n.name)||"N/A"),1),e("p",At,t(r.notes?Array.isArray(r.notes)&&r.notes.length>0?r.notes[0].note:"":"No description"),1),e("div",Pt,[e("span",null,t(h.$t("ordenes.created_at"))+": "+t(fe(r.created_at)),1)]),e("div",Tt,[e("button",{type:"button",class:"btn btn-outline-info btn-sm",onClick:i=>re(r)},t(h.$t("ordenes.view_details")),9,Lt),e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:i=>me(r)},t(h.$t("edit")),9,Ut),r.parent_id?x("",!0):(l(),c("button",{key:0,type:"button",class:"btn btn-outline-warning btn-sm",onClick:i=>ne(r)},t(h.$t("purchase_orders_page.actions.split")),9,Nt)),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>he(r)},t(h.$t("delete")),9,Rt)])])])}),128))]),_:2},1032,["list","data-status-id"])],2))),128))]))])])]),A(Is,{show:X.value,params:f(w),errors:f(g),saving:f(o),suppliers:f(E),products:f(m),onClose:oe,onSave:ge,onAddItem:f(W),onRemoveItem:f(ie),onProductChange:f(ce)},null,8,["show","params","errors","saving","suppliers","products","onAddItem","onRemoveItem","onProductChange"]),A(zr,{show:f(q).show,order:f(q).data,onClose:f(H),onViewOrderId:re},null,8,["show","order","onClose"]),A(vt,{show:se.value,order:F.value,errors:f(g),saving:f(o),onClose:te,onSplit:ve},null,8,["show","order","errors","saving"])]))}});export{Xt as default};
