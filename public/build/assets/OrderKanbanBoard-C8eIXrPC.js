import{V as Oe}from"./vue-draggable-next.esm-bundler-BfUC9kfW.js";import{d as ye,c as O,_ as Ce,u as Se}from"./main-D8Sf3LQA.js";import{S as te}from"./sweetalert2.esm.all-5zhdP7Ax.js";import{r as M,c as R,d as ie,k as i,x,l,m as e,t,a2 as le,A as U,I as we,n as V,F as A,D as T,a1 as Y,y as N,P as qe,q as Q,f as P,u as f,z as je,w as $e,Y as ke,o as Me,E as Ee}from"./vendor-Bdl_vdY1.js";import{Y as Be,h as xe,_ as Ie,G as Ve,S as De}from"./transition-BzpQGcto.js";import{_ as Ae}from"./AlertMessages.vue_vue_type_script_setup_true_lang-y86y1vHF.js";import"./quill-De1S0mUZ.js";import"./hidden-DzwkeN7j.js";import"./keyboard-C60PJS2L.js";import"./open-closed-PeVjlPmr.js";function Pe(){const{t:c}=ye(),_=M([]),y=M([]),S=M([]),B=M(!1),E=M(!1),m=M(""),j=M(""),o=M({}),s=M(""),a=M({show:!1,data:null}),g=M({status:"",supplier_id:""}),b={id:null,supplier_id:null,expected_delivery_date:null,notes:"",items:[]},C=M({...b}),G=R(()=>{let r=_.value;if(s.value){const n=s.value.toLowerCase();r=r.filter(p=>{var u,h,w;return((u=p.order_number)==null?void 0:u.toLowerCase().includes(n))||((w=(h=p.supplier)==null?void 0:h.name)==null?void 0:w.toLowerCase().includes(n))})}return g.value.status&&(r=r.filter(n=>n.status===g.value.status)),g.value.supplier_id&&(r=r.filter(n=>n.supplier_id===parseInt(g.value.supplier_id))),r}),H=R(()=>_.value.length),$=R(()=>_.value.filter(r=>r.status==="pending").length),L=R(()=>_.value.filter(r=>r.status==="approved").length),J=R(()=>_.value.filter(r=>r.status==="ordered").length),F=R(()=>_.value.filter(r=>r.status==="received").length),W=async()=>{B.value=!0,m.value="";try{const r=new URLSearchParams;g.value.status&&r.append("status",g.value.status),g.value.supplier_id&&r.append("supplier_id",g.value.supplier_id);const n=await O.get(`/api/purchase-orders?${r}`);Array.isArray(n.data)?_.value=n.data:n.data&&Array.isArray(n.data.data)?_.value=n.data.data:n.data&&Array.isArray(n.data.orders)?_.value=n.data.orders:(console.warn("Estructura de respuesta inesperada:",n.data),_.value=[])}catch(r){console.error("Error fetching orders:",r),m.value=c("purchase_orders_page.alerts.loading_error"),d(c("purchase_orders_page.alerts.loading_error"),"error")}finally{B.value=!1}},ce=async()=>{try{const r=await O.get("/api/suppliers/for-select");Array.isArray(r.data)?y.value=r.data:r.data&&Array.isArray(r.data.data)?y.value=r.data.data:(console.warn("Estructura de respuesta inesperada para suppliers:",r.data),y.value=[])}catch(r){console.error("Error fetching suppliers:",r),y.value=[]}},X=async()=>{try{const r=await O.get("/api/products/active/list");Array.isArray(r.data)?S.value=r.data:r.data&&Array.isArray(r.data.data)?S.value=r.data.data:(console.warn("Estructura de respuesta inesperada para products:",r.data),S.value=[])}catch(r){console.error("Error fetching products:",r),S.value=[]}},ae=r=>r&&S.value.find(n=>n.id===r)||null,Z=(r,n)=>{if(!r)return{valid:!1,message:"Producto no seleccionado"};const p=ae(r);if(!p)return{valid:!1,message:"Producto no encontrado"};const u=p.current_stock||0;return n>u?{valid:!1,message:`Stock insuficiente. Stock disponible: ${u}`}:{valid:!0,message:""}},ee=async()=>{E.value=!0,o.value={},m.value="",j.value="";try{let r;C.value.id?r=await O.put(`/api/purchase-orders/${C.value.id}`,C.value):r=await O.post("/api/purchase-orders",C.value);const n=r.data.data||r.data;if(C.value.id){const p=_.value.findIndex(u=>u.id===C.value.id);p!==-1&&_.value.splice(p,1,n),d(c("purchase_orders_page.alerts.update_success"))}else _.value.unshift(n),d(c("purchase_orders_page.alerts.save_success"));return!0}catch(r){return r.response&&r.response.status===422?(o.value=r.response.data.errors,m.value=c("purchase_orders_page.alerts.validation_errors")):(console.error("Error saving order:",r),m.value=c("purchase_orders_page.alerts.save_error"),d(c("purchase_orders_page.alerts.save_error"),"error")),!1}finally{E.value=!1}},K=async r=>{var p;if(!r.can_be_deleted)return d(c("purchase_orders_page.alerts.cannot_delete"),"error"),!1;if((await te.fire({title:c("purchase_orders_page.delete_confirm.title"),text:c("purchase_orders_page.delete_confirm.text"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:c("purchase_orders_page.delete_confirm.confirm"),cancelButtonText:c("purchase_orders_page.delete_confirm.cancel")})).isConfirmed)try{return await O.delete(`/api/purchase-orders/${r.id}`),_.value=_.value.filter(u=>u.id!==r.id),d(c("purchase_orders_page.alerts.delete_success")),!0}catch(u){return console.error("Error deleting order:",u),((p=u.response)==null?void 0:p.status)===400?d(u.response.data.message,"error"):d(c("purchase_orders_page.alerts.delete_error"),"error"),!1}return!1},z=async r=>{var n,p;try{const u=await O.post(`/api/purchase-orders/${r.id}/submit`);if(u.data.success){const h=_.value.findIndex(w=>w.id===r.id);return h!==-1&&_.value.splice(h,1,u.data.order),d(c("purchase_orders_page.alerts.submit_success")),!0}else return d(u.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error submitting order:",u);const h=((p=(n=u.response)==null?void 0:n.data)==null?void 0:p.message)||c("purchase_orders_page.alerts.save_error");return d(h,"error"),!1}},D=async r=>{var n,p;try{const u=await O.post(`/api/purchase-orders/${r.id}/approve`);if(u.data.success){const h=_.value.findIndex(w=>w.id===r.id);return h!==-1&&_.value.splice(h,1,u.data.order),d(c("purchase_orders_page.alerts.approve_success")),!0}else return d(u.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error approving order:",u);const h=((p=(n=u.response)==null?void 0:n.data)==null?void 0:p.message)||c("purchase_orders_page.alerts.save_error");return d(h,"error"),!1}},ue=async r=>{var p,u;const{value:n}=await te.fire({title:c("purchase_orders_page.reject_confirm.title"),input:"textarea",inputLabel:c("purchase_orders_page.reject_confirm.input_label"),inputPlaceholder:c("purchase_orders_page.reject_confirm.input_placeholder"),inputAttributes:{"aria-label":c("purchase_orders_page.reject_confirm.input_label")},showCancelButton:!0,confirmButtonText:c("purchase_orders_page.reject_confirm.confirm"),cancelButtonText:c("purchase_orders_page.reject_confirm.cancel"),inputValidator:h=>h?null:c("purchase_orders_page.reject_confirm.input_required")});if(n)try{const h=await O.post(`/api/purchase-orders/${r.id}/reject`,{rejection_reason:n});if(h.data.success){const w=_.value.findIndex(re=>re.id===r.id);return w!==-1&&_.value.splice(w,1,h.data.order),d(c("purchase_orders_page.alerts.reject_success")),!0}else return d(h.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(h){console.error("Error rejecting order:",h);const w=((u=(p=h.response)==null?void 0:p.data)==null?void 0:u.message)||c("purchase_orders_page.alerts.save_error");return d(w,"error"),!1}return!1},pe=async r=>{var n,p;try{const u=await O.post(`/api/purchase-orders/${r.id}/mark-ordered`);if(u.data.success){const h=_.value.findIndex(w=>w.id===r.id);return h!==-1&&_.value.splice(h,1,u.data.order),d(c("purchase_orders_page.alerts.mark_ordered_success")),!0}else return d(u.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error marking order as ordered:",u);const h=((p=(n=u.response)==null?void 0:n.data)==null?void 0:p.message)||c("purchase_orders_page.alerts.save_error");return d(h,"error"),!1}},_e=async r=>{var n,p;try{const u=await O.post(`/api/purchase-orders/${r.id}/receive`);if(u.data.success){const h=_.value.findIndex(w=>w.id===r.id);return h!==-1&&_.value.splice(h,1,u.data.order),d(c("purchase_orders_page.alerts.receive_success")),!0}else return d(u.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error receiving order:",u);const h=((p=(n=u.response)==null?void 0:n.data)==null?void 0:p.message)||c("purchase_orders_page.alerts.save_error");return d(h,"error"),!1}},oe=async r=>{var p,u;const{value:n}=await te.fire({title:c("purchase_orders_page.cancel_confirm.title"),input:"textarea",inputLabel:c("purchase_orders_page.cancel_confirm.input_label"),inputPlaceholder:c("purchase_orders_page.cancel_confirm.input_placeholder"),showCancelButton:!0,confirmButtonText:c("purchase_orders_page.cancel_confirm.confirm"),cancelButtonText:c("purchase_orders_page.cancel_confirm.cancel")});if(n!==void 0)try{const h=await O.post(`/api/purchase-orders/${r.id}/cancel`,{reason:n||null});if(h.data.success){const w=_.value.findIndex(re=>re.id===r.id);return w!==-1&&_.value.splice(w,1,h.data.order),d(c("purchase_orders_page.alerts.cancel_success")),!0}else return d(h.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(h){console.error("Error canceling order:",h);const w=((u=(p=h.response)==null?void 0:p.data)==null?void 0:u.message)||c("purchase_orders_page.alerts.save_error");return d(w,"error"),!1}return!1},me=async r=>{var n,p;try{const u=await O.post(`/api/purchase-orders/${r.id}/reopen`);if(u.data.success){const h=_.value.findIndex(w=>w.id===r.id);return h!==-1&&_.value.splice(h,1,u.data.order),d(c("purchase_orders_page.alerts.reopen_success")),!0}else return d(u.data.message||c("purchase_orders_page.alerts.save_error"),"error"),!1}catch(u){console.error("Error reopening order:",u);const h=((p=(n=u.response)==null?void 0:n.data)==null?void 0:p.message)||c("purchase_orders_page.alerts.save_error");return d(h,"error"),!1}},ne=async(r,n)=>{E.value=!0,o.value={},m.value="",j.value="";try{const p=await O.post(`/api/purchase-orders/${r}/split`,n);return p.data?(await W(),d(c("purchase_orders_page.alerts.split_success")),!0):(d(p.data.message||c("purchase_orders_page.alerts.split_error"),"error"),!1)}catch(p){return p.response&&p.response.status===422?(o.value=p.response.data.errors,m.value=c("purchase_orders_page.alerts.validation_errors")):(console.error("Error splitting order:",p),m.value=c("purchase_orders_page.alerts.split_error"),d(c("purchase_orders_page.alerts.split_error"),"error")),!1}finally{E.value=!1}},he=(r=null)=>{var n;o.value={},r?C.value={id:r.id,supplier_id:r.supplier_id,expected_delivery_date:r.expected_delivery_date,notes:r.notes&&Array.isArray(r.notes)&&r.notes.length>0?r.notes[0].note:"",items:((n=r.items)==null?void 0:n.map(p=>({id:p.id,product_id:p.product_id,quantity:p.quantity,notes:p.notes&&Array.isArray(p.notes)&&p.notes.length>0?p.notes[0].note:""})))||[]}:(C.value={...b},C.value.items=[se()])},ge=()=>{C.value={...b},o.value={}},se=()=>({product_id:null,quantity:1,notes:""}),de=()=>{C.value.items.push(se())},ve=r=>{C.value.items.splice(r,1),C.value.items.length===0&&de()},v=r=>({draft:"bg-gray-100 text-gray-800",pending:"bg-warning/10 text-warning",approved:"bg-success/10 text-success",rejected:"bg-danger/10 text-danger",ordered:"bg-info/10 text-info",received:"bg-secondary/10 text-secondary",cancelled:"bg-danger/10 text-danger"})[r]||"bg-gray-100 text-gray-800",d=(r="",n="success")=>{n==="success"?j.value=r:m.value=r,te.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3}).fire({icon:n,title:r,padding:"10px 20px"})};return{ordersList:_,suppliers:y,products:S,loading:B,saving:E,errorMessage:m,successMessage:j,errors:o,searchOrder:s,filters:g,params:C,viewModal:a,filteredOrdersList:G,totalOrders:H,pendingOrders:$,approvedOrders:L,orderedOrders:J,receivedOrders:F,fetchOrders:W,fetchSuppliers:ce,fetchProducts:X,getProductInfo:ae,validateQuantity:Z,saveOrder:ee,deleteOrder:K,submitOrder:z,approveOrder:D,rejectOrder:ue,markAsOrdered:pe,receiveOrder:_e,cancelOrder:oe,reopenOrder:me,editOrder:he,resetParams:ge,addItem:de,removeItem:ve,getStatusClass:v,showMessage:d,formatDate:r=>r?new Date(r).toLocaleDateString("es-ES"):"-",viewOrder:async r=>{B.value=!0,a.value={show:!0,data:null};try{const n=await O.get(`/api/purchase-orders/${r}`);a.value.data=n.data}catch(n){console.error("Error fetching order for view:",n),d(c("purchase_orders_page.alerts.loading_error"),"error"),a.value.show=!1}finally{B.value=!1}},closeViewModal:()=>{a.value={show:!1,data:null}},splitOrder:ne}}const Te={key:0,class:"fixed inset-0 bg-[black]/60 z-50 overflow-y-auto"},Le={class:"flex items-start justify-center min-h-screen px-4"},Ue={class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-6xl my-8"},Ne={class:"flex bg-[#fbfbfb] dark:bg-[#1c232f] items-center justify-between px-5 py-3"},ze={class:"font-bold text-lg"},Re={class:"p-5"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5"},He={for:"supplier",class:"form-label"},Fe={value:""},Ke=["value"],Ye={key:0,class:"text-danger mt-1 text-xs"},Ge={for:"expected_delivery_date",class:"form-label"},Je={key:0,class:"text-danger mt-1 text-xs"},We={class:"mb-5"},Xe={class:"flex justify-between items-center mb-3"},Ze={class:"form-label"},es={class:"space-y-4"},ss={class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-start"},rs={class:"md:col-span-6"},ts={class:"form-label"},as=["onUpdate:modelValue"],os={value:""},ns=["value","disabled"],ds={key:0,class:"text-danger text-xs"},ls={key:1,class:"text-success text-xs"},is={key:0,class:"text-danger mt-1 text-xs"},cs={class:"md:col-span-4"},us={class:"form-label"},ps=["onUpdate:modelValue","max","onInput"],_s={key:0,class:"text-danger mt-1 text-xs"},ms={key:1,class:"text-danger mt-1 text-xs"},hs={key:2,class:"text-info mt-1 text-xs"},gs={class:"md:col-span-2"},vs=["onClick","disabled"],fs={class:"mt-3"},ys={class:"form-label"},bs=["onUpdate:modelValue","placeholder"],ws={class:"mb-5"},$s={for:"notes",class:"form-label"},ks=["placeholder"],xs={class:"flex justify-end items-center mt-8 border-t pt-4"},Cs=["disabled"],qs=["disabled"],Os={key:0,class:"flex items-center"},Ss={key:1},js=ie({__name:"PurchaseOrderModal",props:{show:{type:Boolean},params:{},errors:{},saving:{type:Boolean},suppliers:{},products:{}},emits:["close","save","add-item","remove-item"],setup(c,{emit:_}){const y=c,S=R(()=>y.products.filter(o=>o.is_active!==!1)),B=R(()=>{const o=y.params.items.length>0&&y.params.items.every(s=>s.product_id&&s.quantity>0&&s.quantity<=m(s.product_id));return y.params.supplier_id&&y.params.expected_delivery_date&&o}),E=(o,s)=>{s<1&&(y.params.items[o].quantity=1);const a=m(y.params.items[o].product_id);s>a&&(y.params.items[o].quantity=a)},m=o=>{if(!o)return 0;const s=y.products.find(a=>a.id===o);return(s==null?void 0:s.stock)||0},j=(o,s)=>{if(!o)return{hasError:!1,message:""};const a=m(o);return s>a?{hasError:!0,message:`Excede stock disponible (${a})`}:{hasError:!1,message:""}};return(o,s)=>o.show?(l(),i("div",Te,[e("div",Le,[e("div",Ue,[e("div",Ne,[e("h5",ze,t(o.params.id?o.$t("purchase_orders_page.create_modal.edit_title"):o.$t("purchase_orders_page.create_modal.add_title")),1),e("button",{type:"button",class:"text-white-dark hover:text-dark",onClick:s[0]||(s[0]=a=>o.$emit("close"))},[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),e("div",Re,[e("form",{onSubmit:s[6]||(s[6]=le(a=>o.$emit("save",o.params),["prevent"]))},[e("div",Qe,[e("div",null,[e("label",He,t(o.$t("purchase_orders_page.create_modal.fields.supplier"))+" * ",1),U(e("select",{id:"supplier","onUpdate:modelValue":s[1]||(s[1]=a=>o.params.supplier_id=a),class:V(["form-select",{"border-danger":o.errors.supplier_id}]),required:""},[e("option",Fe,t(o.$t("purchase_orders_page.create_modal.placeholders.select_supplier")),1),(l(!0),i(A,null,T(o.suppliers,a=>(l(),i("option",{key:a.id,value:a.id},t(a.name),9,Ke))),128))],2),[[we,o.params.supplier_id]]),o.errors.supplier_id?(l(),i("div",Ye,t(o.errors.supplier_id[0]),1)):x("",!0)]),e("div",null,[e("label",Ge,t(o.$t("purchase_orders_page.create_modal.fields.expected_delivery_date"))+" * ",1),U(e("input",{id:"expected_delivery_date",type:"date","onUpdate:modelValue":s[2]||(s[2]=a=>o.params.expected_delivery_date=a),class:V(["form-input",{"border-danger":o.errors.expected_delivery_date}]),required:""},null,2),[[Y,o.params.expected_delivery_date]]),o.errors.expected_delivery_date?(l(),i("div",Je,t(o.errors.expected_delivery_date[0]),1)):x("",!0)])]),e("div",We,[e("div",Xe,[e("label",Ze,t(o.$t("purchase_orders_page.create_modal.fields.items"))+" * ",1),e("button",{type:"button",class:"btn btn-primary btn-sm",onClick:s[3]||(s[3]=a=>o.$emit("add-item"))}," + "+t(o.$t("purchase_orders_page.create_modal.buttons.add_item")),1)]),e("div",es,[(l(!0),i(A,null,T(o.params.items,(a,g)=>(l(),i("div",{key:g,class:"border border-[#e0e6ed] dark:border-[#1b2e4b] rounded p-4 bg-gray-50 dark:bg-[#1a2234]"},[e("div",ss,[e("div",rs,[e("label",ts,t(o.$t("purchase_orders_page.create_modal.fields.product"))+" * ",1),U(e("select",{"onUpdate:modelValue":b=>a.product_id=b,class:V(["form-select",{"border-danger":o.errors[`items.${g}.product_id`]||!a.product_id&&a.quantity>0}]),required:""},[e("option",os,t(o.$t("purchase_orders_page.create_modal.placeholders.select_product")),1),(l(!0),i(A,null,T(S.value,b=>(l(),i("option",{key:b.id,value:b.id,disabled:!b.stock||b.stock<=0},[N(t(b.name)+" ",1),!b.stock||b.stock<=0?(l(),i("span",ds," (Sin stock) ")):(l(),i("span",ls," (Stock: "+t(b.stock)+") ",1))],8,ns))),128))],10,as),[[we,a.product_id]]),o.errors[`items.${g}.product_id`]?(l(),i("div",is,t(o.errors[`items.${g}.product_id`][0]),1)):x("",!0)]),e("div",cs,[e("label",us,t(o.$t("purchase_orders_page.create_modal.fields.quantity"))+" * ",1),U(e("input",{type:"number","onUpdate:modelValue":b=>a.quantity=b,min:"1",max:m(a.product_id),class:V(["form-input",{"border-danger":o.errors[`items.${g}.quantity`]||j(a.product_id,a.quantity).hasError}]),onInput:b=>E(g,a.quantity),required:""},null,42,ps),[[Y,a.quantity,void 0,{number:!0}]]),o.errors[`items.${g}.quantity`]?(l(),i("div",_s,t(o.errors[`items.${g}.quantity`][0]),1)):x("",!0),j(a.product_id,a.quantity).hasError?(l(),i("div",ms,t(j(a.product_id,a.quantity).message),1)):x("",!0),a.product_id&&m(a.product_id)>0?(l(),i("div",hs," Máx: "+t(m(a.product_id)),1)):x("",!0)]),e("div",gs,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm w-full",onClick:b=>o.$emit("remove-item",g),disabled:o.params.items.length===1},t(o.$t("purchase_orders_page.create_modal.buttons.remove_item")),9,vs)])]),e("div",fs,[e("label",ys,t(o.$t("purchase_orders_page.create_modal.fields.item_notes")),1),U(e("textarea",{"onUpdate:modelValue":b=>a.notes=b,class:"form-textarea min-h-[60px]",placeholder:o.$t("purchase_orders_page.create_modal.placeholders.item_notes"),rows:"2"},null,8,bs),[[Y,a.notes]])])]))),128))])]),e("div",ws,[e("label",$s,t(o.$t("purchase_orders_page.create_modal.fields.notes")),1),U(e("textarea",{id:"notes","onUpdate:modelValue":s[4]||(s[4]=a=>o.params.notes=a),class:"form-textarea min-h-[80px]",placeholder:o.$t("purchase_orders_page.create_modal.placeholders.notes"),rows:"3"},null,8,ks),[[Y,o.params.notes]])]),e("div",xs,[e("button",{type:"button",class:"btn btn-outline-danger mr-3",onClick:s[5]||(s[5]=a=>o.$emit("close")),disabled:o.saving},t(o.$t("purchase_orders_page.create_modal.buttons.cancel")),9,Cs),e("button",{type:"submit",class:"btn btn-primary",disabled:o.saving||!B.value},[o.saving?(l(),i("span",Os,[s[8]||(s[8]=e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),N(" "+t(o.$t("purchase_orders_page.create_modal.buttons.saving")),1)])):(l(),i("span",Ss,t(o.params.id?o.$t("purchase_orders_page.create_modal.buttons.update"):o.$t("purchase_orders_page.create_modal.buttons.add")),1))],8,qs)])],32)])])])])):x("",!0)}}),Ms={class:"fixed inset-0 overflow-y-auto"},Es={class:"flex min-h-full items-center justify-center px-4 py-8"},Bs={class:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]"},Is={key:0},Vs={key:1,class:"text-gray-500"},Ds={class:"p-5"},As={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ps={class:"space-y-4"},Ts={class:"font-semibold text-gray-600"},Ls={class:"text-lg"},Us={class:"text-sm text-gray-500"},Ns={class:"text-sm text-gray-500"},zs={class:"font-semibold text-gray-600"},Rs={class:"font-semibold text-gray-600"},Qs={class:"text-sm text-gray-500"},Hs={key:0},Fs={class:"font-semibold text-gray-600"},Ks={class:"text-lg"},Ys={key:1},Gs={class:"font-semibold text-gray-600"},Js={class:"flex flex-wrap gap-2"},Ws=["onClick"],Xs={class:"space-y-4"},Zs={class:"font-semibold text-gray-600"},er={class:"font-semibold text-gray-600"},sr={key:0,class:"text-xs ml-2"},rr={key:1,class:"text-xs ml-2 text-success"},tr={key:0},ar={class:"font-semibold text-gray-600"},or={key:1},nr={class:"font-semibold text-gray-600"},dr={class:"text-sm text-gray-500"},lr={class:"mb-6"},ir={class:"text-lg font-semibold mb-4"},cr={class:"table-responsive"},ur={class:"table-striped table-hover"},pr={class:"text-center"},_r={class:"text-center"},mr={class:"text-center"},hr={class:"font-semibold"},gr={class:"text-sm text-gray-500"},vr={key:0,class:"mt-2 space-y-2 text-xs"},fr={class:"font-semibold"},yr={class:"text-gray-500 text-xs"},br={class:"text-gray-600 dark:text-gray-300"},wr={class:"text-center"},$r={class:"text-center"},kr={class:"text-center"},xr={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Cr={class:"space-y-2"},qr={key:0},Or={class:"font-semibold text-gray-600"},Sr={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded space-y-3"},jr={key:0,class:"text-gray-500"},Mr={class:"font-semibold"},Er={class:"text-gray-500 text-xs"},Br={class:"text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Ir={key:1},Vr={class:"font-semibold text-danger"},Dr={class:"bg-danger/10 text-danger p-3 rounded"},Ar={class:"flex justify-end items-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-700"},Pr={key:1,class:"text-center py-8"},Tr={class:"text-gray-500"},Lr=ie({__name:"PurchaseOrderViewModal",props:{show:{type:Boolean},order:{}},emits:["close","view-order-id"],setup(c,{emit:_}){const y=s=>({"nuevo pedido":"bg-gray-100 text-gray-800",disponibilidad:"bg-secondary/10 text-secondary","preparar pedido":"bg-success/10 text-success","en preparación":"bg-info/10 text-info",facturación:"bg-primary/10 text-primary","en despacho":"bg-warning/10 text-warning","en ruta":"bg-danger/10 text-danger",entregado:"bg-success/10 text-success"})[s]||"bg-gray-100 text-gray-800",S=s=>s.received_quantity===0?"text-danger":s.received_quantity<s.quantity?"text-warning":"text-success",B=s=>{const a=s.quantity-s.received_quantity;return a===0?"text-success":a>0?"text-warning":"text-danger"},E=s=>s.expected_delivery_date?new Date(s.expected_delivery_date)<new Date&&s.status!=="received":!1,m=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"-",j=s=>s?new Date(s).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",o=()=>{window.print()};return(s,a)=>(l(),qe(f(De),{appear:"",show:s.show,as:"template"},{default:Q(()=>[P(f(Be),{as:"div",onClose:a[3]||(a[3]=g=>s.$emit("close")),class:"relative z-[51]"},{default:Q(()=>[P(f(xe),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:Q(()=>[P(f(Ie),{class:"fixed inset-0 bg-[black]/60"})]),_:1}),e("div",Ms,[e("div",Es,[P(f(xe),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:Q(()=>[P(f(Ve),{class:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-4xl text-black dark:text-white-dark"},{default:Q(()=>{var g,b,C,G,H;return[e("button",{type:"button",class:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",onClick:a[0]||(a[0]=$=>s.$emit("close"))},[...a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-6 h-6"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])]),e("div",Bs,[N(t(s.$t("purchase_orders_page.view_modal.title"))+" ",1),s.order?(l(),i("span",Is,t(s.order.order_number),1)):(l(),i("span",Vs,t(s.$t("purchase_orders_page.view_modal.status.loading")),1))]),e("div",Ds,[s.order?(l(),i(A,{key:0},[e("div",As,[e("div",Ps,[e("div",null,[e("label",Ts,t(s.$t("purchase_orders_page.view_modal.fields.supplier"))+": ",1),e("p",Ls,t((g=s.order.supplier)==null?void 0:g.name),1),e("p",Us,t((b=s.order.supplier)==null?void 0:b.contact_person),1),e("p",Ns,t((C=s.order.supplier)==null?void 0:C.email),1)]),e("div",null,[e("label",zs,t(s.$t("purchase_orders_page.view_modal.fields.status"))+": ",1),e("span",{class:V(["badge ml-2",y(s.order.status)])},t(s.$t(`purchase_orders_page.status.${s.order.status.replace(/ /g,"_")}`)),3)]),e("div",null,[e("label",Rs,t(s.$t("purchase_orders_page.view_modal.fields.created_by"))+": ",1),e("p",null,t((G=s.order.creator)==null?void 0:G.name),1),e("p",Qs,t(m(s.order.created_at)),1)]),s.order.parent?(l(),i("div",Hs,[e("label",Fs,t(s.$t("purchase_orders_page.view_modal.fields.parent_order"))+": ",1),e("p",Ks,[e("a",{href:"#",onClick:a[1]||(a[1]=le($=>s.$emit("view-order-id",s.order.parent.id),["prevent"])),class:"btn btn-outline-info btn-sm"}," #"+t(s.order.parent.order_number),1)])])):x("",!0),s.order.sub_orders&&s.order.sub_orders.length>0?(l(),i("div",Ys,[e("label",Gs,t(s.$t("purchase_orders_page.view_modal.fields.sub_orders"))+": ",1),e("div",Js,[(l(!0),i(A,null,T(s.order.sub_orders,$=>(l(),i("a",{key:$.id,href:"#",onClick:le(L=>s.$emit("view-order-id",$.id),["prevent"]),class:"btn btn-outline-info btn-sm"}," #"+t($.order_number),9,Ws))),128))])])):x("",!0)]),e("div",Xs,[e("div",null,[e("label",Zs,t(s.$t("purchase_orders_page.view_modal.fields.order_date"))+": ",1),e("p",null,t(m(s.order.order_date)),1)]),e("div",null,[e("label",er,t(s.$t("purchase_orders_page.view_modal.fields.expected_delivery"))+": ",1),e("p",{class:V({"text-warning":E(s.order)})},[N(t(m(s.order.expected_delivery_date))+" ",1),E(s.order)?(l(),i("span",sr," ("+t(s.$t("purchase_orders_page.view_modal.delivery_status.delayed"))+") ",1)):s.order.expected_delivery_date?(l(),i("span",rr," ("+t(s.$t("purchase_orders_page.view_modal.delivery_status.on_time"))+") ",1)):x("",!0)],2)]),s.order.delivery_date?(l(),i("div",tr,[e("label",ar,t(s.$t("purchase_orders_page.view_modal.fields.delivery_date"))+": ",1),e("p",null,t(m(s.order.delivery_date)),1)])):x("",!0),s.order.approved_by?(l(),i("div",or,[e("label",nr,t(s.$t("purchase_orders_page.view_modal.fields.approved_by"))+": ",1),e("p",null,t((H=s.order.approver)==null?void 0:H.name),1),e("p",dr,t(m(s.order.approved_at)),1)])):x("",!0)])]),e("div",lr,[e("h3",ir,t(s.$t("purchase_orders_page.view_modal.sections.order_items")),1),e("div",cr,[e("table",ur,[e("thead",null,[e("tr",null,[e("th",null,t(s.$t("purchase_orders_page.view_modal.fields.product")),1),e("th",pr,t(s.$t("purchase_orders_page.view_modal.fields.quantity")),1),e("th",_r,t(s.$t("purchase_orders_page.view_modal.fields.received")),1),e("th",mr,t(s.$t("purchase_orders_page.view_modal.fields.pending")),1)])]),e("tbody",null,[(l(!0),i(A,null,T(s.order.items,$=>{var L,J;return l(),i("tr",{key:$.id},[e("td",null,[e("div",hr,t((L=$.product)==null?void 0:L.name),1),e("div",gr,t((J=$.product)==null?void 0:J.sku),1),$.notes&&$.notes.length?(l(),i("div",vr,[(l(!0),i(A,null,T($.notes,(F,W)=>(l(),i("div",{key:W,class:"p-2 rounded bg-gray-100 dark:bg-gray-700"},[e("p",fr,[N(t(F.user_name)+" ",1),e("span",yr,"- "+t(j(F.timestamp)),1)]),e("p",br,t(F.note),1)]))),128))])):x("",!0)]),e("td",wr,t($.quantity),1),e("td",$r,[e("span",{class:V(S($))},t($.received_quantity),3)]),e("td",kr,[e("span",{class:V(B($))},t($.quantity-$.received_quantity),3)])])}),128))])])])]),e("div",xr,[e("div",Cr,[s.order.notes?(l(),i("div",qr,[e("label",Or,t(s.$t("purchase_orders_page.view_modal.fields.notes"))+": ",1),e("div",Sr,[!s.order.notes||s.order.notes.length===0?(l(),i("div",jr," No hay notas generales. ")):x("",!0),(l(!0),i(A,null,T(s.order.notes,($,L)=>(l(),i("div",{key:L,class:"text-sm pb-2 border-b dark:border-gray-700 last:border-b-0"},[e("p",Mr,[N(t($.user_name)+" ",1),e("span",Er,"- "+t(j($.timestamp)),1)]),e("p",Br,t($.note),1)]))),128))])])):x("",!0),s.order.rejection_reason?(l(),i("div",Ir,[e("label",Vr,t(s.$t("purchase_orders_page.view_modal.fields.rejection_reason"))+": ",1),e("p",Dr,t(s.order.rejection_reason),1)])):x("",!0)])]),e("div",Ar,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:o},[a[5]||(a[5]=e("svg",{class:"w-4 h-4 ltr:mr-2 rtl:ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)),N(" "+t(s.$t("purchase_orders_page.view_modal.buttons.print")),1)]),e("button",{type:"button",class:"btn btn-outline-danger ltr:ml-4 rtl:mr-4",onClick:a[2]||(a[2]=$=>s.$emit("close"))},t(s.$t("purchase_orders_page.view_modal.buttons.close")),1)])],64)):(l(),i("div",Pr,[a[6]||(a[6]=e("div",{class:"animate-spin border-2 border-primary border-t-transparent rounded-full w-8 h-8 mx-auto mb-4"},null,-1)),e("p",Tr,t(s.$t("purchase_orders_page.view_modal.status.loading")),1)]))])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),Ur=Ce(Lr,[["__scopeId","data-v-89c892dd"]]),Nr={key:0,class:"fixed inset-0 z-[999] bg-[rgba(0,0,0,0.2)]"},zr={key:0,class:"panel absolute top-1/2 left-1/2 w-full max-w-lg -translate-x-1/2 -translate-y-1/2"},Rr={class:"flex items-center justify-between bg-[#fbfbfb] px-5 py-3 dark:bg-[#121c2c]"},Qr={class:"text-lg font-bold"},Hr={class:"p-5"},Fr={class:"mb-5"},Kr={for:"expectedDeliveryDate"},Yr=["placeholder"],Gr={key:0,class:"text-danger mt-1"},Jr={class:"mb-5"},Wr={for:"notes"},Xr=["placeholder"],Zr={key:0,class:"text-danger mt-1"},et={class:"mb-5"},st={key:0},rt={class:"flex-grow"},tt={class:"font-semibold"},at={class:"w-1/3 ml-4"},ot=["placeholder","onUpdate:modelValue","max","onInput"],nt={key:0,class:"text-danger mt-1"},dt={key:0,class:"text-danger mt-1"},lt={key:1,class:"text-center text-gray-500"},it={class:"mt-8 flex items-center justify-end"},ct=["disabled"],ut={key:0},pt={key:1},_t=ie({__name:"PurchaseOrderSplitModal",props:{show:{type:Boolean},order:{},errors:{},saving:{type:Boolean}},emits:["close","split"],setup(c,{emit:_}){const{t:y}=ye(),S=_,B=c,E={expected_delivery_date:"",notes:"",items:[]},m=je({...E});$e(()=>B.order,s=>{s&&s.items?(m.items=s.items.map(a=>({item_id:a.id,quantity:a.quantity})),m.expected_delivery_date="",m.notes=""):m.items=[]},{immediate:!0}),$e(()=>B.show,s=>{s||(Object.assign(m,E),m.items=[])});const j=(s,a)=>{m.items[s].quantity<0?m.items[s].quantity=0:m.items[s].quantity>a&&(m.items[s].quantity=a)},o=()=>{const s=m.items.filter(a=>a.quantity>0);if(s.length===0){alert(y("purchase_orders_page.split_modal.alerts.no_items_selected"));return}S("split",{expected_delivery_date:m.expected_delivery_date,notes:m.notes,items:s})};return(s,a)=>(l(),qe(ke,{appear:"","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:Q(()=>[s.show?(l(),i("div",Nr,[P(ke,{appear:"","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:Q(()=>[s.show?(l(),i("div",zr,[e("div",Rr,[e("h5",Qr,t(f(y)("purchase_orders_page.split_modal.title")),1),e("button",{type:"button",class:"text-white-dark hover:text-dark",onClick:a[0]||(a[0]=g=>S("close"))},[...a[4]||(a[4]=[e("svg",null,"...",-1)])])]),e("div",Hr,[e("form",{onSubmit:le(o,["prevent"])},[e("div",Fr,[e("label",Kr,t(f(y)("purchase_orders_page.split_modal.fields.expected_delivery_date")),1),U(e("input",{id:"expectedDeliveryDate",type:"date",placeholder:f(y)("purchase_orders_page.split_modal.placeholders.expected_delivery_date"),class:V(["form-input",[s.errors.expected_delivery_date?"border-danger":""]]),"onUpdate:modelValue":a[1]||(a[1]=g=>m.expected_delivery_date=g)},null,10,Yr),[[Y,m.expected_delivery_date]]),s.errors.expected_delivery_date?(l(),i("p",Gr,t(s.errors.expected_delivery_date[0]),1)):x("",!0)]),e("div",Jr,[e("label",Wr,t(f(y)("purchase_orders_page.split_modal.fields.notes")),1),U(e("textarea",{id:"notes",rows:"3",placeholder:f(y)("purchase_orders_page.split_modal.placeholders.notes"),class:V(["form-textarea",[s.errors.notes?"border-danger":""]]),"onUpdate:modelValue":a[2]||(a[2]=g=>m.notes=g)},null,10,Xr),[[Y,m.notes]]),s.errors.notes?(l(),i("p",Zr,t(s.errors.notes[0]),1)):x("",!0)]),e("div",et,[e("label",null,t(f(y)("purchase_orders_page.split_modal.fields.items_to_split")),1),s.order&&s.order.items&&s.order.items.length>0?(l(),i("div",st,[(l(!0),i(A,null,T(s.order.items,(g,b)=>(l(),i("div",{key:g.id,class:"flex items-center justify-between mb-3 border p-3 rounded"},[e("div",rt,[e("p",tt,t(g.product.name)+" ("+t(g.quantity)+" "+t(f(y)("purchase_orders_page.split_modal.available"))+")",1)]),e("div",at,[U(e("input",{type:"number",placeholder:f(y)("purchase_orders_page.split_modal.placeholders.quantity_to_split"),class:"form-input","onUpdate:modelValue":C=>m.items[b].quantity=C,min:0,max:g.quantity,onInput:C=>j(b,g.quantity)},null,40,ot),[[Y,m.items[b].quantity,void 0,{number:!0}]]),s.errors[`items.${b}.quantity`]?(l(),i("p",nt,t(s.errors[`items.${b}.quantity`][0]),1)):x("",!0)])]))),128)),s.errors.items?(l(),i("p",dt,t(s.errors.items[0]),1)):x("",!0)])):(l(),i("div",lt,t(f(y)("purchase_orders_page.split_modal.no_items")),1))]),e("div",it,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:a[3]||(a[3]=g=>S("close"))},t(f(y)("purchase_orders_page.split_modal.buttons.cancel")),1),e("button",{type:"submit",class:"btn btn-primary ltr:ml-4 rtl:mr-4",disabled:s.saving},[s.saving?(l(),i("span",ut,t(f(y)("purchase_orders_page.split_modal.buttons.splitting")),1)):(l(),i("span",pt,t(f(y)("purchase_orders_page.split_modal.buttons.split")),1))],8,ct)])],32)])])):x("",!0)]),_:1})])):x("",!0)]),_:1}))}}),mt=Ce(_t,[["__scopeId","data-v-d90f3303"]]),ht={class:"flex space-x-2 rtl:space-x-reverse mb-6"},gt={href:"javascript:;",class:"text-primary hover:underline"},vt={class:"before:content-['/'] ltr:before:mr-2 rtl:before:ml-2"},ft={class:"scrumboard-v2 space-y-8"},yt={class:"flex items-center justify-between flex-wrap gap-4"},bt={class:"text-xl leading-relaxed"},wt={class:"flex sm:flex-row flex-col sm:items-center sm:gap-3 gap-4"},$t={class:"flex gap-3"},kt={class:"relative pt-5"},xt={class:"h-full -mx-2"},Ct={key:0,class:"grid place-content-center h-[500px]"},qt={key:1,class:"overflow-x-auto flex items-start flex-nowrap gap-5 px-2 pb-2"},Ot={class:"flex justify-between mb-5"},St={class:"text-base font-semibold"},jt={class:"shadow bg-[#f4f4f4] dark:bg-white-dark/20 p-3 pb-5 rounded-md mb-5 space-y-3 cursor-move"},Mt={key:0,class:"flex items-center text-xs text-info font-semibold"},Et={key:1,class:"flex items-center text-xs text-primary font-semibold"},Bt={class:"text-base font-medium"},It={class:"break-all text-sm text-gray-700 dark:text-gray-400"},Vt={class:"flex items-center justify-between text-xs text-gray-500 mt-2"},Dt={class:"flex justify-end mt-4 gap-2"},At=["onClick"],Pt=["onClick"],Tt=["onClick"],Lt=["onClick"],Jt=ie({__name:"OrderKanbanBoard",setup(c){const{t:_}=ye();Ee(),Se({title:_("ordenes.order_kanban_board")});const{fetchSuppliers:y,fetchProducts:S,suppliers:B,products:E,loading:m,saving:j,errorMessage:o,successMessage:s,errors:a,params:g,viewModal:b,saveOrder:C,deleteOrder:G,editOrder:H,resetParams:$,viewOrder:L,closeViewModal:J,addItem:F,removeItem:W,handleProductChange:ce,showMessage:X,splitOrder:ae}=Pe(),Z=M(!1),ee=M(!1),K=M(null),z=M([{id:"nuevo pedido",title:_("ordenes.status.nuevo_pedido"),badgeClass:"badge-outline-dark",borderColorClass:"border-gray-500",orders:[]},{id:"disponibilidad",title:_("ordenes.status.disponibilidad"),badgeClass:"badge-outline-secondary",borderColorClass:"border-secondary",orders:[]},{id:"preparar pedido",title:_("ordenes.status.preparar_pedido"),badgeClass:"badge-outline-success",borderColorClass:"border-success",orders:[]},{id:"en preparación",title:_("ordenes.status.en_preparacion"),badgeClass:"badge-outline-info",borderColorClass:"border-info",orders:[]},{id:"facturación",title:_("ordenes.status.facturacion"),badgeClass:"badge-outline-primary",borderColorClass:"border-primary",orders:[]},{id:"en despacho",title:_("ordenes.status.en_despacho"),badgeClass:"badge-outline-warning",borderColorClass:"border-warning",orders:[]},{id:"en ruta",title:_("ordenes.status.en_ruta"),badgeClass:"badge-outline-danger",borderColorClass:"border-danger",orders:[]},{id:"entregado",title:_("ordenes.status.entregado"),badgeClass:"badge-outline-success",borderColorClass:"border-success",orders:[]}]),D=async()=>{var v,d;m.value=!0;try{const k=(await O.get("/api/purchase-orders")).data.data;z.value.forEach(I=>{I.orders=[]}),k.forEach(I=>{const r=z.value.find(n=>n.id===I.status);if(r)r.orders.push(I);else{console.warn(`Order ${I.id} has unknown status: ${I.status}. Defaulting to 'nuevo pedido'.`);const n=z.value.find(p=>p.id==="nuevo pedido");n&&n.orders.push(I)}})}catch(q){console.error("Error fetching orders for Kanban:",q);const k=((d=(v=q.response)==null?void 0:v.data)==null?void 0:d.message)||_("ordenes.error_fetching_orders");X(k,"error")}finally{m.value=!1}},ue=async v=>{var u,h;const d=v.item._underlying_vm_.id,q=v.from.dataset.statusId,k=v.to.dataset.statusId;if(!k||!q){console.warn("Source or target status ID is undefined. Drag operation might be invalid. Reverting."),await D();return}const I=z.value.find(w=>w.id===q),r=z.value.find(w=>w.id===k);if(!I||!r){console.warn("Source or target status column not found. Reverting."),await D();return}const n=r.orders.find(w=>w.id===d);if(!n){console.warn(`Order with ID ${d} not found in new status column ${k}. Reverting.`),await D();return}const p=q;try{await O.put(`/api/purchase-orders/${d}/status`,{status:k}),X(_("ordenes.order_status_updated_successfully"),"success")}catch(w){console.error("Error updating order status:",w);const re=((h=(u=w.response)==null?void 0:u.data)==null?void 0:h.message)||_("ordenes.error_updating_order_status");X(re,"error");const be=r.orders.findIndex(fe=>fe.id===d);if(be!==-1){const fe=r.orders.splice(be,1)[0];I.orders.splice(v.oldIndex,0,fe)}n&&(n.status=p),await D()}},pe=()=>{H(null),Z.value=!0},_e=v=>{H(v),Z.value=!0},oe=v=>{const d=typeof v=="number"?v:v.id;L(d)},me=async v=>{(await te.fire({title:_("purchase_orders_page.delete_confirm.title"),text:_("purchase_orders_page.delete_confirm.text"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:_("purchase_orders_page.delete_confirm.confirm"),cancelButtonText:_("purchase_orders_page.delete_confirm.cancel")})).isConfirmed&&(await G(v),await D())},ne=()=>{Z.value=!1,$(),D()},he=async()=>{await C()&&ne()},ge=v=>{K.value=v,ee.value=!0},se=()=>{ee.value=!1,K.value=null,a.value={}},de=async v=>{var q;if(!((q=K.value)!=null&&q.id)){X(_("purchase_orders_page.split_modal.alerts.no_order_selected"),"error");return}await ae(K.value.id,v)&&(se(),await D())},ve=v=>{if(!v)return"";const d={year:"numeric",month:"short",day:"numeric"};return new Date(v).toLocaleDateString(void 0,d)};return Me(()=>{D(),y(),S()}),(v,d)=>(l(),i("div",null,[e("ul",ht,[e("li",null,[e("a",gt,t(v.$t("dashboard")),1)]),e("li",vt,[e("span",null,t(v.$t("ordenes.kanban_board")),1)])]),e("div",ft,[e("div",yt,[e("h2",bt,t(v.$t("ordenes.order_kanban_board")),1),e("div",wt,[e("div",$t,[e("button",{type:"button",class:"btn btn-primary",onClick:pe},[d[2]||(d[2]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-5 h-5 ltr:mr-3 rtl:ml-3"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)),N(" "+t(v.$t("purchase_orders_page.add_order_btn")),1)]),e("button",{type:"button",class:"btn btn-primary",onClick:D},[d[3]||(d[3]=e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5"},[e("path",{d:"M20.9999 12C20.9999 16.9706 16.9705 21 11.9999 21C7.02934 21 2.99994 16.9706 2.99994 12C2.99994 7.02944 7.02934 3 11.9999 3",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M18.8477 15.6529C19.7897 14.0533 20.2522 13.0166 20.4939 12",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),e("path",{d:"M17.9999 3L20.9999 7H16.9999",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),N(" "+t(v.$t("ordenes.refresh")),1)])])])]),P(Ae,{"error-message":f(o),"success-message":f(s),onClearError:d[0]||(d[0]=q=>o.value=""),onClearSuccess:d[1]||(d[1]=q=>s.value="")},null,8,["error-message","success-message"]),e("div",kt,[e("div",xt,[f(m)?(l(),i("div",Ct,[...d[4]||(d[4]=[e("span",{class:"animate-spin border-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle"},null,-1)])])):(l(),i("div",qt,[(l(!0),i(A,null,T(z.value,q=>(l(),i("div",{key:q.id,class:V(["panel w-80 flex-none border-2 border-solid rounded-lg",q.borderColorClass])},[e("div",Ot,[e("h4",St,t(q.title),1),e("span",{class:V(["badge",q.badgeClass])},t(q.orders.length),3)]),P(f(Oe),{class:"connect-sorting-content min-h-[150px]",list:q.orders,group:"kanban-board","ghost-class":"sortable-ghost","drag-class":"sortable-drag",animation:200,onEnd:ue,"data-status-id":q.id},{default:Q(()=>[(l(!0),i(A,null,T(q.orders,k=>{var I;return l(),i("div",{class:"sortable-list",key:k.id},[e("div",jt,[k.parent_id?(l(),i("div",Mt,[d[5]||(d[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-4 h-4 mr-1"},[e("polyline",{points:"15 10 20 15 15 20"}),e("path",{d:"M4 4v7a4 4 0 0 0 4 4h12"})],-1)),e("span",null,t(v.$t("ordenes.sub_order")),1)])):x("",!0),k.sub_orders_count>0&&!k.parent_id?(l(),i("div",Et,[...d[6]||(d[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"w-4 h-4 mr-1"},[e("path",{d:"M17 2.1l4 4-4 4"}),e("path",{d:"M3 12.6v-2.1c0-4.4 3.6-8 8-8h7"}),e("path",{d:"M7 21.9l-4-4 4-4"}),e("path",{d:"M21 11.4v2.1c0 4.4-3.6 8-8 8H6"})],-1),e("span",null,"Orden Principal",-1)])])):x("",!0),e("div",Bt,t(k.order_number)+" - "+t(((I=k.creator)==null?void 0:I.name)||"N/A"),1),e("p",It,t(k.notes?Array.isArray(k.notes)&&k.notes.length>0?k.notes[0].note:"":"No description"),1),e("div",Vt,[e("span",null,t(v.$t("ordenes.created_at"))+": "+t(ve(k.created_at)),1)]),e("div",Dt,[e("button",{type:"button",class:"btn btn-outline-info btn-sm",onClick:r=>oe(k)},t(v.$t("ordenes.view_details")),9,At),e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:r=>_e(k)},t(v.$t("edit")),9,Pt),k.parent_id?x("",!0):(l(),i("button",{key:0,type:"button",class:"btn btn-outline-warning btn-sm",onClick:r=>ge(k)},t(v.$t("purchase_orders_page.actions.split")),9,Tt)),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>me(k)},t(v.$t("delete")),9,Lt)])])])}),128))]),_:2},1032,["list","data-status-id"])],2))),128))]))])])]),P(js,{show:Z.value,params:f(g),errors:f(a),saving:f(j),suppliers:f(B),products:f(E),onClose:ne,onSave:he,onAddItem:f(F),onRemoveItem:f(W),onProductChange:f(ce)},null,8,["show","params","errors","saving","suppliers","products","onAddItem","onRemoveItem","onProductChange"]),P(Ur,{show:f(b).show,order:f(b).data,onClose:f(J),onViewOrderId:oe},null,8,["show","order","onClose"]),P(mt,{show:ee.value,order:K.value,errors:f(a),saving:f(j),onClose:se,onSplit:de},null,8,["show","order","errors","saving"])]))}});export{Jt as default};
